System.register("chunks:///_virtual/BaseAbil.ts",["cc"],(function(t){var i;return{setters:[function(t){i=t.cclegacy}],execute:function(){i._RF.push({},"9b438R6UM9En66w1nZMEFGO","BaseAbil",void 0);t("BaseAbil",function(){function t(t,i,n,e){this.abilConfig=void 0,this.battleLog=void 0,this.battleground=void 0,this.abilConfig=t,this.battleLog=n,this.battleground=e}return t.prototype.tick=function(t,i){},t}());i._RF.pop()}}}));

System.register("chunks:///_virtual/BattleBombView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./BattleViewCommon.ts"],(function(e){var o,t,n,i,l,r,a,s,c,p,u,d;return{setters:[function(e){o=e.applyDecoratedDescriptor,t=e.inheritsLoose,n=e.initializerDefineProperty,i=e.assertThisInitialized},function(e){l=e.cclegacy,r=e._decorator,a=e.ParticleSystem,s=e.Node,c=e.tween,p=e.Component},function(e){u=e.getRealXFromRelative,d=e.getRealYFromLine}],execute:function(){var b,m,y,f,h,v,x;l._RF.push({},"6dcc0+y8k1GkIsvlzGxRaXi","BattleBombView",void 0);var B=r.ccclass,g=r.property;e("BattleBombView",(b=B("BattleBombView"),m=g({type:a}),y=g({type:s}),b((v=o((h=function(e){function o(){for(var o,t=arguments.length,l=new Array(t),r=0;r<t;r++)l[r]=arguments[r];return o=e.call.apply(e,[this].concat(l))||this,n(o,"explosion",v,i(o)),n(o,"bombNode",x,i(o)),o}return t(o,e),o.prototype.init=function(e,o,t,n,i,l){var r=this;this.explosion&&(this.explosion.node.active=!1);var a=u(o,null!=l?l:this.node.parent),s=d(e,null!=l?l:this.node.parent),p=u(i,null!=l?l:this.node.parent),b=d(n,null!=l?l:this.node.parent);this.node.setPosition(a,s,0),console.log("Bomb launched from ("+a+", "+s+") to ("+p+", "+b+") over "+t+" seconds."),c(this.node).to(t,{position:{x:p,y:b,z:0}}).call((function(){r.bombNode&&(r.bombNode.active=!1),r.explosion&&(r.explosion.node.active=!0,r.explosion.stop(),r.explosion.clear(),r.explosion.play())})).delay(3).call((function(){r.node.destroy()})).start()},o}(p)).prototype,"explosion",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),x=o(h.prototype,"bombNode",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),f=h))||f));l._RF.pop()}}}));

System.register("chunks:///_virtual/Battleground.ts",["./rollupPluginModLoBabelHelpers.js","cc","./CommonBattle.ts","./BattleStateMachine.ts"],(function(t){var e,n,a,i;return{setters:[function(t){e=t.createForOfIteratorHelperLoose},function(t){n=t.cclegacy},function(t){a=t.BattleTeam},function(t){i=t.BattleUnitState}],execute:function(){n._RF.push({},"59391kMDANBBYDglOCYagFd","Battleground",void 0);t("Battleground",function(){function t(){this.team1Units=[],this.team2Units=[]}var n=t.prototype;return n.startBattle=function(){this.team1Units.forEach((function(t){return t.startBattle()})),this.team2Units.forEach((function(t){return t.startBattle()}))},n.getEnemyTeam=function(t){return t==a.Team1?this.team2Units:t==a.Team2?this.team1Units:(console.error("REQUEST UNONOWN TEAM: ",t),null)},n.getEnemyAtLine=function(t){var e=this.getEnemyTeam(t.team);if(null===e)return null;var n=null,a=1/0;return e.forEach((function(e){var r=Math.abs(t.position-e.position);r<a&&e.unitData.line===t.unitData.line&&e.stateMachine.getState()!==i.Dead&&(a=r,n=e)})),n},n.getEnemyAtLineByLine=function(t,n){var a=this.getEnemyTeam(t);if(null===a)return null;for(var i,r=e(a);!(i=r()).done;){var u=i.value;if(u.unitData.line===n)return u}return null},n.isAllEnemyDeadOrFinished=function(t){var n=this.getEnemyTeam(t);if(null===n)return!1;for(var r,u=e(n);!(r=u()).done;){var o=r.value,s=o.team===a.Team1&&o.position>=100||o.team===a.Team2&&o.position<=0;if(o.stateMachine.getState()!=i.Dead&&!s)return!1}return console.log("ALL ENEMY DEAD OR FINISHED!"),!0},n.update=function(t,e,n){var i=n===a.Team1?this.team1Units:this.team2Units,r=n===a.Team1?this.team2Units:this.team1Units;i.forEach((function(n){return n.update(t,e)})),r.forEach((function(n){return n.update(t,e)}))},n.finishBattle=function(){this.team1Units.forEach((function(t){return t.finishBattle()})),this.team2Units.forEach((function(t){return t.finishBattle()}))},t}());n._RF.pop()}}}));

System.register("chunks:///_virtual/BattleLog.ts",["cc"],(function(t){var e;return{setters:[function(t){e=t.cclegacy}],execute:function(){e._RF.push({},"53802BxY01Fx6RiO+Jjgdll","BattleLog",void 0);t("BattleLog",function(){function t(t,e){this.version=1,this.battleId=void 0,this.startedAt=void 0,this.events=[],this.battleId=t,this.startedAt=e}var e=t.prototype;return e.addEvent=function(t){this.events.push(t)},e.addStartEvent=function(t,e,n){this.events.push({t:"start",seed:t,user_squad:e,enemy_squad:n})},e.addMoveEvent=function(t,e,n,s,i){this.events.push({t:"mv",unit:t,time:e,fromPos:n,finishTime:s,toPos:i})},e.addChangeHpEvent=function(t,e,n){this.events.push({t:"chp",time:t,unit:e,newHp:n})},e.addDeathEvent=function(t,e){this.events.push({t:"death",time:t,unit:e})},e.addBombEvent=function(t,e,n,s,i,a){this.events.push({t:"bomb",time:t,startLine:e,startPos:n,finishTime:s,targetLine:i,targetPos:a})},e.addBulletShotEvent=function(t,e,n){this.events.push({t:"bullet_shot",time:t,attacker:e,target:n})},e.addFinishEvent=function(t,e,n,s,i,a){this.events.push({t:"finish",time:t,winner:e,team1FinishedUnits:n,team1Score:s,team2FinishedUnits:i,team2Score:a})},e.getEvents=function(){return this.events},e.toJSON=function(){return{version:this.version,battleId:this.battleId,startedAt:this.startedAt,events:this.events}},t}());e._RF.pop()}}}));

System.register("chunks:///_virtual/BattleLogic.ts",["cc","./BattleLog.ts","./CommonBattle.ts","./BattleStateMachine.ts","./BattleUnit.ts","./Battleground.ts"],(function(t){var e,n,a,i,o,s;return{setters:[function(t){e=t.cclegacy},function(t){n=t.BattleLog},function(t){a=t.BattleTeam},function(t){i=t.BattleUnitState},function(t){o=t.BattleUnit},function(t){s=t.Battleground}],execute:function(){e._RF.push({},"66653zBvnpPnq32xucJxmmD","BattleLogic",void 0),t("BattleLogic",function(){function t(e,i){var l=this;this.battleConfig=void 0,this.unitsConfig=void 0,this.battleLog=void 0,this.battleground=void 0,this.battleConfig=this.parseJson(e),this.unitsConfig=this.parseJson(i),this.battleground=new s,this.battleLog=new n("battle_"+Date.now(),Date.now());var r=0,u={},g={};this.battleConfig.user_config.squad.forEach((function(e){var n=l.unitsConfig.Units.find((function(t){return t.id===e}));if(n){var i=new o(r,n,l.battleConfig,l.battleLog,l.battleground,a.Team1,t.fightDistance);u[r]=n.id,console.log("Adding ALLY battle unit: "+i),l.battleground.team1Units.push(i),r+=1}})),this.battleConfig.enemy_config.squad.forEach((function(e){var n=l.unitsConfig.Units.find((function(t){return t.id===e}));if(n){var i=new o(r,n,l.battleConfig,l.battleLog,l.battleground,a.Team2,t.fightDistance);g[r]=n.id,l.battleground.team2Units.push(i)}r+=1})),this.battleLog.addStartEvent(Math.floor(1e6*Math.random()),u,g)}var e=t.prototype;return e.simulateBattle=function(){var t=this;this.battleground.startBattle();for(var e=!1,n=1/30,o=120,s=Math.random()<.5?a.Team1:a.Team2,l=function(){t.battleground.update(n,120-o,s),(o-=n)<=0&&(console.log("Battle ended in a draw due to time out."),e=!0);var a=0,l=0,r=0,u=0;t.battleground.team1Units.forEach((function(t){t.stateMachine.getState()!=i.Dead&&(a++,t.position>=100&&r++)})),t.battleground.team2Units.forEach((function(t){t.stateMachine.getState()!=i.Dead&&(l++,t.position<=0&&u++)})),a==r&&l==u&&(console.log("Battle ended. User alive: "+a+" (finished: "+r+"), Enemy alive: "+l+" (finished: "+u+")"),e=!0)};!e;)l();this.battleground.finishBattle();var r,u=0,g=0,c=0,f=0;return this.battleground.team1Units.forEach((function(t){u+=t.causedDamage,t.stateMachine.getState()!=i.Dead&&t.position>=100&&c++})),this.battleground.team2Units.forEach((function(t){g+=t.causedDamage,t.stateMachine.getState()!=i.Dead&&t.position<=0&&f++})),r=c!=f?c>f?a.Team1:a.Team2:u>g?a.Team1:a.Team2,this.battleLog.addFinishEvent(120-o,r,c,u,f,g),console.log("Battle Log:",JSON.stringify(this.battleLog,null,2)),JSON.stringify(this.battleLog,null,2)},e.parseJson=function(t){return JSON.parse(t)},t}()).fightDistance=20,e._RF.pop()}}}));

System.register("chunks:///_virtual/BattleManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./StaticConfigStore.ts","./UserService.ts","./MoneyBar.ts","./BattleUnitView.ts","./BattleBombView.ts","./BulletShotView.ts","./CommonBattle.ts"],(function(t){var e,i,n,a,r,o,l,s,u,c,b,h,f,p,w,m,d,v,g,B;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,n=t.initializerDefineProperty,a=t.assertThisInitialized,r=t.asyncToGenerator,o=t.regeneratorRuntime},function(t){l=t.cclegacy,s=t._decorator,u=t.Node,c=t.Prefab,b=t.Label,h=t.instantiate,f=t.Component},function(t){p=t.StaticConfigStore},function(t){w=t.UserService},function(t){m=t.MoneyBar},function(t){d=t.BattleUnitView},function(t){v=t.BattleBombView},function(t){g=t.BulletShotView},function(t){B=t.BattleTeam}],execute:function(){var y,S,V,P,L,M,N,U,T,C,z,x,I,R,_,k,D,F,H,J,W;l._RF.push({},"07e9eI6lwZJx5ZJWVSZVA7N","BattleManager",void 0);var Z=s.ccclass,q=s.property;t("BattleManager",(y=Z("BattleManager"),S=q({type:u}),V=q({type:c}),P=q({type:c}),L=q({type:c}),M=q({type:b}),N=q({type:b}),U=q({type:b}),T=q({type:u}),C=q({type:m}),y((I=e((x=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),o=0;o<i;o++)r[o]=arguments[o];return e=t.call.apply(t,[this].concat(r))||this,n(e,"battleNode",I,a(e)),n(e,"battleUnitViewPrefab",R,a(e)),n(e,"battleBombViewPrefab",_,a(e)),n(e,"bulletShotViewPrefab",k,a(e)),n(e,"winnerLabel",D,a(e)),n(e,"team1ScoreLabel",F,a(e)),n(e,"team2ScoreLabel",H,a(e)),n(e,"finishBattleNode",J,a(e)),n(e,"rewardMoneyBar",W,a(e)),e.battleUnitViews=new Map,e.events=[],e.timeSinceBattleStart=0,e}i(e,t);var l=e.prototype;return l.init=function(){var t=r(o().mark((function t(e,i){var n,a;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=w.getInstance().battleService,t.next=3,n.simulateBattle(e,i);case 3:a=t.sent,this.initBattle(a.battleLog);case 5:case"end":return t.stop()}}),t,this)})));return function(e,i){return t.apply(this,arguments)}}(),l.initBattle=function(t){var e=JSON.parse(t);if(this.events=e.events,this.events.sort((function(t,e){var i,n;return(null!=(i=t.time)?i:0)-(null!=(n=e.time)?n:0)})),this.finishBattleNode.active=!1,"start"===this.events[0].t){var i=this.events[0].user_squad;for(var n in i){var a=i[n],r=h(this.battleUnitViewPrefab).getComponent(d);r.node.setScale(-1,1,1),r.init(parseInt(n),a,B.Team1,this.battleNode),this.battleNode.addChild(r.node),this.battleUnitViews.set(parseInt(n),r)}var o=this.events[0].enemy_squad;for(var l in o){var s=o[l],u=h(this.battleUnitViewPrefab).getComponent(d);u.init(parseInt(l),s,B.Team2,this.battleNode),this.battleNode.addChild(u.node),this.battleUnitViews.set(parseInt(l),u)}this.events.shift()}else console.error("Battle log does not start with a start event");console.log("[BattleManager] Battle started with "+this.events.length+" events."+this.events)},l.update=function(t){if(this.timeSinceBattleStart+=t,0!==this.events.length)for(;this.events.length>0&&this.timeSinceBattleStart>=this.events.at(0).time;){var e=this.events.shift();if("mv"===e.t){var i=e.unit,n=e.fromPos,a=e.toPos,r=this.battleUnitViews.get(i);r&&r.moveTo(n,a,e.finishTime-e.time)}if("chp"===e.t){var o=e.unit,l=e.newHp,s=this.battleUnitViews.get(o);s&&s.changeHp(l)}if("bomb"===e.t){var u=h(this.battleBombViewPrefab).getComponent(v);u.init(e.startLine,e.startPos,e.finishTime-e.time,e.targetLine,e.targetPos,this.battleNode),this.battleNode.addChild(u.node)}if("bullet_shot"===e.t){var c=h(this.bulletShotViewPrefab).getComponent(g);c.init(this.battleUnitViews.get(e.attacker),this.battleUnitViews.get(e.target).node),this.battleNode.addChild(c.node)}if("death"===e.t){var b=e.unit,f=this.battleUnitViews.get(b);f&&f.death()}"finish"===e.t&&(e.winner===B.Team1?this.winnerLabel.string="Team 1 Wins!":this.winnerLabel.string="Team 2 Wins!",this.team1ScoreLabel.string="Team 1 Score: "+Math.round(e.team1Score).toString(),this.team2ScoreLabel.string="Team 2 Score: "+Math.round(e.team2Score).toString(),this.finishBattleNode.active=!0,this.showReward(e.winner))}},l.closeBattle=function(){this.node.removeFromParent()},l.showReward=function(){var t=r(o().mark((function t(e){var i,n;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.rewardMoneyBar){t.next=2;break}return t.abrupt("return");case 2:i=p.getBattleRewards(),n=e===B.Team1?i.win:i.lose,this.rewardMoneyBar.setPriceLabelText("Reward:"),this.rewardMoneyBar.init(n),this.rewardMoneyBar.showPriceLabel(!0);case 7:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}(),e}(f)).prototype,"battleNode",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),R=e(x.prototype,"battleUnitViewPrefab",[V],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_=e(x.prototype,"battleBombViewPrefab",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),k=e(x.prototype,"bulletShotViewPrefab",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),D=e(x.prototype,"winnerLabel",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),F=e(x.prototype,"team1ScoreLabel",[N],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),H=e(x.prototype,"team2ScoreLabel",[U],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),J=e(x.prototype,"finishBattleNode",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),W=e(x.prototype,"rewardMoneyBar",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),z=x))||z));l._RF.pop()}}}));

System.register("chunks:///_virtual/BattleService.ts",["./rollupPluginModLoBabelHelpers.js","cc","./BattleLogic.ts","./CommonBattle.ts","./StaticConfigStore.ts"],(function(e){var t,n,r,i,o,a;return{setters:[function(e){t=e.asyncToGenerator,n=e.regeneratorRuntime},function(e){r=e.cclegacy},function(e){i=e.BattleLogic},function(e){o=e.BattleTeam},function(e){a=e.StaticConfigStore}],execute:function(){r._RF.push({},"4bacdWceW9J8YSoOxvUSQgJ","BattleService",void 0);e("BattleService",function(){function e(e){this.walletService=void 0,this.walletService=e}var r=e.prototype;return r.simulateBattle=function(){var e=t(n().mark((function e(t,r){var o,l,c,s,u;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("[BattleService] Simulating battle"),o=null!=r?r:a.getUnitsConfig(),l=new i(JSON.stringify(t),JSON.stringify(o)),c=l.simulateBattle(),s=this.resolveWinner(c),u=this.getRewardForWinner(s),console.log("[BattleService] reward: "+u),u.money.length>0&&this.walletService.add(u),e.abrupt("return",{battleLog:c,winner:s,reward:u});case 9:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}(),r.resolveWinner=function(e){var t,n=null==(t=JSON.parse(e).events)?void 0:t.find((function(e){return"finish"===e.t}));return n&&void 0!==n.winner?n.winner:(console.error("[BattleService] Finish event is missing in battle log"),o.Team2)},r.getRewardForWinner=function(e){var t=a.getBattleRewards();return e===o.Team1?t.win:t.lose},e}());r._RF.pop()}}}));

System.register("chunks:///_virtual/BattleStarter.ts",["./rollupPluginModLoBabelHelpers.js","cc","./BattleLogic.ts"],(function(e){var t,r,n,o;return{setters:[function(e){t=e.asyncToGenerator,r=e.regeneratorRuntime},function(e){n=e.cclegacy},function(e){o=e.BattleLogic}],execute:function(){n._RF.push({},"f87dcHVYw9DQ4KiSmX3r7Y3","BattleStarter",void 0);var i=e("BattleStarter",function(){function e(){}return e.loadConfigs=function(){var e=t(r().mark((function e(){var t,n,o,i,a,s,u,c,f,l,p;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=(t=process)&&null!=(t=t.versions)&&t.node){e.next=2;break}throw new Error("BattleStarter.loadConfigs requires a Node.js environment.");case 2:if(n=Function('return typeof require !== "undefined" ? require : undefined')()){e.next=5;break}throw new Error("BattleStarter.loadConfigs requires require().");case 5:return"fs/promises","path",o=n("fs/promises"),i=o.readFile,a=n("path"),s=a.resolve(__dirname,"..","..","..","resources"),u=a.join(s,"BattleConfig.json"),c=a.join(s,"Config","Units.json"),e.next=14,Promise.all([i(u,"utf-8"),i(c,"utf-8")]);case 14:return f=e.sent,l=f[0],p=f[1],e.abrupt("return",{battleConfig:l,unitsConfig:p});case 18:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.run=function(){var e=t(r().mark((function e(){var t,n,i,a,s;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.loadConfigs();case 2:t=e.sent,n=t.battleConfig,i=t.unitsConfig,a=new o(n,i),s=a.simulateBattle(),console.log(s);case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),e}());"undefined"!=typeof require&&require.main===module&&i.run().catch((function(e){console.error("[BattleStarter] Failed to run battle",e),process.exit(1)})),n._RF.pop()}}}));

System.register("chunks:///_virtual/BattleStateMachine.ts",["cc"],(function(t){var e;return{setters:[function(t){e=t.cclegacy}],execute:function(){e._RF.push({},"60c06RzBtFOQpaJ4fBc/B5K","BattleStateMachine",void 0);var a=t("BattleUnitState",function(t){return t.Preparing="preparing",t.Moving="moving",t.CloseCombat="close_combat",t.Dead="dead",t}({}));t("BattleUnitStateMachine",function(){function t(t){this.state=void 0,this.onStateChange=void 0,this.state=a.Preparing,this.onStateChange=t}var e=t.prototype;return e.setOnStateChange=function(t){this.onStateChange=t},e.setState=function(t){if(this.state!==t){var e=this.state;this.state=t,this.onStateChange&&e!==t&&this.onStateChange(e,t)}},e.getState=function(){return this.state},t}());e._RF.pop()}}}));

System.register("chunks:///_virtual/BattleUnit.ts",["cc","./CommonBattle.ts","./BattleStateMachine.ts","./BombAbil.ts","./BulletShotAbil.ts"],(function(t){var i,e,a,s,n,o;return{setters:[function(t){i=t.cclegacy},function(t){e=t.BattleTeam},function(t){a=t.BattleUnitState,s=t.BattleUnitStateMachine},function(t){n=t.BombAbil},function(t){o=t.BulletShotAbil}],execute:function(){i._RF.push({},"753acSiGqRMvqd1iIBz1vNY","BattleUnit",void 0);t("BattleUnit",function(){function t(t,i,n,o,h,c,l){var r=this;this.unitData=void 0,this.battleConfig=void 0,this.hp=void 0,this.position=void 0,this.team=void 0,this.battleLog=void 0,this.battleground=void 0,this.battleUnitId=void 0,this.closeCombatDistance=void 0,this.movingStartTime=void 0,this.movingStartPos=void 0,this.curTimeFromStart=void 0,this.stateMachine=void 0,this.abils=[],this.causedDamage=0,this.unitStateChange=function(t,i){t!==a.Moving&&i===a.Moving&&(r.movingStartTime=r.curTimeFromStart,r.movingStartPos=r.position),t===a.Moving&&i!==a.Moving&&r.finishMoveEvent(),i===a.Dead&&r.battleLog.addDeathEvent(r.curTimeFromStart,r.battleUnitId),a.CloseCombat},this.unitData=i,this.battleLog=o,this.battleConfig=n,this.hp=i.hp,this.team=c,this.battleUnitId=t,this.battleground=h,this.closeCombatDistance=l,this.stateMachine=new s(this.unitStateChange),this.position=c===e.Team1?0:100,this.movingStartTime=0,this.curTimeFromStart=0,this.movingStartPos=0}var i=t.prototype;return i.startBattle=function(){var t=this;null!=this.unitData.abils&&this.unitData.abils.forEach((function(i){"bomb_abil"===i.name&&t.abils.push(new n(i,t,t.battleLog,t.battleground)),"bullet_shot"===i.name&&t.abils.push(new o(i,t,t.battleLog,t.battleground))}))},i.update=function(t,i){if(this.stateMachine.getState()!==a.Dead)switch(this.stateMachine.getState()!==a.Dead&&this.abils.forEach((function(e){e.tick(t,i)})),this.curTimeFromStart=i,this.stateMachine.getState()){case a.Preparing:this.stateMachine.setState(a.Moving);break;case a.Moving:this.move(t,i),this.checkForRickEndOfScreen(),this.checkForCloseCombatState();break;case a.CloseCombat:this.checkForCloseCombatState();break;case a.Dead:}},i.finishMoveEvent=function(){this.battleLog.addMoveEvent(this.battleUnitId,this.movingStartTime,this.movingStartPos,this.curTimeFromStart,this.position)},i.calcSpeed=function(){var t=this.unitData.v_base;switch(this.battleConfig.biom){case"snow":t*=this.unitData.v_mult_snow;break;case"desert":t*=this.unitData.v_mult_desert;break;case"jungle":t*=this.unitData.v_mult_jungle}return this.battleground.isAllEnemyDeadOrFinished(this.team)&&(t*=7),t},i.move=function(t,i){var a=this.calcSpeed();this.team===e.Team1?this.position+=a*t:this.position-=a*t},i.checkForRickEndOfScreen=function(){this.team===e.Team1&&this.position>=100&&(this.position=100,this.stateMachine.setState(a.CloseCombat),this.finishMoveEvent()),this.team===e.Team2&&this.position<=0&&(this.position=0,this.stateMachine.setState(a.CloseCombat),this.finishMoveEvent())},i.checkForCloseCombatState=function(){var t=this.battleground.getEnemyAtLine(this);null!=t?Math.abs(this.position-t.position)<=this.closeCombatDistance&&this.stateMachine.setState(a.CloseCombat):this.stateMachine.setState(a.Moving)},i.applyDamage=function(t,i){t.causedDamage+=i,this.hp-=i,this.battleLog.addChangeHpEvent(this.curTimeFromStart,this.battleUnitId,Math.max(this.hp,0)),this.hp<=0&&this.stateMachine.setState(a.Dead)},i.finishBattle=function(){this.stateMachine.getState()===a.Moving&&this.finishMoveEvent()},t}());i._RF.pop()}}}));

System.register("chunks:///_virtual/BattleUnitView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./StaticConfigStore.ts","./CommonBattle.ts","./BattleViewCommon.ts"],(function(t){var e,i,n,o,a,r,l,s,c,u,h,p,m,f,d,b,g;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,n=t.initializerDefineProperty,o=t.assertThisInitialized},function(t){a=t.cclegacy,r=t._decorator,l=t.Sprite,s=t.ProgressBar,c=t.Node,u=t.resources,h=t.SpriteFrame,p=t.tween,m=t.Component},function(t){f=t.StaticConfigStore},function(t){d=t.BattleTeam},function(t){b=t.getRealYFromLine,g=t.getRealXFromRelative}],execute:function(){var y,v,B,w,z,P,U,A,I;a._RF.push({},"6b51aT0CkxPVplxw9E/n3ig","BattleUnitView",void 0);var S=r.ccclass,V=r.property;t("BattleUnitView",(y=S("BattleUnitView"),v=V({type:l}),B=V({type:s}),w=V({type:c}),y((U=e((P=function(t){function e(){for(var e,i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return e=t.call.apply(t,[this].concat(a))||this,n(e,"combotant",U,o(e)),n(e,"healthBar",A,o(e)),n(e,"muzzleflashNode",I,o(e)),e.battleUnitId=0,e.startHp=0,e.team=void 0,e.battleArea=null,e}i(e,t);var a=e.prototype;return a.init=function(t,e,i,n){var o=this;this.battleUnitId=t,this.team=i,this.battleArea=null!=n?n:null;var a=f.getUnitById(e);if(null!==a){u.load(a.model,h,(function(t,e){o.combotant.spriteFrame=e})),console.log("Initializing BattleUnitView for unitId: "+e+" on team "+this.team+" "+i);this.node.getPosition();var r=b(a.line,this.battleArea);d.Team1===this.team&&this.node.setPosition(g(0,this.battleArea),r,0),d.Team2===this.team&&this.node.setPosition(g(100,this.battleArea),r,0),this.startHp=a.hp}},a.moveTo=function(t,e,i){var n=this.node.getPosition(),o=g(t,this.battleArea),a=g(e,this.battleArea);console.log("Moving unit "+this.battleUnitId+" from "+o+" to "+a+" over "+i+" seconds."),this.node.setPosition(o,n.y,0),p(this.node).to(i,{position:{x:a,y:n.y,z:0}}).start()},a.changeHp=function(t){this.healthBar.progress=1-t/this.startHp},a.death=function(){this.node.active=!1},e}(m)).prototype,"combotant",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),A=e(P.prototype,"healthBar",[B],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),I=e(P.prototype,"muzzleflashNode",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),z=P))||z));a._RF.pop()}}}));

System.register("chunks:///_virtual/BattleViewCommon.ts",["cc","./StaticConfigModels.ts"],(function(e){var t,n,i,r,o;return{setters:[function(e){t=e.cclegacy,n=e.view,i=e.UITransform,r=e.Canvas},function(e){o=e.UnitLine}],execute:function(){function c(){return n.getVisibleSize()}function h(e){if(e){for(var t=e instanceof i?e.node:e,n=t;n;){if(n.getComponent(r)){var o=n.getComponent(i);if(o)return{width:o.contentSize.width,height:o.contentSize.height};break}n=n.parent}var h=t.getComponent(i);if(h)return{width:h.contentSize.width,height:h.contentSize.height}}var u=c();return{width:u.width,height:u.height}}e({getRealXFromRelative:function(e,t){var n=h(null!=t?t:null).width;return n*e/100-n/2},getRealYFromLine:function(e,t){var n=h(null!=t?t:null).height,i=-n/2;e===o.Line1&&(i+=.2*n);e===o.Live2&&(i+=.5*n);e===o.Line3&&(i+=.7*n);return i},getScreenSize:c}),t._RF.push({},"3cac3XmNK1GZ6j+et04L2V/","BattleViewCommon",void 0),t._RF.pop()}}}));

System.register("chunks:///_virtual/BildingName.ts",["cc"],(function(){var e;return{setters:[function(i){e=i.cclegacy}],execute:function(){e._RF.push({},"d688d4kwr9BiYdF5FRUnBQZ","BildingName",void 0),e._RF.pop()}}}));

System.register("chunks:///_virtual/BombAbil.ts",["./rollupPluginModLoBabelHelpers.js","cc","./BaseAbil.ts","./BattleStateMachine.ts","./CommonBattle.ts"],(function(t){var i,e,n,o,a,r;return{setters:[function(t){i=t.inheritsLoose},function(t){e=t.cclegacy},function(t){n=t.BaseAbil},function(t){o=t.BattleUnitState},function(t){a=t.BattleTeam,r=t.randomDamage}],execute:function(){e._RF.push({},"097eaC+u9VEk5mz/VS/HNaw","BombAbil",void 0);var m=function(t,i){this.pos=void 0,this.unitLine=void 0,this.pos=t,this.unitLine=i};t("BombAbil",function(t){function e(i,e,n,o){var a;return(a=t.call(this,i,e,n,o)||this).timeout=void 0,a.dmgRange=void 0,a.targets=void 0,a.v=void 0,a.owner=void 0,a.flightTime=0,a.remainTimeout=void 0,a.startBombPos=null,a.startBombTime=0,a.bombFlightTimeRemaining=0,a.targetLineForBomb=null,a.timeout=i.timeout,a.dmgRange=a.normalizeDamageRange(i.dmg),a.targets=i.targets,a.v=i.v,a.owner=e,a.flightTime=i.flightTime,"ticked"in i?(a.remainTimeout=a.timeout-i.ticked,console.log("TICKED! "+a.remainTimeout)):a.remainTimeout=a.timeout,a.bombFlightTimeRemaining=Number.MAX_VALUE,a}i(e,t);var n=e.prototype;return n.tick=function(i,e){if(t.prototype.tick.call(this,i,e),this.remainTimeout-=i,this.remainTimeout<=0){if(this.owner.team==a.Team1&&this.owner.position>50||this.owner.team==a.Team2&&this.owner.position<50)return;this.startBombPos=new m(this.owner.position,this.owner.unitData.line),this.startBombTime=e,this.targetLineForBomb=this.pickTargetLine(),this.bombFlightTimeRemaining=this.flightTime,this.remainTimeout=this.timeout}if(this.bombFlightTimeRemaining-=i,this.bombFlightTimeRemaining<0){var n;this.bombFlightTimeRemaining=Number.MAX_VALUE;var s,h,u=null!=(n=this.targetLineForBomb)?n:this.owner.unitData.line,l=this.battleground.getEnemyAtLineByLine(this.owner.team,u);if(l&&l.stateMachine.getState()!==o.Dead)this.battleLog.addBombEvent(this.startBombTime,null==(s=this.startBombPos)?void 0:s.unitLine,null==(h=this.startBombPos)?void 0:h.pos,e,l.unitData.line,l.position),l.applyDamage(this.owner,r(this.dmgRange));this.targetLineForBomb=null}},n.pickTargetLine=function(){if(!this.targets||0===this.targets.length)return this.owner.unitData.line;var t=Math.floor(Math.random()*this.targets.length);return this.targets[t]},n.normalizeDamageRange=function(t){if(Array.isArray(t)&&t.length>=2)return[Number(t[0])||0,Number(t[1])||0];var i=Number(t)||0;return[i,i]},e}(n));e._RF.pop()}}}));

System.register("chunks:///_virtual/BuildingContracts.ts",["cc"],(function(){var t;return{setters:[function(c){t=c.cclegacy}],execute:function(){t._RF.push({},"524abnEJ9RDkLNecdtAeUXY","BuildingContracts",void 0),t._RF.pop()}}}));

System.register("chunks:///_virtual/BuildingNameView.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var i,n,t,r,a,l,o,u;return{setters:[function(e){i=e.applyDecoratedDescriptor,n=e.inheritsLoose,t=e.initializerDefineProperty,r=e.assertThisInitialized},function(e){a=e.cclegacy,l=e._decorator,o=e.Label,u=e.Component}],execute:function(){var c,s,p,d,g;a._RF.push({},"f15eeac7ZFF5Ly0T6QskPqS","BuildingNameView",void 0);var b=l.ccclass,f=l.property;e("BuildingNameView",(c=b("BuildingNameView"),s=f({type:o}),c((g=i((d=function(e){function i(){for(var i,n=arguments.length,a=new Array(n),l=0;l<n;l++)a[l]=arguments[l];return i=e.call.apply(e,[this].concat(a))||this,t(i,"buildingNameLabel",g,r(i)),i}n(i,e);var a=i.prototype;return a.onLoad=function(){},a.setBuildingName=function(e){this.buildingNameLabel&&(this.buildingNameLabel.string=e)},i}(u)).prototype,"buildingNameLabel",[s],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),p=d))||p));a._RF.pop()}}}));

System.register("chunks:///_virtual/BuildingService.ts",["./rollupPluginModLoBabelHelpers.js","cc","./EventBus.ts","./StaticConfigStore.ts"],(function(i){var e,n,t,l,r;return{setters:[function(i){e=i.createForOfIteratorHelperLoose},function(i){n=i.cclegacy},function(i){t=i.bus,l=i.Events},function(i){r=i.StaticConfigStore}],execute:function(){n._RF.push({},"12561HN+QZD4rEpSFVJYOej","BuildingService",void 0);i("BuildingService",function(){function i(i){this.walletService=void 0,this.buildingLevels=new Map,this.buildingConfigIds=new Map,this.walletService=i}var n=i.prototype;return n.getAllBuildingLevels=function(){var i={};return this.buildingLevels.forEach((function(e,n){i[n.toString()]=e})),i},n.setBuildingLevels=function(i){if(this.buildingLevels.clear(),this.buildingConfigIds.clear(),i)for(var e=0,n=Object.entries(i);e<n.length;e++){var t=n[e],l=t[0],r=t[1],u=Math.max(1,Math.floor(r));this.buildingLevels.set(Number(l),u)}},n.setBuildingInstances=function(i){this.buildingLevels.clear(),this.buildingConfigIds.clear();for(var n,t=e(i);!(n=t()).done;){var l,r=n.value;if(r.buildingId&&Number.isFinite(r.id)){var u=Math.floor(r.id),s=Math.max(1,Math.floor(null!=(l=r.level)?l:1));this.buildingLevels.set(u,s),this.buildingConfigIds.set(u,r.buildingId)}}},n.getBuildingLevel=function(i){var e;return null!=(e=this.buildingLevels.get(i))?e:1},n.setBuildingLevel=function(i,e){var n=Math.max(1,Math.floor(e));this.buildingLevels.set(i,n)},n.getBuildingConfigId=function(i){var e;return null!=(e=this.buildingConfigIds.get(i))?e:null},n.getBuildingInstances=function(){for(var i,n=[],t=e(this.buildingConfigIds.entries());!(i=t()).done;){var l=i.value,r=l[0],u=l[1];n.push({id:r,configId:u})}return n},n.setBuildingConfigId=function(i,e){this.buildingConfigIds.set(i,e)},n.canUpgrade=function(i){return this.walletService.canSpend(i.upgradeCost)},n.upgrade=function(i,e){var n=e.nextLevelBuildingId;if(!n)return console.error("No upgrade available for building "+e.id),!1;var u=r.getBuildingConfigById(n);if(!u)return console.error("Next building config not found for id "+n),!1;if(!this.canUpgrade(e))return!1;if(!this.walletService.spend(e.upgradeCost))return!1;var s=this.getBuildingLevel(i)+1;return this.buildingLevels.set(i,s),this.buildingConfigIds.set(i,n),t.emit(l.BUILDING_UPGRADE,{id:i,newBuilding:u}),t.emit(l.BUILDING_UPGRADE_SUCCESS,{id:i,newBuilding:u}),!0},i}());n._RF.pop()}}}));

System.register("chunks:///_virtual/BuildingUpgradeView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./MoneyBar.ts","./WindowView.ts"],(function(e){var i,r,o,t,n,l,a,u,d,p,s,c;return{setters:[function(e){i=e.applyDecoratedDescriptor,r=e.inheritsLoose,o=e.initializerDefineProperty,t=e.assertThisInitialized},function(e){n=e.cclegacy,l=e._decorator,a=e.Sprite,u=e.Node,d=e.resources,p=e.SpriteFrame},function(e){s=e.MoneyBar},function(e){c=e.WindowView}],execute:function(){var w,f,g,v,h,y,b,M,m;n._RF.push({},"c25b7vTMuFPNJfq7nrMQf7/","BuildingUpgradeView",void 0);var B=l.ccclass,V=l.property;e("BuildingUpgradeView",(w=B("BuildingUpgradeView"),f=V({type:a}),g=V({type:a}),v=V({type:u}),w((b=i((y=function(e){function i(){for(var i,r=arguments.length,n=new Array(r),l=0;l<r;l++)n[l]=arguments[l];return i=e.call.apply(e,[this].concat(n))||this,o(i,"upgradeFromSprite",b,t(i)),o(i,"upgradeToSprite",M,t(i)),o(i,"moneyBarNode",m,t(i)),i.viewModel=null,i}r(i,e);var n=i.prototype;return n.bind=function(e){var i=this;this.viewModel=e,this.viewModel.bindView((function(){i.viewModel=null,i.node.destroy()})),this.buildView()},n.buildView=function(){var e=this;if(this.viewModel){if(d.load(this.viewModel.icon,p,(function(i,r){e.upgradeFromSprite.spriteFrame=r})),d.load(this.viewModel.nextLevelIcon,p,(function(i,r){e.upgradeToSprite.spriteFrame=r})),this.moneyBarNode){var i=this.moneyBarNode.getComponent(s);i&&(i.init(this.viewModel.cost),i.showPriceLabel(!0))}}else console.error("ViewModel is not bound")},n.onUpgrade=function(){this.viewModel.upgrade()},n.onClose=function(){this.viewModel&&this.viewModel.close()},i}(c)).prototype,"upgradeFromSprite",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),M=i(y.prototype,"upgradeToSprite",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),m=i(y.prototype,"moneyBarNode",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),h=y))||h));n._RF.pop()}}}));

System.register("chunks:///_virtual/BuildingUpgradeViewModel.ts",["./rollupPluginModLoBabelHelpers.js","cc","./StaticConfigStore.ts","./UserService.ts","./MessageFlyer.ts"],(function(i){var e,n,t,o,s;return{setters:[function(i){e=i.createClass},function(i){n=i.cclegacy},function(i){t=i.StaticConfigStore},function(i){o=i.UserService},function(i){s=i.MessageFlyer}],execute:function(){n._RF.push({},"4ac27l89DFLG55QuXmtG8aO","BuildingUpgradeViewModel",void 0);i("BuildingUpgradeViewModel",function(){function i(i,e){void 0===e&&(e=null),this.model=void 0,this.buildingInstanceId=void 0,this.onDispose=null,this.model=i,this.buildingInstanceId=e}var n=i.prototype;return n.bindView=function(i){this.onDispose=i},n.upgrade=function(){if(null!==this.buildingInstanceId){var i=o.getInstance();if(!i.buildingService.canUpgrade(this.model))return console.error("Not enough currency to upgrade building "+this.model.id),void s.create("Not enough currency to upgrade building!");if(i.buildingService.upgrade(this.buildingInstanceId,this.model)){var e=i.buildingService.getBuildingLevel(this.buildingInstanceId);console.log("Upgraded building "+this.model.id+" to level "+e),this.dispose()}else console.error("Upgrade failed for building "+this.model.id)}else console.error("Building instance id is missing")},n.testSwapUpgradedModel=function(){if(null!==this.buildingInstanceId){var i=this.model.nextLevelBuildingId;if(i){var e=t.getBuildingConfigById(i);if(e){var n=o.getInstance();n.buildingService.setBuildingConfigId(this.buildingInstanceId,i),n.buildingService.setBuildingLevel(this.buildingInstanceId,n.buildingService.getBuildingLevel(this.buildingInstanceId)+1),this.model=e,console.log("Swapped building instance "+this.buildingInstanceId+" to "+i)}else console.error("Missing config for upgraded building "+i)}else console.error("No upgrade available for building "+this.model.id)}else console.error("Building instance id is missing")},n.dispose=function(){if(this.onDispose){var i=this.onDispose;this.onDispose=null,i()}},n.close=function(){this.dispose()},e(i,[{key:"title",get:function(){return this.model.message}},{key:"icon",get:function(){return this.model.buildingIcon}},{key:"nextLevelIcon",get:function(){var i=t.getBuildingConfigById(this.model.nextLevelBuildingId);return i?i.buildingIcon:"No upgrade available"}},{key:"cost",get:function(){return this.model.upgradeCost}},{key:"costLabel",get:function(){var i=this.model.upgradeCost.money.filter((function(i){return i.amount>0})).map((function(i){return i.type+" "+i.amount}));return i.length>0?"Cost "+i.join(", "):"Cost free"}}]),i}());n._RF.pop()}}}));

System.register("chunks:///_virtual/BuildingView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./BuildingNameView.ts"],(function(t){var n,o,i,e,s,h,l,c,a,r,u,d,v;return{setters:[function(t){n=t.inheritsLoose},function(t){o=t.cclegacy,i=t._decorator,e=t.instantiate,s=t.Button,h=t.Node,l=t.UITransform,c=t.ScrollView,a=t.Sprite,r=t.resources,u=t.SpriteFrame,d=t.Component},function(t){v=t.BuildingNameView}],execute:function(){var p;o._RF.push({},"bbc14l9qqRBVbGn2Rcm5QEL","BuildingView",void 0);var C=i.ccclass;i.property,t("BuildingView",C("BuildingView")(p=function(t){function o(){for(var n,o=arguments.length,i=new Array(o),e=0;e<o;e++)i[e]=arguments[e];return(n=t.call.apply(t,[this].concat(i))||this).viewModel=null,n.buildingNameView=null,n.touchStartPos=null,n.touchMoved=!1,n.dragThresholdSq=100,n.activeScroll=null,n.startContentPos=null,n}n(o,t);var i=o.prototype;return i.setNamePrefab=function(t){if(t){var n=e(t);this.node.addChild(n),this.buildingNameView=n.getComponent(v)}},i.onEnable=function(){(this.getComponent(s)||this.addComponent(s)).node.on(s.EventType.CLICK,this.onClick,this),this.node.on(h.EventType.TOUCH_START,this.onTouchStart,this),this.node.on(h.EventType.TOUCH_MOVE,this.onTouchMove,this),this.node.on(h.EventType.TOUCH_END,this.onTouchEnd,this),this.node.on(h.EventType.TOUCH_CANCEL,this.onTouchEnd,this)},i.onDisable=function(){var t=this.getComponent(s);t&&t.node.off(s.EventType.CLICK,this.onClick,this),this.node.off(h.EventType.TOUCH_START,this.onTouchStart,this),this.node.off(h.EventType.TOUCH_MOVE,this.onTouchMove,this),this.node.off(h.EventType.TOUCH_END,this.onTouchEnd,this),this.node.off(h.EventType.TOUCH_CANCEL,this.onTouchEnd,this)},i.bind=function(t){this.updateView(t)},i.updateView=function(t){this.viewModel=t,this.viewModel.bindView(this);var n=this.getComponent(l)||this.addComponent(l),o=n.contentSize;0!==o.width&&0!==o.height||n.setContentSize(80,80),(this.getComponent(s)||this.addComponent(s)).transition=s.Transition.COLOR},i.onClick=function(){var t;console.log("BuildingView clicked"),null==(t=this.viewModel)||t.handleClick()},i.onTouchStart=function(t){var n,o,i=t.getLocation();this.touchStartPos={x:i.x,y:i.y},this.touchMoved=!1,this.activeScroll=this.findParentScrollView();var e=null!=(n=null==(o=this.activeScroll)?void 0:o.content)?n:null;this.startContentPos=e?e.position.clone():null;var h=this.getComponent(s);h&&(h.interactable=!0)},i.onTouchMove=function(t){if(this.touchStartPos&&!this.touchMoved){var n=t.getLocation(),o=n.x-this.touchStartPos.x,i=n.y-this.touchStartPos.y;if(o*o+i*i>=this.dragThresholdSq){this.touchMoved=!0;var e=this.getComponent(s);e&&(e.interactable=!1)}}},i.onTouchEnd=function(t){!this.touchMoved&&this.activeScroll&&this.startContentPos&&this.activeScroll.content&&(this.activeScroll.stopAutoScroll(),this.activeScroll.content.setPosition(this.startContentPos));var n=this.getComponent(s);n&&(n.interactable=!0),this.touchStartPos=null,this.activeScroll=null,this.startContentPos=null},i.findParentScrollView=function(){for(var t=this.node;t;){var n=t.getComponent(c);if(n)return n;t=t.parent}return null},i.setImagePath=function(t){console.log("Rendering building with image:",t);var n=this.getComponent(a)||this.addComponent(a);r.load(t,u,(function(t,o){t?console.error("Failed to load building image:",t):null!=n&&(n.spriteFrame=o)}))},i.setName=function(t){this.buildingNameView&&this.buildingNameView.setBuildingName(t)},o}(d))||p);o._RF.pop()}}}));

System.register("chunks:///_virtual/BuildingViewModel.ts",["./rollupPluginModLoBabelHelpers.js","cc","./BuildingUpgradeView.ts","./BuildingUpgradeViewModel.ts","./TownhallShopView.ts","./TownhallShopViewModel.ts","./ResourceProductionWindowView.ts","./ResourceProductionVM.ts","./EventBus.ts","./WindowManager.ts","./PrepareBattleView.ts","./PrepareBattleVM.ts","./MessageFlyer.ts","./UserService.ts"],(function(e){var i,n,t,o,s,l,d,a,r,u,c,g,w,h,f;return{setters:[function(e){i=e.createClass},function(e){n=e.cclegacy},function(e){t=e.BuildingUpgradeView},function(e){o=e.BuildingUpgradeViewModel},function(e){s=e.TownhallShopView},function(e){l=e.TownhallShopViewModel},function(e){d=e.ResourceProductionWindow},function(e){a=e.ResourceProductionVM},function(e){r=e.bus,u=e.Events},function(e){c=e.WindowManager},function(e){g=e.PrepareBattleView},function(e){w=e.PrepareBattleVM},function(e){h=e.MessageFlyer},function(e){f=e.UserService}],execute:function(){n._RF.push({},"a59d4sKfslD5LFVapRXo+yt","BuildingViewModel",void 0);e("BuildingViewModel",function(){function e(e,i){var n=this;void 0===i&&(i=null),this.model=void 0,this.buildingInstanceId=void 0,this.view=null,this.upgradeBuildingEvet=function(e){var i,t;console.log("Received building upgrade event for id:",n.buildingInstanceId,"newBuildingId:",e.newBuilding.id),n.buildingInstanceId===e.id&&(n.model=e.newBuilding,console.log(n.view),null==(i=n.view)||i.setImagePath(n.image),null==(t=n.view)||t.setName(n.model.message))},this.model=e,this.buildingInstanceId=i,r.on(u.BUILDING_UPGRADE,this.upgradeBuildingEvet)}var n=e.prototype;return n.bindView=function(e){this.view=e,this.view.setImagePath(this.image),this.view.setName(this.model.message)},n.handleClick=function(){if(console.log(this.model.message),"TownHall"!==this.model.kind)if("OilFactory"!==this.model.kind)if("Arena"!==this.model.kind)this.showUpgradeWidget();else{var e=f.getInstance().itemsService;if(!Object.values(e.getAll()).some((function(e){return e>0})))return void h.create("Buy combotants in Townhall first");var i=c.getInstance().createWindow(g);if(!i)return void console.error("[PlayerBase] PrepareBattleView is missing on prefab");var n=new w;i.bind(n)}else this.showResourceProduction();else this.showTownhallShop()},n.showUpgradeWidget=function(){var e=c.getInstance().createWindow(t),i=new o(this.model,this.buildingInstanceId);null==e||e.bind(i)},n.showTownhallShop=function(){var e=c.getInstance().createWindow(s),i=new l;null==e||e.bind(i)},n.showResourceProduction=function(){if(null!==this.buildingInstanceId){var e=c.getInstance().createWindow(d);if(e){var i=new a;e.bind(i),i.init(this.buildingInstanceId)}}else console.error("[BuildingViewModel] Building instance id is not set")},n.destroy=function(){r.off(u.BUILDING_UPGRADE,this.upgradeBuildingEvet)},i(e,[{key:"image",get:function(){return this.model.buildingImage}}]),e}());n._RF.pop()}}}));

System.register("chunks:///_virtual/BulletShotAbil.ts",["./rollupPluginModLoBabelHelpers.js","cc","./BaseAbil.ts","./BattleStateMachine.ts","./CommonBattle.ts"],(function(t){var e,i,a,n,o;return{setters:[function(t){e=t.inheritsLoose},function(t){i=t.cclegacy},function(t){a=t.BaseAbil},function(t){n=t.BattleUnitState},function(t){o=t.randomDamage}],execute:function(){i._RF.push({},"d84ebexy7dI9IGmAZuXCUhD","BulletShotAbil",void 0);t("BulletShotAbil",function(t){function i(e,i,a,n){var o;return(o=t.call(this,e,i,a,n)||this).timeout=void 0,o.dmgRange=void 0,o.target=void 0,o.owner=void 0,o.range_for_attack=void 0,o.remainTimeout=void 0,o.timeout=e.timeout,o.dmgRange=o.normalizeDamageRange(e.dmg),o.target=n.getEnemyAtLine(i),o.owner=i,o.range_for_attack=e.range_for_attack,"ticked"in e?(o.remainTimeout=o.timeout-e.ticked,console.log("TICKED! "+o.remainTimeout)):o.remainTimeout=o.timeout,o}e(i,t);var a=i.prototype;return a.tick=function(e,i){(t.prototype.tick.call(this,e,i),this.remainTimeout-=e,this.remainTimeout<=0&&null!=this.target&&this.target.stateMachine.getState()!==n.Dead)&&(Math.abs(this.owner.position-this.target.position)<this.range_for_attack&&(this.battleLog.addBulletShotEvent(i,this.owner.battleUnitId,this.target.battleUnitId),this.target.applyDamage(this.owner,o(this.dmgRange)),this.remainTimeout=this.timeout))},a.normalizeDamageRange=function(t){if(Array.isArray(t)&&t.length>=2)return[Number(t[0])||0,Number(t[1])||0];var e=Number(t)||0;return[e,e]},i}(a));i._RF.pop()}}}));

System.register("chunks:///_virtual/BulletShotView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./CommonBattle.ts"],(function(t){var o,e,n,i,s,r;return{setters:[function(t){o=t.inheritsLoose},function(t){e=t.cclegacy,n=t._decorator,i=t.tween,s=t.Component},function(t){r=t.randomRange}],execute:function(){var u;e._RF.push({},"350225nE9pAZbus9Plm8w+k","BulletShotView",void 0);var c=n.ccclass;n.property,t("BulletShotView",c("BulletShotView")(u=function(t){function e(){return t.apply(this,arguments)||this}return o(e,t),e.prototype.init=function(t,o){var e=this,n=t.node.getPosition();this.node.setPosition(n);var s=o.getPosition();s.y+=r(-30,30),i(this.node).to(.3,{position:s}).call((function(){e.node.destroy()})).start()},e}(s))||u);e._RF.pop()}}}));

System.register("chunks:///_virtual/CocosJsonDataLoader.ts",["cc"],(function(o){var n,t,s;return{setters:[function(o){n=o.cclegacy,t=o.resources,s=o.JsonAsset}],execute:function(){n._RF.push({},"f6866KogjhJWIN59nv58xHV","CocosJsonDataLoader",void 0);o("CocosJsonDataLoader",function(){function o(){}return o.prototype.loadJson=function(o){return new Promise((function(n,e){t.load(o,s,(function(t,s){if(!t&&s){var r=s.json;n("string"==typeof r?r:JSON.stringify(r))}else e(null!=t?t:new Error("Missing JSON asset at "+o))}))}))},o}());n._RF.pop()}}}));

System.register("chunks:///_virtual/CommonBattle.ts",["cc"],(function(t){var n;return{setters:[function(t){n=t.cclegacy}],execute:function(){t({randomDamage:function(t){var n=Math.min(t[0],t[1]),a=Math.max(t[0],t[1]);return e(n,a)},randomRange:e}),n._RF.push({},"b163fKyix9ANrXMcCrvqv8G","CommonBattle",void 0);t("BattleTeam",function(t){return t[t.Team1=1]="Team1",t[t.Team2=2]="Team2",t}({}));function e(t,n){return t+Math.random()*(n-t)}n._RF.pop()}}}));

System.register("chunks:///_virtual/EnemyBlock.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var n,t,r,i,o,c,l,a;return{setters:[function(e){n=e.applyDecoratedDescriptor,t=e.inheritsLoose,r=e.initializerDefineProperty,i=e.assertThisInitialized},function(e){o=e.cclegacy,c=e._decorator,l=e.Sprite,a=e.Component}],execute:function(){var u,p,y,s,f,m;o._RF.push({},"2be8dvX6ZlOfqvYc5Ji8rxk","EnemyBlock",void 0);var v=c.ccclass,b=c.property,k=(e("EnemyBlock",(u=v("EnemyBlock"),p=b({type:l}),u((f=n((s=function(e){function n(){for(var n,t=arguments.length,o=new Array(t),c=0;c<t;c++)o[c]=arguments[c];return n=e.call.apply(e,[this].concat(o))||this,r(n,"enemyType",f,i(n)),r(n,"BlockSprite",m,i(n)),n}t(n,e);var o=n.prototype;return o.start=function(){},o.update=function(e){},n}(a)).prototype,"enemyType",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return k.Enemy}}),m=n(s.prototype,"BlockSprite",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),y=s))||y)),e("EnemyType",function(e){return e[e.Enemy=0]="Enemy",e[e.Ally=1]="Ally",e}({})));o._RF.pop()}}}));

System.register("chunks:///_virtual/EventBus.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var t,r;return{setters:[function(e){t=e.createForOfIteratorHelperLoose},function(e){r=e.cclegacy}],execute:function(){r._RF.push({},"afa5dVSR/pF3Y+liRZt9FZv","EventBus",void 0);var n=function(){function e(){this.listeners=new Map}var r=e.prototype;return r.on=function(e,t,r){var n,i=null!=(n=this.listeners.get(e))?n:[];i.push({callback:t,target:r}),this.listeners.set(e,i)},r.off=function(e,t,r){var n=this.listeners.get(e);if(n){var i=n.filter((function(e){return e.callback!==t||void 0!==r&&e.target!==r}));0===i.length?this.listeners.delete(e):this.listeners.set(e,i)}},r.emit=function(e){var r=this.listeners.get(e);if(r){for(var n=arguments.length,i=new Array(n>1?n-1:0),s=1;s<n;s++)i[s-1]=arguments[s];for(var a,u=t(r);!(a=u()).done;){var l=a.value;l.callback.apply(l.target,i)}}},e}();e("bus",new(function(){var e=globalThis.cc;if(null!=e&&e.EventTarget)return e.EventTarget;if("function"==typeof require)try{var t=require("cc");if(t.EventTarget)return t.EventTarget}catch(e){}return n}())),e("Events",{BUILDING_UPGRADE:"building/upgrade",BUILDING_UPGRADE_SUCCESS:"building/upgrade-success",WALLET_CHANGED:"wallet/changed",RESOURCE_PRODUCTED:"resource/produced"});r._RF.pop()}}}));

System.register("chunks:///_virtual/GameCode.ts",["./rollupPluginModLoBabelHelpers.js","cc","./EnemyBlock.ts","./CocosJsonDataLoader.ts","./StaticConfigStore.ts"],(function(e){var t,n,i,r,l,a,o,s,u,c,p,h,f,y,m,d,B,g,C,b,v,S,w,T,P,z,E,R,k,D,O,A,_;return{setters:[function(e){t=e.applyDecoratedDescriptor,n=e.inheritsLoose,i=e.initializerDefineProperty,r=e.assertThisInitialized,l=e.asyncToGenerator,a=e.regeneratorRuntime},function(e){o=e.cclegacy,s=e._decorator,u=e.Node,c=e.Prefab,p=e.Button,h=e.SpriteFrame,f=e.Sprite,y=e.instantiate,m=e.tween,d=e.Vec3,B=e.assetManager,g=e.Texture2D,C=e.KeyCode,b=e.view,v=e.UITransform,S=e.Collider2D,w=e.Contact2DType,T=e.RigidBody2D,P=e.ERigidBody2DType,z=e.randomRange,E=e.Component,R=e.input,k=e.Input},function(e){D=e.EnemyType,O=e.EnemyBlock},function(e){A=e.CocosJsonDataLoader},function(e){_=e.StaticConfigStore}],execute:function(){var G,N,F,I,x,L,H,K,M,V,W,Y,J,U,j,q,Q,X,Z,$,ee;o._RF.push({},"416f2qSeYdDYro2Wi1uiVoF","GameCode",void 0);var te=s.ccclass,ne=s.property;e("GameCode",(G=te("GameCode"),N=ne({type:u}),F=ne({type:c}),I=ne({type:c}),x=ne({type:c}),L=ne({type:p}),H=ne({type:u}),K=ne({type:h}),M=ne({type:f}),G((Y=t((W=function(e){function t(){for(var t,n=arguments.length,l=new Array(n),a=0;a<n;a++)l[a]=arguments[a];return t=e.call.apply(e,[this].concat(l))||this,i(t,"canvas",Y,r(t)),i(t,"level",J,r(t)),i(t,"enemyBall",U,r(t)),i(t,"allyBall",j,r(t)),i(t,"startGameButton",q,r(t)),i(t,"stickNode",Q,r(t)),i(t,"allyBallSprite",X,r(t)),i(t,"lennaImage",Z,r(t)),i(t,"ballSpeed",$,r(t)),i(t,"ballStrafeSpeed",ee,r(t)),t.currentBall=null,t}n(t,e);var o=t.prototype;return o.start=function(){var e=l(a().mark((function e(){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return _.setDataLoader(new A),e.next=3,_.init();case 3:R.on(k.EventType.KEY_PRESSING,this.OnKeyPressing,this),R.on(k.EventType.TOUCH_MOVE,this.OnTouchMove,this);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),o.onStartGame=function(){var e=this;this.startGameButton.node.removeFromParent();var t=y(this.level);this.canvas.addChild(t),m(this.stickNode).repeatForever(m().by(4,{eulerAngles:new d(360,360,360)},{easing:"linear"})).start();B.loadRemote("https://upload.wikimedia.org/wikipedia/en/7/7d/Lenna_%28test_image%29.png",(function(t,n){if(t)console.error("Image load error",t);else{var i=new g;i.image=n;var r=new h;r.texture=i,e.lennaImage.spriteFrame=r}})),this.spawnRandomAttackingBall()},o.OnTouchMove=function(e){if(null!=this.currentBall){var t=e.getDelta(),n=this.currentBall.getPosition();this.currentBall.setPosition(n.x+t.x,n.y,n.z)}},o.OnKeyPressing=function(e){if(null!=this.currentBall){var t=this.currentBall.getPosition();e.keyCode===C.ARROW_LEFT&&this.currentBall.setPosition(t.x-this.ballStrafeSpeed,t.y,t.z),e.keyCode===C.ARROW_RIGHT&&this.currentBall.setPosition(t.x+this.ballStrafeSpeed,t.y,t.z)}},o.spawnRandomAttackingBall=function(){if(this.enemyBall&&this.canvas){this.currentBall=y(this.enemyBall),this.canvas.addChild(this.currentBall);var e=b.getVisibleSize(),t=this.currentBall.getComponent(v),n=t?t.contentSize.height:0,i=-e.height/2+n/2;this.currentBall.setPosition(0,i,0);var r=this.currentBall.getComponent(S);r&&(r.on(w.BEGIN_CONTACT,this.onBeginContact,this),r.on(w.END_CONTACT,this.onEndContact,this)),this.currentBall.getComponent(T).type=P.Dynamic;var l=z(0,1)>.3?D.Ally:D.Enemy;this.currentBall.getComponent(O).enemyType=l,l==D.Ally&&(this.currentBall.getComponent(O).BlockSprite.spriteFrame=this.allyBallSprite)}},o.onBeginContact=function(e,t,n){var i=this;if(null!=this.currentBall&&(e.node==this.currentBall||t.node==this.currentBall)){var r=this.currentBall.getComponent(O).enemyType,l=t.node.getComponent(O).enemyType;if(r==D.Ally&&l==D.Enemy)this.scheduleOnce((function(){t.node.removeFromParent(),e.node.removeFromParent(),i.spawnRandomAttackingBall()}),.001),this.currentBall=null;else this.currentBall.getComponent(T).type=P.Kinematic,this.spawnRandomAttackingBall()}},o.onEndContact=function(e,t,n){},o.onDestroy=function(){this.unregisetrterBallCollisionHandlers()},o.unregisetrterBallCollisionHandlers=function(){if(this.currentBall){var e=this.currentBall.getComponent(S);e&&(e.off(w.BEGIN_CONTACT,this.onBeginContact,this),e.off(w.END_CONTACT,this.onEndContact,this))}},o.updateBallPosition=function(e){if(this.currentBall){var t=this.ballSpeed*e,n=this.currentBall.getPosition();n.y+=t,this.currentBall.setPosition(n)}},o.handleBallOutOfBounds=function(){if(this.currentBall){var e=b.getVisibleSize(),t=this.currentBall.getComponent(v),n=t?t.contentSize.height:0;this.currentBall.getPosition().y-n/2>e.height/2&&(this.unregisetrterBallCollisionHandlers(),this.currentBall.removeFromParent(),this.currentBall=null,this.spawnRandomAttackingBall())}},o.update=function(e){this.updateBallPosition(e),this.handleBallOutOfBounds()},t}(E)).prototype,"canvas",[N],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),J=t(W.prototype,"level",[F],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),U=t(W.prototype,"enemyBall",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),j=t(W.prototype,"allyBall",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),q=t(W.prototype,"startGameButton",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Q=t(W.prototype,"stickNode",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),X=t(W.prototype,"allyBallSprite",[K],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Z=t(W.prototype,"lennaImage",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),$=t(W.prototype,"ballSpeed",[ne],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 100}}),ee=t(W.prototype,"ballStrafeSpeed",[ne],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 10}}),V=W))||V));o._RF.pop()}}}));

System.register("chunks:///_virtual/IDataLoader.ts",["cc"],(function(){var e;return{setters:[function(t){e=t.cclegacy}],execute:function(){e._RF.push({},"a8bceWM62JLVpJOE1qgoeu9","IDataLoader",void 0),e._RF.pop()}}}));

System.register("chunks:///_virtual/ItemsService.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ServerChecker.ts","./StaticConfigStore.ts","./UserService.ts"],(function(e){var t,r,o,n,i;return{setters:[function(e){t=e.createForOfIteratorHelperLoose},function(e){r=e.cclegacy},function(e){o=e.ServerChecker},function(e){n=e.StaticConfigStore},function(e){i=e.UserService}],execute:function(){r._RF.push({},"7d9f35yTSNF4Y7oeohWmJYS","ItemsService",void 0);e("ItemsService",function(){function e(){this.items=new Map}var r=e.prototype;return r.setItems=function(e){if(this.items.clear(),e)for(var t=0,r=Object.entries(e);t<r.length;t++){var o=r[t],n=o[0],i=o[1];if(n){var c=Math.max(0,Math.floor(Number(i)||0));c>0&&this.items.set(n,c)}}},r.addItem=function(e,t){var r=this;void 0===t&&(t=1);return function(e,t){var o;if(void 0===t&&(t=1),!e)return!1;var n=Math.max(1,Math.floor(t)),i=null!=(o=r.items.get(e))?o:0;return r.items.set(e,i+n),console.log(r.items),!0}(e,t)},r.buyItem=function(e,t){var r=this;void 0===t&&(t=1);var c=function(e,t){void 0===t&&(t=1);var o=i.getInstance().walletService,c=n.getProductionById(e);return c?o.spend(c.cost)?r.addItem(e,t):(console.error("[ItemsService] Spend failed for "+e),!1):(console.error("[TownhallShop] Production config not found for "+e),!1)}(e,t);return o.check("ItemsService.buyItem",c,e,t),c},r.getCount=function(e){var t;return null!=(t=this.items.get(e))?t:0},r.getAll=function(){for(var e,r={},o=t(this.items);!(e=o()).done;){var n=e.value,i=n[0],c=n[1];r[i]=c}return r},e}());r._RF.pop()}}}));

System.register("chunks:///_virtual/main",["./CocosJsonDataLoader.ts","./EventBus.ts","./IDataLoader.ts","./NativeJsonDataLoader.ts","./BaseAbil.ts","./BombAbil.ts","./BulletShotAbil.ts","./BattleLog.ts","./BattleLogic.ts","./BattleStarter.ts","./BattleStateMachine.ts","./BattleUnit.ts","./Battleground.ts","./CommonBattle.ts","./BattleBombView.ts","./BattleManager.ts","./BattleUnitView.ts","./BattleViewCommon.ts","./BulletShotView.ts","./GameCode.ts","./BildingName.ts","./BuildingContracts.ts","./BuildingNameView.ts","./BuildingView.ts","./BuildingViewModel.ts","./StaticConfigModels.ts","./StaticConfigStore.ts","./PlayerBase.ts","./PlayerBaseModels.ts","./PlayerBaseViewModel.ts","./ResourceProductionContracts.ts","./ResourceProductionItemView.ts","./ResourceProductionItemViewModel.ts","./ResourceProductionVM.ts","./ResourceProductionWindowView.ts","./MoneyBar.ts","./MoneyIconView.ts","./UserMoneyBar.ts","./MessageFlyer.ts","./PrepareBattleContracts.ts","./PrepareBattleItemContracts.ts","./PrepareBattleItemVM.ts","./PrepareBattleItemView.ts","./PrepareBattleVM.ts","./PrepareBattleView.ts","./TownhallShopContracts.ts","./TownhallShopItem.ts","./TownhallShopView.ts","./TownhallShopViewModel.ts","./BuildingUpgradeView.ts","./BuildingUpgradeViewModel.ts","./WindowManager.ts","./WindowView.ts","./BattleService.ts","./BuildingService.ts","./ItemsService.ts","./ProductionService.ts","./UserModels.ts","./UserService.ts","./WalletService.ts","./MethodBindings.ts","./ServerChecker.ts","./StartGameButton.ts","./EnemyBlock.ts"],(function(){return{setters:[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],execute:function(){}}}));

System.register("chunks:///_virtual/MessageFlyer.ts",["./rollupPluginModLoBabelHelpers.js","cc","./WindowManager.ts"],(function(e){var t,n,i,r,a,o,s,l,c,u,p,g;return{setters:[function(e){t=e.applyDecoratedDescriptor,n=e.inheritsLoose,i=e.initializerDefineProperty,r=e.assertThisInitialized},function(e){a=e.cclegacy,o=e._decorator,s=e.Label,l=e.find,c=e.UITransform,u=e.tween,p=e.Component},function(e){g=e.WindowManager}],execute:function(){var f,y,h,d,v;a._RF.push({},"13fe3Doh59PV7Oq+Z8YR1FP","MessageFlyer",void 0);var b=o.ccclass,m=o.property;e("MessageFlyer",(f=b("MessageFlyer"),y=m({type:s}),f((v=t((d=function(e){function t(){for(var t,n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];return t=e.call.apply(e,[this].concat(a))||this,i(t,"messageLabel",v,r(t)),t}return n(t,e),t.create=function(e){var n=g.getInstance().createWindow(t);null==n||n.init(e)},t.prototype.init=function(e){var t,n=this;null!=this.messageLabel&&(this.messageLabel.string=e);var i=((null==(t=l("Canvas"))||null==(t=t.getComponent(c))?void 0:t.contentSize.height)||1080)/3,r=this.node.getPosition();r.y+=i,u(this.node).to(2,{position:r}).parallel().call((function(){n.node.destroy()})).start()},t}(p)).prototype,"messageLabel",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),h=d))||h));a._RF.pop()}}}));

System.register("chunks:///_virtual/MethodBindings.ts",["./rollupPluginModLoBabelHelpers.js","cc","./UserService.ts"],(function(e){var r,n,t,i;return{setters:[function(e){r=e.asyncToGenerator,n=e.regeneratorRuntime},function(e){t=e.cclegacy},function(e){i=e.UserService}],execute:function(){e("invokeBoundMethod",(function(e,r,n){return o.apply(this,arguments)})),t._RF.push({},"6832dvSnHRF+I04uI6L/YEx","MethodBindings",void 0);var s=e("METHOD_BINDINGS",{"ItemsService.addItem":i.getInstance().itemsService.addItem.bind(i.getInstance().itemsService),"ItemsService.buyItem":i.getInstance().itemsService.buyItem.bind(i.getInstance().itemsService)});function o(){return(o=r(n().mark((function e(r,t,o){var c,a,u,d,l,f;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c=s[r]){e.next=4;break}throw console.error("[MethodBindings] Unknown method: "+r),new Error("Unknown method: "+r);case 4:if(a=o?JSON.parse(o):[],Array.isArray(a)){e.next=8;break}throw console.error("[MethodBindings] Invalid args for "+r+":",o),new Error("Invalid args");case 8:return e.next=10,c.apply(void 0,a);case 10:if(u=e.sent,d="[MethodBindings] Call for "+r+". Results for client="+JSON.stringify(t)+", server="+JSON.stringify(u),null==t){e.next=20;break}if(l=JSON.parse(t),i.getInstance().printState(),console.log(d),u===l){e.next=20;break}throw f="[MethodBindings] Result mismatch for "+r+": client="+JSON.stringify(l)+", server="+JSON.stringify(u),console.error(f),new Error(f);case 20:return e.abrupt("return",u);case 21:case"end":return e.stop()}}),e)})))).apply(this,arguments)}t._RF.pop()}}}));

System.register("chunks:///_virtual/MoneyBar.ts",["./rollupPluginModLoBabelHelpers.js","cc","./MoneyIconView.ts"],(function(e){var n,t,r,i,o,a,l,c,s,u,p,f,y;return{setters:[function(e){n=e.applyDecoratedDescriptor,t=e.inheritsLoose,r=e.initializerDefineProperty,i=e.assertThisInitialized,o=e.createForOfIteratorHelperLoose},function(e){a=e.cclegacy,l=e._decorator,c=e.Prefab,s=e.Node,u=e.Label,p=e.instantiate,f=e.Component},function(e){y=e.MoneyIconView}],execute:function(){var b,h,m,d,v,L,I,g,M;a._RF.push({},"23a45F7dihONIapDx21TI7G","MoneyBar",void 0);var P=l.ccclass,w=l.property;e("MoneyBar",(b=P("MoneyBar"),h=w({type:c}),m=w({type:s}),d=w({type:u}),b((I=n((L=function(e){function n(){for(var n,t=arguments.length,o=new Array(t),a=0;a<t;a++)o[a]=arguments[a];return n=e.call.apply(e,[this].concat(o))||this,r(n,"moneyItemPrefab",I,i(n)),r(n,"content",g,i(n)),r(n,"priceLabel",M,i(n)),n}t(n,e);var a=n.prototype;return a.init=function(e){var n;console.log("[MoneyBar] Initializing with price:",e);var t=null!=(n=this.content)?n:this.node,r=this.priceLabel;if(t.removeAllChildren(),t.addChild(r.node),this.priceLabel.node.active=!1,this.moneyItemPrefab)for(var i,a=this.collectEntries(e),l=o(a);!(i=l()).done;){var c=i.value,s=p(this.moneyItemPrefab);t.addChild(s);var u=s.getComponent(y);u?u.init(c):console.error("[MoneyBar] MoneyIconView component is missing on item prefab")}else console.error("[MoneyBar] moneyItemPrefab is not set")},a.showPriceLabel=function(e){this.priceLabel&&(this.priceLabel.node.active=e)},a.setPriceLabelText=function(e){this.priceLabel&&(this.priceLabel.string=e)},a.collectEntries=function(e){return e.money.filter((function(e){return e.amount>0}))},n}(f)).prototype,"moneyItemPrefab",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),g=n(L.prototype,"content",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),M=n(L.prototype,"priceLabel",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),v=L))||v));a._RF.pop()}}}));

System.register("chunks:///_virtual/MoneyIconView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./StaticConfigStore.ts"],(function(e){var t,n,i,r,o,a,c,l,u,p,s,f;return{setters:[function(e){t=e.applyDecoratedDescriptor,n=e.inheritsLoose,i=e.initializerDefineProperty,r=e.assertThisInitialized},function(e){o=e.cclegacy,a=e._decorator,c=e.Label,l=e.Sprite,u=e.resources,p=e.SpriteFrame,s=e.Component},function(e){f=e.StaticConfigStore}],execute:function(){var y,S,b,g,m,h,d;o._RF.push({},"57fb9gCSiZG7qEGNG9/InVx","MoneyIconView",void 0);var v=a.ccclass,w=a.property;e("MoneyIconView",(y=v("MoneyIconView"),S=w({type:c}),b=w({type:l}),y((h=t((m=function(e){function t(){for(var t,n=arguments.length,o=new Array(n),a=0;a<n;a++)o[a]=arguments[a];return t=e.call.apply(e,[this].concat(o))||this,i(t,"amountLabel",h,r(t)),i(t,"iconSprite",d,r(t)),t}return n(t,e),t.prototype.init=function(e){var t=this;this.amountLabel&&(this.amountLabel.string=String(e.amount));var n=f.getCurrencyIconByName(e.type);n&&this.iconSprite&&u.load(n,p,(function(e,i){e?console.error("[MoneyIconView] icon load failed for "+n,e):t.iconSprite&&(t.iconSprite.spriteFrame=i)}))},t}(s)).prototype,"amountLabel",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),d=t(m.prototype,"iconSprite",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),g=m))||g));o._RF.pop()}}}));

System.register("chunks:///_virtual/NativeJsonDataLoader.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var t,r,n;return{setters:[function(e){t=e.asyncToGenerator,r=e.regeneratorRuntime},function(e){n=e.cclegacy}],execute:function(){n._RF.push({},"39c48j5I6NJxoEy3onLxDz9","NativeJsonDataLoader",void 0);e("NativeJsonDataLoader",function(){function e(){this.basePath=null}var n=e.prototype;return n.setBasePath=function(e){this.basePath=e},n.loadJson=function(){var e=t(r().mark((function e(t){var n,a,o,s,i,u,c,f;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=this.basePath&&(t=this.basePath+"/"+t+".json",console.log("[NativeJsonDataLoader] Loading JSON from",t)),!("undefined"!=typeof process&&!(null==(n=process.versions)||!n.node))){e.next=12;break}if(a=Function('return typeof require !== "undefined" ? require : undefined')()){e.next=6;break}throw new Error("NativeJsonDataLoader requires require().");case 6:return"fs/promises","node:url",o=a("fs/promises"),s=o.readFile,i=a("node:url"),u=i.fileURLToPath,c=t.startsWith("file://")?u(t):t,e.abrupt("return",s(c,"utf-8"));case 12:return e.next=14,fetch(t);case 14:if((f=e.sent).ok){e.next=17;break}throw new Error("Failed to load JSON at "+t+" (status "+f.status+")");case 17:return e.abrupt("return",f.text());case 18:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),e}());n._RF.pop()}}}));

System.register("chunks:///_virtual/PlayerBase.ts",["./rollupPluginModLoBabelHelpers.js","cc","./CocosJsonDataLoader.ts","./BuildingView.ts","./StaticConfigStore.ts","./UserService.ts","./PlayerBaseViewModel.ts","./BuildingViewModel.ts","./PrepareBattleView.ts","./PrepareBattleVM.ts","./MoneyBar.ts","./WindowManager.ts"],(function(t){var e,n,i,o,r,a,l,s,u,c,h,d,f,p,g,b,m,y,v,C,S,w,T,P,R,B,M,x,D,E,U,I;return{setters:[function(t){e=t.applyDecoratedDescriptor,n=t.inheritsLoose,i=t.initializerDefineProperty,o=t.assertThisInitialized,r=t.createForOfIteratorHelperLoose,a=t.asyncToGenerator,l=t.regeneratorRuntime},function(t){s=t.cclegacy,u=t._decorator,c=t.SpriteFrame,h=t.Node,d=t.Prefab,f=t.ScrollView,p=t.resources,g=t.JsonAsset,b=t.assetManager,m=t.Layers,y=t.UITransform,v=t.Sprite,C=t.Vec3,S=t.Vec2,w=t.Component},function(t){T=t.CocosJsonDataLoader},function(t){P=t.BuildingView},function(t){R=t.StaticConfigStore},function(t){B=t.UserService},function(t){M=t.PlayerBaseViewModel},function(t){x=t.BuildingViewModel},function(t){D=t.PrepareBattleView},function(t){E=t.PrepareBattleVM},function(t){U=t.MoneyBar},function(t){I=t.WindowManager}],execute:function(){var N,z,A,O,_,L,V,Z,W,F,H,G,J,j,k,q,K,Q,X,Y,$,tt;s._RF.push({},"d2f5bPukodJ8bv3GyAMIGwE","PlayerBase",void 0);var et=u.ccclass,nt=u.property;t("PlayerBase",(N=et("PlayerBase"),z=nt({type:c}),A=nt({type:h}),O=nt({type:d}),_=nt({type:f}),L=nt({type:h}),N((W=e((Z=function(t){function e(){for(var e,n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return e=t.call.apply(t,[this].concat(r))||this,i(e,"columns",W,o(e)),i(e,"rows",F,o(e)),i(e,"cellRadius",H,o(e)),i(e,"cellSprite",G,o(e)),i(e,"userConfigPath",J,o(e)),i(e,"defaultWalletBalance",j,o(e)),i(e,"moneyBar",k,o(e)),i(e,"buildingNamePrefab",q,o(e)),i(e,"baseScroll",K,o(e)),i(e,"scrollContent",Q,o(e)),i(e,"minZoom",X,o(e)),i(e,"maxZoom",Y,o(e)),i(e,"scrollPadding",$,o(e)),i(e,"scrollInertia",tt,o(e)),e.viewModel=null,e.cellNodes=[],e.buildingsRoot=null,e.pinchStartDistance=0,e.pinchStartScale=1,e.isPinching=!1,e.touchTarget=null,e}n(e,t);var s=e.prototype;return s.onEnable=function(){this.setupScroll(),this.bindInput()},s.onDisable=function(){this.unbindInput()},s.start=function(){this.loadAndBuild().catch((function(t){console.error("PlayerBase config load failed",t)}))},s.loadAndBuild=function(){var t=a(l().mark((function t(){var e,n,i,o,r,a,s,u,c,h,d;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return R.setDataLoader(new T),t.next=3,R.init();case 3:return t.next=5,this.loadUserData(this.userConfigPath);case 5:o=t.sent,(r=B.getInstance()).applyUserData(o,this.defaultWalletBalance),this.moneyBar&&(null==(a=this.moneyBar.getComponent(U))||a.init(r.walletService.getBalance())),s=o.Buildings,u=R.getBuildingModels(),console.log("Loaded building models:",u),c=null!=(e=s.columns)?e:this.columns,h=null!=(n=s.rows)?n:this.rows,d=null!=(i=s.cellRadius)?i:this.cellRadius,this.buildGridFromConfig(c,h,d,s.cells,u);case 16:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),s.loadUserData=function(t){return this.isRemoteSource(t)?this.loadRemoteUserData(t):this.loadLocalUserData(t)},s.loadLocalUserData=function(t){return new Promise((function(e,n){var i=t.endsWith(".json")?t.slice(0,-5):t;p.load(i,g,(function(i,o){!i&&o?e(o.json):n(null!=i?i:new Error("Missing user JSON at "+t))}))}))},s.loadRemoteUserData=function(t){return new Promise((function(e,n){b.loadRemote(t,(function(i,o){!i&&o?e(o.json):n(null!=i?i:new Error("Missing remote user JSON at "+t))}))}))},s.isRemoteSource=function(t){return t.startsWith("http://")||t.startsWith("https://")},s.buildGrid=function(){if(this.clearGrid(),this.viewModel){this.ensureBuildingsRoot(),this.setupScroll();for(var t,e=[],n=r(this.viewModel.cells);!(t=n()).done;){var i=t.value;e.push(this.viewModel.getRawCellPosition(i))}var o=this.getCenterOffset(e);this.updateContentBounds(e,o);for(var a=0;a<this.viewModel.cells.length;a+=1){var l=this.viewModel.cells[a],s=this.createCellNode(l,e[a],o);this.getContentRoot().addChild(s),this.cellNodes.push(s)}this.applyUiZOrder()}},s.buildGridFromConfig=function(t,e,n,i,o){this.columns=t,this.rows=e,this.cellRadius=n,this.viewModel=new M(t,e,n,i,o),this.buildGrid()},s.createCellNode=function(t,e,n){var i=new h("Cell_"+t.q+"_"+t.r),o=e.add(n);(i.setPosition(o.x,o.y,0),i.layer=m.Enum.UI_2D,i.addComponent(y).setContentSize(2*this.cellRadius,2*this.cellRadius),this.cellSprite)&&(i.addComponent(v).spriteFrame=this.cellSprite);return t.building&&this.createBuildingNode(t,o),i},s.getCenterOffset=function(t){if(0===t.length)return new C;for(var e,n=t[0].x,i=t[0].x,o=t[0].y,a=t[0].y,l=r(t);!(e=l()).done;){var s=e.value;n=Math.min(n,s.x),i=Math.max(i,s.x),o=Math.min(o,s.y),a=Math.max(a,s.y)}return new C(-(n+i)/2,-(o+a)/2,0)},s.clearGrid=function(){for(var t,e=r(this.cellNodes);!(t=e()).done;){t.value.removeFromParent()}this.cellNodes=[],this.buildingsRoot&&(this.buildingsRoot.removeFromParent(),this.buildingsRoot=null)},s.applyUiZOrder=function(){for(var t=[].concat(this.cellNodes).sort((function(t,e){return e.position.y-t.position.y})),e=0;e<t.length;e+=1)t[e].setSiblingIndex(e)},s.applyBuildingsZOrder=function(){if(this.buildingsRoot)for(var t=[].concat(this.buildingsRoot.children).sort((function(t,e){return e.position.y-t.position.y})),e=0;e<t.length;e+=1)t[e].setSiblingIndex(e)},s.ensureBuildingsRoot=function(){this.buildingsRoot||(this.buildingsRoot=new h("BuildingsRoot"),this.buildingsRoot.layer=m.Enum.UI_2D,this.getContentRoot().addChild(this.buildingsRoot))},s.createBuildingNode=function(t,e){if(this.buildingsRoot){var n=new h("Building_"+t.q+"_"+t.r),i=n.addComponent(y);n.layer=m.Enum.UI_2D;var o=1.2*this.cellRadius;i.setContentSize(o,o),i.setAnchorPoint(.5,.1),n.setPosition(e.x,e.y,0);var r=n.addComponent(P);this.buildingNamePrefab&&r.setNamePrefab(this.buildingNamePrefab);var a=new x(t.building,t.buildingInstanceId);r.bind(a),this.buildingsRoot.addChild(n),this.applyBuildingsZOrder()}},s.loadJson=function(t){return new Promise((function(e,n){p.load(t,g,(function(t,i){t?n(t):e(i.json)}))}))},s.Battle=function(){var t=a(l().mark((function t(){var e,n;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=I.getInstance().createWindow(D)){t.next=4;break}return console.error("[PlayerBase] PrepareBattleView is missing on prefab"),t.abrupt("return");case 4:n=new E,e.bind(n);case 6:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),s.setupScroll=function(){var t;if(!this.baseScroll){var e,n=this.getContentRoot();return(null!=(e=n.getComponent(y))?e:n.addComponent(y)).setAnchorPoint(.5,.5),void(n.layer=m.Enum.UI_2D)}var i=this.ensureScrollContent();(null!=(t=i.getComponent(y))?t:i.addComponent(y)).setAnchorPoint(.5,.5),i.layer=m.Enum.UI_2D,this.baseScroll.inertia=this.scrollInertia},s.bindInput=function(){var t,e,n=null!=(t=null==(e=this.baseScroll)?void 0:e.node)?t:this.node;this.touchTarget!==n&&(this.unbindInput(),this.touchTarget=n,n.on(h.EventType.TOUCH_START,this.onTouchStart,this),n.on(h.EventType.TOUCH_MOVE,this.onTouchMove,this),n.on(h.EventType.TOUCH_END,this.onTouchEnd,this),n.on(h.EventType.TOUCH_CANCEL,this.onTouchEnd,this))},s.unbindInput=function(){this.touchTarget&&(this.touchTarget.off(h.EventType.TOUCH_START,this.onTouchStart,this),this.touchTarget.off(h.EventType.TOUCH_MOVE,this.onTouchMove,this),this.touchTarget.off(h.EventType.TOUCH_END,this.onTouchEnd,this),this.touchTarget.off(h.EventType.TOUCH_CANCEL,this.onTouchEnd,this),this.touchTarget=null)},s.onTouchStart=function(t){var e,n=t.getAllTouches();n.length<2||(t.stopPropagation(),this.isPinching=!0,this.pinchStartDistance=this.getTouchesDistance(n),this.pinchStartScale=this.getContentRoot().scale.x,null==(e=this.baseScroll)||e.stopAutoScroll())},s.onTouchMove=function(t){if(this.isPinching){var e=t.getAllTouches();if(!(e.length<2)){t.stopPropagation();var n=this.getTouchesDistance(e);if(!(this.pinchStartDistance<=0)){var i=this.clampScale(this.pinchStartScale*(n/this.pinchStartDistance));this.applyZoomAtTouches(i,e)}}}},s.onTouchEnd=function(t){t.getAllTouches().length>=2||(this.isPinching=!1)},s.applyZoomAtTouches=function(t,e){var n=this.getContentRoot(),i=n.parent,o=n.getComponent(y);if(o){var r=this.getTouchesCenterWorld(e),a=o.convertToNodeSpaceAR(r);if(i){var l=i.getComponent(y);if(l){var s,u=l.convertToNodeSpaceAR(r);n.setScale(t,t,1);var c=new C(u.x-a.x*t,u.y-a.y*t,n.position.z);return n.setPosition(c),void(null==(s=this.baseScroll)||s.scrollToOffset(this.baseScroll.getScrollOffset(),0))}}n.setScale(t,t,1)}},s.getTouchesDistance=function(t){var e=t[0].getLocation(),n=t[1].getLocation();return S.distance(e,n)},s.getTouchesCenterWorld=function(t){var e=t[0].getLocation(),n=t[1].getLocation();return new C(.5*(e.x+n.x),.5*(e.y+n.y),0)},s.clampScale=function(t){return Math.min(this.maxZoom,Math.max(this.minZoom,t))},s.updateContentBounds=function(t,e){var n,i=this.getContentRoot(),o=null!=(n=i.getComponent(y))?n:i.addComponent(y);if(o.setAnchorPoint(.5,.5),0!==t.length){for(var a,l=t[0].x+e.x,s=t[0].x+e.x,u=t[0].y+e.y,c=t[0].y+e.y,h=r(t);!(a=h()).done;){var d=a.value,f=d.x+e.x,p=d.y+e.y;l=Math.min(l,f),s=Math.max(s,f),u=Math.min(u,p),c=Math.max(c,p)}var g=this.cellRadius,b=Math.max(0,this.scrollPadding),m=s-l+2*g+2*b,v=c-u+2*g+2*b;o.setContentSize(m,v)}else o.setContentSize(0,0)},s.getContentRoot=function(){var t;return this.scrollContent?this.scrollContent:null!=(t=this.baseScroll)&&t.content?this.baseScroll.content:this.node},s.ensureScrollContent=function(){if(!this.baseScroll)return this.getContentRoot();if(!this.baseScroll.content){var t=new h("PlayerBaseContent");this.baseScroll.node.addChild(t),this.baseScroll.content=t}var e=this.baseScroll.content;return e&&this.node.parent!==e&&this.node!==this.baseScroll.node&&(this.node.removeFromParent(),e.addChild(this.node)),null!=e?e:this.node},e}(w)).prototype,"columns",[nt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 5}}),F=e(Z.prototype,"rows",[nt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 5}}),H=e(Z.prototype,"cellRadius",[nt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 64}}),G=e(Z.prototype,"cellSprite",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),J=e(Z.prototype,"userConfigPath",[nt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"User"}}),j=e(Z.prototype,"defaultWalletBalance",[nt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 500}}),k=e(Z.prototype,"moneyBar",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),q=e(Z.prototype,"buildingNamePrefab",[O],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),K=e(Z.prototype,"baseScroll",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Q=e(Z.prototype,"scrollContent",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),X=e(Z.prototype,"minZoom",[nt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.7}}),Y=e(Z.prototype,"maxZoom",[nt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1.6}}),$=e(Z.prototype,"scrollPadding",[nt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 160}}),tt=e(Z.prototype,"scrollInertia",[nt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),V=Z))||V));s._RF.pop()}}}));

System.register("chunks:///_virtual/PlayerBaseModels.ts",["cc"],(function(i){var t;return{setters:[function(i){t=i.cclegacy}],execute:function(){t._RF.push({},"05257JxKtZNIrkqgXypazvy","PlayerBaseModels",void 0);i("BuildingData",(function(i,t,d,s,n,l,e){this.id=void 0,this.kind=void 0,this.buildingImage=void 0,this.buildingIcon=void 0,this.message=void 0,this.nextLevelBuildingId=void 0,this.upgradeCost=void 0,this.id=i,this.kind=t,this.buildingImage=d,this.buildingIcon=s,this.message=n,this.nextLevelBuildingId=l,this.upgradeCost=e})),i("CellData",(function(i,t,d,s,n){var l,e;void 0===s&&(s=null),void 0===n&&(n=null),this.q=void 0,this.r=void 0,this.building=void 0,this.buildingId=void 0,this.buildingInstanceId=void 0,this.q=i,this.r=t,this.building=d,this.buildingId=null!=(l=null!=(e=s)?e:null==d?void 0:d.id)?l:null,this.buildingInstanceId=n}));t._RF.pop()}}}));

System.register("chunks:///_virtual/PlayerBaseViewModel.ts",["./rollupPluginModLoBabelHelpers.js","cc","./PlayerBaseModels.ts"],(function(l){var e,i,n,t;return{setters:[function(l){e=l.createForOfIteratorHelperLoose},function(l){i=l.cclegacy,n=l.Vec3},function(l){t=l.CellData}],execute:function(){i._RF.push({},"d426eBvVidEpIqu4dCFfCSF","PlayerBaseViewModel",void 0);l("PlayerBaseViewModel",function(){function l(l,e,i,n,t){this.cells=[],this.columns=void 0,this.rows=void 0,this.cellRadius=void 0,this.columns=Math.max(1,l),this.rows=Math.max(1,e),this.cellRadius=Math.max(1,i),this.createCells(n,t)}var i=l.prototype;return i.getRawCellPosition=function(l){var e=1.5*this.cellRadius*l.q,i=this.cellRadius*Math.sqrt(3)*(l.r+.5*l.q);return new n(e,i,0)},i.createCells=function(l,i){for(var n,s=new Map,u=e(l);!(n=u()).done;){var o,r,a,d=n.value,c=null!=(o=null!=(r=d.buildingId)?r:null==(a=d.building)?void 0:a.id)?o:null;c&&s.set(d.q+"_"+d.r,{buildingId:c,buildingInstanceId:Number.isFinite(d.id)?d.id:null})}for(var h=0;h<this.columns;h+=1)for(var v=0;v<this.rows;v+=1){var f,g,p=null,w=s.get(h+"_"+v);w&&(p=i.get(w.buildingId)||null),this.cells.push(new t(h,v,p,null!=(f=null==w?void 0:w.buildingId)?f:null,null!=(g=null==w?void 0:w.buildingInstanceId)?g:null))}},l}());i._RF.pop()}}}));

System.register("chunks:///_virtual/PrepareBattleContracts.ts",["cc"],(function(){var t;return{setters:[function(e){t=e.cclegacy}],execute:function(){t._RF.push({},"509d82tQfFHEZpXWvTkZp5L","PrepareBattleContracts",void 0),t._RF.pop()}}}));

System.register("chunks:///_virtual/PrepareBattleItemContracts.ts",["cc"],(function(){var t;return{setters:[function(e){t=e.cclegacy}],execute:function(){t._RF.push({},"057b7xw+XdEgZruSnhnV1Ps","PrepareBattleItemContracts",void 0),t._RF.pop()}}}));

System.register("chunks:///_virtual/PrepareBattleItemView.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var t,i,r,n,a,o,l,c,s,p,u,h;return{setters:[function(e){t=e.applyDecoratedDescriptor,i=e.inheritsLoose,r=e.initializerDefineProperty,n=e.assertThisInitialized},function(e){a=e.cclegacy,o=e._decorator,l=e.Sprite,c=e.Label,s=e.UITransform,p=e.resources,u=e.SpriteFrame,h=e.Component}],execute:function(){var f,S,d,k,b,v,w,m,M;a._RF.push({},"3ae32VAJiRPA4PQ4UQUMVrx","PrepareBattleItemView",void 0);var y=o.ccclass,g=o.property;e("PrepareBattleItemView",(f=y("PrepareBattleItemView"),S=g({type:l}),d=g({type:l}),k=g({type:c}),f((w=t((v=function(e){function t(){for(var t,i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return t=e.call.apply(e,[this].concat(a))||this,r(t,"iconSprite",w,n(t)),r(t,"takeMark",m,n(t)),r(t,"titleLabel",M,n(t)),t.iconBaseSize=null,t.viewModel=null,t}i(t,e);var a=t.prototype;return a.onLoad=function(){if(this.iconSprite){var e=this.iconSprite.getComponent(s);e&&(this.iconBaseSize={width:e.contentSize.width,height:e.contentSize.height})}},a.bind=function(e){this.viewModel=e,this.viewModel.bindView(this)},a.setIcon=function(e){var t=this;this.iconSprite&&p.load(e,u,(function(e,i){if(e)console.error("[PrepareBattleItemView] icon load failed",e);else if(t.iconSprite){t.iconSprite.spriteFrame=i;var r=t.iconSprite.getComponent(s);r&&t.iconBaseSize&&r.setContentSize(t.iconBaseSize.width,t.iconBaseSize.height)}}))},a.setTitle=function(e){this.titleLabel&&(this.titleLabel.string=e)},a.onSelect=function(){var e;null==(e=this.viewModel)||e.select()},a.setTakeMarkVisible=function(e){this.takeMark&&(this.takeMark.node.active=e)},a.setTakeMarkSprite=function(e){this.takeMark&&(this.takeMark.spriteFrame=e,this.takeMark.node.active=!!e)},t}(h)).prototype,"iconSprite",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),m=t(v.prototype,"takeMark",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),M=t(v.prototype,"titleLabel",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),b=v))||b));a._RF.pop()}}}));

System.register("chunks:///_virtual/PrepareBattleItemVM.ts",["cc","./StaticConfigStore.ts"],(function(t){var e,i;return{setters:[function(t){e=t.cclegacy},function(t){i=t.StaticConfigStore}],execute:function(){e._RF.push({},"2f4ceyyOMlOjJ6+o9SAkLRL","PrepareBattleItemVM",void 0);t("PrepareBattleItemVM",function(){function t(){this.view=null,this.unitId=null,this.iconPath=null,this.title=null,this.onSelect=null,this.selected=!1}var e=t.prototype;return e.bindView=function(t){this.view=t,this.syncView()},e.init=function(t,e,i){this.unitId=t,this.selected=e,this.onSelect=null!=i?i:null,this.loadUnitData(t),this.syncView()},e.select=function(){var t;this.unitId&&(this.setSelected(!this.selected),null==(t=this.onSelect)||t.call(this,this.unitId))},e.setSelected=function(t){this.selected=t,this.view&&this.view.setTakeMarkVisible(this.selected)},e.isSelected=function(){return this.selected},e.loadUnitData=function(t){var e=i.getUnitById(t);e?(this.iconPath=e.model,this.title=e.title||e.id,this.view&&(this.view.setIcon(this.iconPath),this.view.setTitle(this.title))):console.error("[PrepareBattleItem] Unit config not found for "+t)},e.syncView=function(){this.view&&(this.iconPath&&this.view.setIcon(this.iconPath),this.title&&this.view.setTitle(this.title),this.view.setTakeMarkVisible(this.selected))},t}());e._RF.pop()}}}));

System.register("chunks:///_virtual/PrepareBattleView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./WindowView.ts"],(function(e){var t,r,n,i,l,o,a,u,c;return{setters:[function(e){t=e.applyDecoratedDescriptor,r=e.inheritsLoose,n=e.initializerDefineProperty,i=e.assertThisInitialized},function(e){l=e.cclegacy,o=e._decorator,a=e.ScrollView,u=e.Prefab},function(e){c=e.WindowView}],execute:function(){var p,s,f,b,w,d,h,g,y,P,v,S,B;l._RF.push({},"17e355e6TpFI7G+T6gAXx4e","PrepareBattleView",void 0);var M=o.ccclass,m=o.property;e("PrepareBattleView",(p=M("PrepareBattleView"),s=m({type:a}),f=m({type:a}),b=m({type:a}),w=m({type:u}),d=m({type:u}),p((y=t((g=function(e){function t(){for(var t,r=arguments.length,l=new Array(r),o=0;o<r;o++)l[o]=arguments[o];return t=e.call.apply(e,[this].concat(l))||this,n(t,"line1Scroll",y,i(t)),n(t,"line2Scroll",P,i(t)),n(t,"line3Scroll",v,i(t)),n(t,"prepareBattleItemPrefab",S,i(t)),n(t,"battleManagerPrefab",B,i(t)),t.viewModel=null,t}r(t,e);var l=t.prototype;return l.bind=function(e){this.viewModel=e,this.viewModel.bindView(this)},l.render=function(){this.viewModel||console.error("[PrepareBattleView] ViewModel is not bound")},l.onStartBattle=function(){var e;null==(e=this.viewModel)||e.startBattle()},l.onClose=function(){var e;null==(e=this.viewModel)||e.close()},l.getLine1Scroll=function(){return this.line1Scroll},l.getLine2Scroll=function(){return this.line2Scroll},l.getLine3Scroll=function(){return this.line3Scroll},l.getPrepareBattleItemPrefab=function(){return this.prepareBattleItemPrefab},l.getBattleManagerPrefab=function(){return this.battleManagerPrefab},l.getRootNode=function(){return this.node},l.close=function(){this.viewModel=null,this.node.destroy()},t}(c)).prototype,"line1Scroll",[s],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),P=t(g.prototype,"line2Scroll",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),v=t(g.prototype,"line3Scroll",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),S=t(g.prototype,"prepareBattleItemPrefab",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),B=t(g.prototype,"battleManagerPrefab",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),h=g))||h));l._RF.pop()}}}));

System.register("chunks:///_virtual/PrepareBattleVM.ts",["./rollupPluginModLoBabelHelpers.js","cc","./StaticConfigStore.ts","./StaticConfigModels.ts","./UserService.ts","./PrepareBattleItemView.ts","./PrepareBattleItemVM.ts"],(function(e){var t,n,i,r,a,o,s,l,c,f,u,h,g;return{setters:[function(e){t=e.createForOfIteratorHelperLoose,n=e.asyncToGenerator,i=e.regeneratorRuntime},function(e){r=e.cclegacy,a=e.resources,o=e.JsonAsset,s=e.instantiate,l=e.UITransform},function(e){c=e.StaticConfigStore},function(e){f=e.UnitLine},function(e){u=e.UserService},function(e){h=e.PrepareBattleItemView},function(e){g=e.PrepareBattleItemVM}],execute:function(){r._RF.push({},"680f4SfiZNA/7CSHIxmvvbc","PrepareBattleVM",void 0);e("PrepareBattleVM",function(){function e(){this.view=null,this.itemPrefab=null,this.battleManagerPrefab=null,this.itemsById=new Map,this.selectedByLine=new Map}var r=e.prototype;return r.bindView=function(e){this.view=e,this.itemPrefab=e.getPrepareBattleItemPrefab(),this.battleManagerPrefab=e.getBattleManagerPrefab(),this.view.render(),this.populateUnits()},r.generateBattleConfig=function(){for(var e=c.getUnitsConfig().Units,t=[],n=[f.Line1,f.Live2,f.Line3],i=0,r=n;i<r.length;i++){var a=r[i],o=this.selectedByLine.get(a);o&&t.push(o)}for(var s=[],l=function(){var t=h[u],n=e.filter((function(e){return e.line===t}));if(0===n.length)return 1;var i=Math.floor(Math.random()*n.length);s.push(n[i].id)},u=0,h=n;u<h.length;u++)l();return{user_config:{squad:t},enemy_config:{squad:s},biom:"snow"}},r.loadJson=function(e){return new Promise((function(t,n){a.load(e,o,(function(e,i){e?n(e):t(i.json)}))}))},r.startBattle=function(){var e=n(i().mark((function e(){var t,n,r,a,o,c;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.loadJson("Config/Units");case 2:if(t=e.sent,this.view&&this.battleManagerPrefab){e.next=6;break}return console.error("[PrepareBattle] battleManagerPrefab is not set"),e.abrupt("return");case 6:if(n=this.view.getRootNode()){e.next=10;break}return console.error("[PrepareBattle] root node is not set"),e.abrupt("return");case 10:return r=s(this.battleManagerPrefab),n.parent.addChild(r),a=n.getComponent(l),o=a?a.contentSize:{width:0,height:0},r.setPosition(-o.width/2,-o.height/2,0),c=r.getComponent("BattleManager"),e.next=18,c.init(this.generateBattleConfig(),t);case 18:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),r.close=function(){var e;null==(e=this.view)||e.close(),this.view=null},r.populateUnits=function(){var e=this;if(this.view)if(this.itemPrefab){var n=u.getInstance().itemsService,i=c.getUnitsConfig().Units,r=new Map,a=new Map;this.itemsById.clear(),this.selectedByLine.clear();for(var o,f=t(i);!(o=f()).done;){var d,v=o.value;if(!(n.getCount(v.id)<=0)){a.has(v.line)||a.set(v.line,v.id);var p=this.getScrollForLine(v.line);if(p&&p.content){var m=s(this.itemPrefab);p.content.addChild(m);var B=null!=(d=r.get(p))?d:{offsetX:0,maxHeight:0,count:0},w=(m.getComponent(l)||m.addComponent(l)).contentSize,P=w.width>0?w.width:100,b=w.height>0?w.height:100,S=B.count>0?10:0;m.setPosition(B.offsetX+S+P/2,b/2-5,0),B.offsetX+=P+S,B.maxHeight=Math.max(B.maxHeight,b),B.count+=1,r.set(p,B);var M=m.getComponent(h);if(M){var C=new g;M.bind(C),C.init(v.id,!1,(function(t){e.handleSelect(t)})),this.itemsById.set(v.id,{vm:C,line:v.line})}else console.error("[PrepareBattle] PrepareBattleItemView is missing on prefab")}}}for(var L,y=t(r.entries());!(L=y()).done;){var I=L.value,x=I[0],U=I[1];if(x.content){var V=x.content.getComponent(l)||x.content.addComponent(l);V.setAnchorPoint(0,0);var H=x.node.getComponent(l),z=H?H.contentSize.width:0,F=H?H.contentSize.height:0,_=Math.max(U.offsetX,z),k=Math.max(U.maxHeight,F);V.setContentSize(_,k)}}for(var R,X=t(a.entries());!(R=X()).done;){var A=R.value,J=A[0],j=A[1],q=this.itemsById.get(j);q&&(q.vm.setSelected(!0),this.selectedByLine.set(J,j))}}else console.error("[PrepareBattle] prepareBattleItemPrefab is not set")},r.getScrollForLine=function(e){if(!this.view)return null;switch(e){case f.Line1:return this.view.getLine1Scroll();case f.Live2:return this.view.getLine2Scroll();case f.Line3:return this.view.getLine3Scroll();default:return null}},r.handleSelect=function(e){var t=this.itemsById.get(e);if(t){var n=t.vm,i=t.line,r=this.selectedByLine.get(i);if(n.isSelected()){if(r&&r!==e){var a=this.itemsById.get(r);null==a||a.vm.setSelected(!1)}this.selectedByLine.set(i,e)}else r===e&&this.selectedByLine.delete(i)}},e}());r._RF.pop()}}}));

System.register("chunks:///_virtual/ProductionService.ts",["./rollupPluginModLoBabelHelpers.js","cc","./EventBus.ts","./StaticConfigModels.ts","./StaticConfigStore.ts"],(function(t){var o,n,r,i,e,c,u,d;return{setters:[function(t){o=t.extends,n=t.createForOfIteratorHelperLoose},function(t){r=t.cclegacy},function(t){i=t.bus,e=t.Events},function(t){c=t.Price,u=t.Money},function(t){d=t.StaticConfigStore}],execute:function(){r._RF.push({},"1bc07qIN3NAgri0aqhVcc3L","ProductionService",void 0);t("ProductionService",function(){function t(t,o){this.buildingService=void 0,this.walletService=void 0,this.productions=new Map,this.buildingService=t,this.walletService=o}var r=t.prototype;return r.startProduction=function(t,o){var n=this.buildingService.getBuildingConfigId(t);if(!n)return console.error("[ProductionService] Building instance "+t+" not found"),!1;if(this.productions.has(o))return console.error("[ProductionService] Production already running for "+o),!1;var r=d.getResourceProductionByBuildingId(n);if(!r||0===r.length)return console.error("[ProductionService] No production options for building "+n),!1;var i=r.find((function(t){return t.product===o}));if(!i)return console.error("[ProductionService] Product "+o+" is not available for "+n),!1;var e={buildingInstanceId:t,buildingConfigId:n,product:o,startedAt:Date.now(),durationSeconds:i.time,count:i.count};return this.productions.set(o,e),!0},r.getProductionState=function(){return Array.from(this.productions.values()).map((function(t){return o({},t)}))},r.collect=function(t){var o=this.productions.get(t);if(!o)return console.error("[ProductionService] No production found for "+t),!1;var n=new c([new u(t,o.count)]);return this.walletService.add(n),i.emit(e.RESOURCE_PRODUCTED,{product:t,count:o.count,buildingInstanceId:o.buildingInstanceId,startedAt:o.startedAt,durationSeconds:o.durationSeconds}),this.productions.delete(t),this.startProduction(o.buildingInstanceId,t),!0},r.ensureProductionsStarted=function(){for(var t,o=this.buildingService.getBuildingInstances(),r=n(o);!(t=r()).done;){var i=t.value,e=d.getResourceProductionByBuildingId(i.configId);if(e&&0!==e.length)for(var c,u=n(e);!(c=u()).done;){var s=c.value;this.productions.has(s.product)||this.startProduction(i.id,s.product)}}},t}());r._RF.pop()}}}));

System.register("chunks:///_virtual/ResourceProductionContracts.ts",["cc"],(function(){var t;return{setters:[function(c){t=c.cclegacy}],execute:function(){t._RF.push({},"d66315WA+lL9JTvNaTkqFGG","ResourceProductionContracts",void 0),t._RF.pop()}}}));

System.register("chunks:///_virtual/ResourceProductionItemView.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var e,i,n,o,l,c,r,s,a,u,h,p;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,n=t.initializerDefineProperty,o=t.assertThisInitialized},function(t){l=t.cclegacy,c=t._decorator,r=t.Sprite,s=t.Label,a=t.Button,u=t.resources,h=t.SpriteFrame,p=t.Component}],execute:function(){var d,b,m,f,C,g,L,w,y,I,v,B,S,D,T;l._RF.push({},"82bf3NIdSdPgJnJJZceyv7E","ResourceProductionItemView",void 0);var M=c.ccclass,P=c.property;t("ResourceProductionItem",(d=M("ResourceProductionItem"),b=P({type:r}),m=P({type:s}),f=P({type:s}),C=P({type:s}),g=P({type:a}),L=P({type:s}),d((I=e((y=function(t){function e(){for(var e,i=arguments.length,l=new Array(i),c=0;c<i;c++)l[c]=arguments[c];return e=t.call.apply(t,[this].concat(l))||this,n(e,"itemIcon",I,o(e)),n(e,"titleLabel",v,o(e)),n(e,"timerLabel",B,o(e)),n(e,"actionDescriptionLabel",S,o(e)),n(e,"collectButton",D,o(e)),n(e,"collectLabel",T,o(e)),e.viewModel=null,e.remainingSeconds=0,e.warnedMissingDescription=!1,e}i(e,t);var l=e.prototype;return l.onEnable=function(){this.collectButton&&this.collectButton.node.on(a.EventType.CLICK,this.onCollectClicked,this),!this.collectLabel&&this.collectButton&&(this.collectLabel=this.collectButton.getComponentInChildren(s))},l.onDisable=function(){this.collectButton&&this.collectButton.node.off(a.EventType.CLICK,this.onCollectClicked,this),this.stopCountdown()},l.bind=function(t){this.viewModel=t,this.viewModel.bindView(this)},l.setTitle=function(t){this.titleLabel&&(this.titleLabel.string=t)},l.setIconPath=function(t){var e=this;this.itemIcon&&(t?u.load(t,h,(function(t,i){t?console.error("[ResourceProductionItem] Failed to load icon:",t):e.itemIcon&&(e.itemIcon.spriteFrame=i)})):this.itemIcon.spriteFrame=null)},l.setTimerText=function(t){this.timerLabel&&(this.timerLabel.string=t)},l.setActionDescription=function(t){this.actionDescriptionLabel?this.actionDescriptionLabel.string=t:this.warnedMissingDescription||(this.warnedMissingDescription=!0,console.error("[ResourceProductionItem] actionDescriptionLabel is not set on prefab"))},l.setCollectLabel=function(t){!this.collectLabel&&this.collectButton&&(this.collectLabel=this.collectButton.getComponentInChildren(s)),this.collectLabel&&(this.collectLabel.string=t)},l.setCollectEnabled=function(t){if(this.collectButton){this.collectButton.interactable=t;var e=this.collectButton.getComponent(r);e&&(e.spriteFrame=t?this.collectButton.normalSprite:this.collectButton.disabledSprite)}},l.startCountdown=function(t){if(this.stopCountdown(),this.remainingSeconds=Math.max(0,Math.floor(t)),this.setTimerText(this.formatTime(this.remainingSeconds)),this.remainingSeconds<=0)return this.setCollectLabel("Collect"),void this.setCollectEnabled(!0);this.schedule(this.tickCountdown,1)},l.stopCountdown=function(){this.unschedule(this.tickCountdown),this.remainingSeconds=0},l.onCollectClicked=function(){var t;null==(t=this.viewModel)||t.collect()},l.tickCountdown=function(){this.remainingSeconds=Math.max(0,this.remainingSeconds-1),this.setTimerText(this.formatTime(this.remainingSeconds)),this.remainingSeconds<=0&&(this.stopCountdown(),this.setCollectLabel("Collect"),this.setCollectEnabled(!0))},l.formatTime=function(t){return Math.floor(t/60)+":"+(t%60).toString().padStart(2,"0")},e}(p)).prototype,"itemIcon",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),v=e(y.prototype,"titleLabel",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),B=e(y.prototype,"timerLabel",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),S=e(y.prototype,"actionDescriptionLabel",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),D=e(y.prototype,"collectButton",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),T=e(y.prototype,"collectLabel",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),w=y))||w));l._RF.pop()}}}));

System.register("chunks:///_virtual/ResourceProductionItemViewModel.ts",["cc"],(function(t){var e;return{setters:[function(t){e=t.cclegacy}],execute:function(){e._RF.push({},"257beW2B5FO9odz97SvczTT","ResourceProductionItemViewModel",void 0);t("ResourceProductionItemViewModel",function(){function t(t){this.view=null,this.data=void 0,this.data=t}var e=t.prototype;return e.bindView=function(t){this.view=t,this.render()},e.collect=function(){this.data.onCollect&&this.data.onCollect()},e.updateTimeLeft=function(t){this.data.timeLeftSeconds=t,this.render()},e.setCollectAvailable=function(t){this.data.canCollect=t,this.render()},e.render=function(){var t,e,i;if(this.view){this.view.setTitle("Product: "+this.data.title),this.view.setIconPath(null!=(t=this.data.iconPath)?t:null);var o=Math.max(0,Math.floor(null!=(e=this.data.timeLeftSeconds)?e:0));if(!(null!=(i=this.data.isProducing)&&i)){var s=this.data.title+" x"+this.data.count+": ";return this.view.setCollectLabel("Collect"),this.view.setActionDescription("Time of production "+s),this.view.stopCountdown(),this.view.setTimerText(this.formatTime(o)),void this.view.setCollectEnabled(!1)}this.view.setActionDescription("Time till finish: "),o>0?(this.view.setCollectLabel("Producing..."),this.view.setCollectEnabled(!1),this.view.startCountdown(o)):(this.view.setCollectLabel("Collect"),this.view.stopCountdown(),this.view.setTimerText(this.formatTime(o)),this.view.setCollectEnabled(!0))}},e.formatTime=function(t){return Math.floor(t/60)+":"+(t%60).toString().padStart(2,"0")},t}());e._RF.pop()}}}));

System.register("chunks:///_virtual/ResourceProductionVM.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ResourceProductionItemView.ts","./ResourceProductionItemViewModel.ts","./EventBus.ts","./StaticConfigStore.ts","./UserService.ts","./BuildingUpgradeView.ts","./BuildingUpgradeViewModel.ts","./WindowManager.ts"],(function(e){var n,t,i,o,r,c,s,d,u,l,a,g,f;return{setters:[function(e){n=e.createForOfIteratorHelperLoose},function(e){t=e.cclegacy,i=e.UITransform,o=e.instantiate},function(e){r=e.ResourceProductionItem},function(e){c=e.ResourceProductionItemViewModel},function(e){s=e.bus,d=e.Events},function(e){u=e.StaticConfigStore},function(e){l=e.UserService},function(e){a=e.BuildingUpgradeView},function(e){g=e.BuildingUpgradeViewModel},function(e){f=e.WindowManager}],execute:function(){t._RF.push({},"28a4bLm9JFMC5HUyjirN4cJ","ResourceProductionVM",void 0);e("ResourceProductionVM",function(){function e(){this.view=null,this.buildingInstanceId=null}var t=e.prototype;return t.bindView=function(e){this.view=e,this.view.render(),s.on(d.BUILDING_UPGRADE_SUCCESS,this.onBuildingUpgraded,this)},t.init=function(e){this.buildingInstanceId=e,this.renderItems()},t.close=function(){var e;s.off(d.BUILDING_UPGRADE_SUCCESS,this.onBuildingUpgraded,this),null==(e=this.view)||e.close(),this.view=null},t.upgrade=function(){if(null!==this.buildingInstanceId){var e=l.getInstance().buildingService.getBuildingConfigId(this.buildingInstanceId);if(e){var n=u.getBuildingConfigById(e);if(n){var t=f.getInstance().createWindow(a);if(t){var i=new g(n,this.buildingInstanceId);t.bind(i)}}else console.error("[ResourceProductionVM] Building config "+e+" not found")}else console.error("[ResourceProductionVM] Building instance "+this.buildingInstanceId+" not found")}else console.error("[ResourceProductionVM] Building instance id is not set")},t.onBuildingUpgraded=function(e){this.buildingInstanceId===e.id&&this.close()},t.renderItems=function(){var e=this;if(this.view&&null!==this.buildingInstanceId){l.getInstance().productionService.ensureProductionsStarted();var t=this.view.getItemsScroll(),s=this.view.getItemPrefab();if(t&&s){var d=t.content;if(d){var a=l.getInstance(),g=a.buildingService.getBuildingConfigId(this.buildingInstanceId);if(g){var f=u.getResourceProductionByBuildingId(g);if(f&&0!==f.length){for(var h,I=a.productionService.getProductionState(),v=new Map,p=n(I);!(h=p()).done;){var m=h.value;v.set(m.product,m)}d.removeAllChildren();for(var S,w=0,P=d.getComponent(i)||d.addComponent(i),B=P.contentSize.width||0,M=function(){var n=S.value,t=v.get(n.product),l=Boolean(t),a=t?Math.max(0,t.durationSeconds-(Date.now()-t.startedAt)/1e3):n.time,g=!l||a<=0,f=u.getCurrencyIconByName(n.product),h={title:n.product,product:n.product,count:n.count,iconPath:f,timeLeftSeconds:a,isProducing:l,canCollect:g,onCollect:function(){return e.handleAction(n.product,l)}},I=o(s),p=I.getComponent(r);if(!p)return console.error("[ResourceProductionVM] ResourceProductionItem component is missing on prefab"),1;var m=new c(h);p.bind(m),d.addChild(I);var P=(I.getComponent(i)||I.addComponent(i)).contentSize,M=P.height&&P.height>0?P.height:100,b=P.width&&P.width>0?P.width:B||100;I.setPosition(0,-w-M/2,0),w+=M,b>B&&(B=b)},b=n(f);!(S=b()).done;)M();var C=t.node.getComponent(i),R=C?C.contentSize.width:0,V=C?C.contentSize.height:0,U=Math.max(B,R),y=Math.max(w,V);P.setContentSize(U,y)}else console.error("[ResourceProductionVM] No production options for "+g)}else console.error("[ResourceProductionVM] Building instance "+this.buildingInstanceId+" not found")}else console.error("[ResourceProductionVM] itemsScroll.content is not set")}else console.error("[ResourceProductionVM] itemsScroll or itemPrefab is not set")}},t.handleAction=function(e,n){var t=l.getInstance();null!==this.buildingInstanceId&&(n&&t.productionService.collect(e),this.renderItems())},e}());t._RF.pop()}}}));

System.register("chunks:///_virtual/ResourceProductionWindowView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./WindowView.ts"],(function(e){var i,o,t,n,r,l,c,u,s;return{setters:[function(e){i=e.applyDecoratedDescriptor,o=e.inheritsLoose,t=e.initializerDefineProperty,n=e.assertThisInitialized},function(e){r=e.cclegacy,l=e._decorator,c=e.ScrollView,u=e.Prefab},function(e){s=e.WindowView}],execute:function(){var a,d,f,w,p,h,b;r._RF.push({},"3bd40GJOuRKnJM53m/ky0wZ","ResourceProductionWindowView",void 0);var v=l.ccclass,y=l.property;e("ResourceProductionWindow",(a=v("ResourceProductionWindow"),d=y({type:c}),f=y({type:u}),a((h=i((p=function(e){function i(){for(var i,o=arguments.length,r=new Array(o),l=0;l<o;l++)r[l]=arguments[l];return i=e.call.apply(e,[this].concat(r))||this,t(i,"itemsScroll",h,n(i)),t(i,"itemPrefab",b,n(i)),i.viewModel=null,i}o(i,e);var r=i.prototype;return r.bind=function(e){this.viewModel=e,this.viewModel.bindView(this)},r.render=function(){this.viewModel||console.error("[ResourceProductionWindow] ViewModel is not bound")},r.getItemsScroll=function(){return this.itemsScroll},r.getItemPrefab=function(){return this.itemPrefab},r.onUpgrade=function(){var e;null==(e=this.viewModel)||e.upgrade()},r.close=function(){this.viewModel=null,this.node&&this.node.isValid&&this.node.destroy()},i}(s)).prototype,"itemsScroll",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),b=i(p.prototype,"itemPrefab",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),w=p))||w));r._RF.pop()}}}));

System.register("chunks:///_virtual/ServerChecker.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var r,t,n;return{setters:[function(e){r=e.asyncToGenerator,t=e.regeneratorRuntime},function(e){n=e.cclegacy}],execute:function(){n._RF.push({},"6891fvEic9JEK+FBFz8Qot/","ServerChecker",void 0),e("ServerChecker",function(){function e(){}return e.setIsClient=function(e){this.isClientOverride=e},e.check=function(){var n=r(t().mark((function r(n,s){var c,i,u,a,o,l,f,h,v=arguments;return t().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(e.isClient()){r.next=2;break}return r.abrupt("return",s);case 2:for(c=v.length,i=new Array(c>2?c-2:0),u=2;u<c;u++)i[u-2]=v[u];return a=new URLSearchParams({method:n,clientResult:JSON.stringify(s),args:JSON.stringify(i)}),o="http://127.0.0.1:3000?"+a.toString(),r.prev=5,r.next=8,fetch(o,{method:"GET"});case 8:if((f=r.sent).ok){r.next=12;break}return console.error("[ServerChecker] Server error for "+n+": status "+f.status),r.abrupt("return",s);case 12:if(!(null!=(l=f.headers.get("content-type"))?l:"").includes("application/json")){r.next=19;break}return r.next=16,f.json();case 16:r.t0=r.sent,r.next=22;break;case 19:return r.next=21,f.text();case 21:r.t0=r.sent;case 22:(h=r.t0)!==s&&console.error("[ServerChecker] Result mismatch for "+n+":","client=",s,"server=",h),r.next=29;break;case 26:r.prev=26,r.t1=r.catch(5),console.error("[ServerChecker] Request failed for "+n,r.t1);case 29:return r.abrupt("return",s);case 30:case"end":return r.stop()}}),r,null,[[5,26]])})));return function(e,r){return n.apply(this,arguments)}}(),e.isClient=function(){return e.isClientOverride},e}()).isClientOverride=!0,n._RF.pop()}}}));

System.register("chunks:///_virtual/StartGameButton.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var e,n,r,o;return{setters:[function(t){e=t.inheritsLoose},function(t){n=t.cclegacy,r=t._decorator,o=t.Component}],execute:function(){var u;n._RF.push({},"be32dvTOUJCkKa1Yse1hmAi","StartGameButton",void 0);var a=r.ccclass;r.property,t("StartGameButton",a("StartGameButton")(u=function(t){function n(){return t.apply(this,arguments)||this}e(n,t);var r=n.prototype;return r.start=function(){},r.update=function(t){},n}(o))||u);n._RF.pop()}}}));

System.register("chunks:///_virtual/StaticConfigModels.ts",["cc"],(function(i){var t;return{setters:[function(i){t=i.cclegacy}],execute:function(){t._RF.push({},"850baqneYhDPbvq/BSvUQsw","StaticConfigModels",void 0);i("UnitLine",function(i){return i.Line1="line1",i.Live2="line2",i.Line3="line3",i}({})),i("UnitData",(function(i,t,s,o,n,e,h,d,u,v,c){this.id=void 0,this.title=void 0,this.description=void 0,this.model=void 0,this.line=void 0,this.abils=void 0,this.hp=void 0,this.v_base=void 0,this.v_mult_snow=void 0,this.v_mult_desert=void 0,this.v_mult_jungle=void 0,this.id=i,this.title=t,this.description=s,this.model=o,this.line=n,this.abils=e,this.hp=h,this.v_base=d,this.v_mult_snow=u,this.v_mult_desert=v,this.v_mult_jungle=c})),i("Money",(function(i,t){this.type=void 0,this.amount=void 0,this.type=i,this.amount=t})),i("Price",(function(i){void 0===i&&(i=[]),this.money=void 0,this.money=i})),i("ProductionEntry",(function(i,t){this.produce=void 0,this.cost=void 0,this.produce=i,this.cost=t})),i("ResourceProductionEntry",(function(i,t,s){this.product=void 0,this.time=void 0,this.count=void 0,this.product=i,this.time=t,this.count=s}));t._RF.pop()}}}));

System.register("chunks:///_virtual/StaticConfigStore.ts",["./rollupPluginModLoBabelHelpers.js","cc","./PlayerBaseModels.ts","./StaticConfigModels.ts"],(function(i){var t,n,e,o,r,s,u,l,a,d;return{setters:[function(i){t=i.createForOfIteratorHelperLoose,n=i.asyncToGenerator,e=i.regeneratorRuntime},function(i){o=i.cclegacy},function(i){r=i.BuildingData},function(i){s=i.UnitData,u=i.ProductionEntry,l=i.ResourceProductionEntry,a=i.Price,d=i.Money}],execute:function(){o._RF.push({},"30ae15wpSxONIwX3upCVDm8","StaticConfigStore",void 0);var c=i("StaticConfigStore",function(){function i(){}return i.setDataLoader=function(i){this.dataLoader=i},i.init=function(){var i=n(e().mark((function i(t,n,o,r,s){var u,l,a,d,c,h;return e().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(void 0===t&&(t="Config/Buildings"),void 0===n&&(n="Config/Units"),void 0===o&&(o="Config/CombotantsProduction"),void 0===r&&(r="Config/ResourcesProdution"),void 0===s&&(s="GameStuff"),!this.initialized||this.buildingsPath!==t||this.unitsPath!==n||this.productionPath!==o||this.resourceProductionPath!==r||this.moneyPath!==s){i.next=7;break}return i.abrupt("return");case 7:return i.next=9,Promise.all([this.loadJson(t),this.loadJson(n),this.loadJson(o),this.loadJson(r),this.loadJson(s)]);case 9:u=i.sent,l=u[0],a=u[1],d=u[2],c=u[3],h=u[4],this.buildingModels=this.buildBuildingModels(l.buildings),this.buildingsConfig={buildings:Array.from(this.buildingModels.values())},this.unitsConfig=a,this.unitModels=this.buildUnitModels(a.Units),this.productionConfig=this.buildProductionConfig(d.Combotants),this.productionModels=this.buildProductionModels(this.productionConfig.Combotants),this.resourceProductionConfig=this.buildResourceProductionConfig(c),this.resourceProductionModels=this.buildResourceProductionModels(this.resourceProductionConfig),this.moneyConfig={Money:h.Money},this.moneyModels=this.buildMoneyModels(h.Money),this.battleRewardsConfig=this.buildBattleRewards(h.Battle),this.buildingsPath=t,this.unitsPath=n,this.productionPath=o,this.resourceProductionPath=r,this.moneyPath=s,this.initialized=!0;case 32:case"end":return i.stop()}}),i,this)})));return function(t,n,e,o,r){return i.apply(this,arguments)}}(),i.getBuildingsConfig=function(){return this.assertInitialized(),this.buildingsConfig},i.getBuildingModels=function(){return this.assertInitialized(),this.buildingModels},i.getUnitsConfig=function(){return this.assertInitialized(),this.unitsConfig},i.getUnitById=function(i){var t;return null!=(t=this.getUnitsConfig().Units.find((function(t){return t.id===i})))?t:null},i.getUnitModels=function(){return this.assertInitialized(),this.unitModels},i.getUnitConfigById=function(i){var t;return this.assertInitialized(),null!=(t=this.unitModels.get(i))?t:null},i.getProductionConfig=function(){return this.assertInitialized(),this.productionConfig},i.getProductionModels=function(){return this.assertInitialized(),this.productionModels},i.getProductionById=function(i){var t;return this.assertInitialized(),null!=(t=this.productionModels.get(i))?t:null},i.getResourceProductionConfig=function(){return this.assertInitialized(),this.resourceProductionConfig},i.getResourceProductionByBuildingId=function(i){var t;return this.assertInitialized(),null!=(t=this.resourceProductionModels.get(i))?t:null},i.getMoneyConfig=function(){return this.assertInitialized(),this.moneyConfig},i.getBattleRewards=function(){return this.assertInitialized(),this.battleRewardsConfig},i.getCurrencyIconByName=function(i){var t,n;return this.assertInitialized(),null!=(t=null==(n=this.moneyModels.get(i))?void 0:n.icon)?t:null},i.getCurrencyIconByPrice=function(i){this.assertInitialized();var t=i.money.find((function(i){return i.amount>0}));return t?this.getCurrencyIconByName(t.type):null},i.getBuildingConfigById=function(i){var t;return this.assertInitialized(),null!=(t=this.buildingsConfig.buildings.find((function(t){return t.id===i})))?t:null},i.assertInitialized=function(){if(!(this.initialized&&this.buildingsConfig&&this.buildingModels&&this.unitsConfig&&this.unitModels&&this.productionConfig&&this.productionModels&&this.resourceProductionConfig&&this.resourceProductionModels&&this.moneyConfig&&this.battleRewardsConfig&&this.moneyModels))throw new Error("StaticConfigStore is not initialized")},i.buildBuildingModels=function(i){for(var n,e=new Map,o=t(i);!(n=o()).done;){var s=n.value;e.set(s.id,new r(s.id,s.kind,s.buildingImage,s.buildingIcon,s.message,s.nextLevelBuildingId,this.normalizePrice(s.upgradeCost)))}return e},i.buildUnitModels=function(i){for(var n,e=new Map,o=t(i);!(n=o()).done;){var r,u=n.value,l=null!=(r=u.Abilities)?r:u.abils;e.set(u.id,new s(u.id,u.title,u.description,u.model,u.line,l,u.hp,u.v_base,u.v_mult_snow,u.v_mult_desert,u.v_mult_jungle))}return e},i.buildProductionModels=function(i){for(var t=new Map,n=0,e=Object.entries(i);n<e.length;n++){var o=e[n],r=o[0],s=o[1];t.set(r,s)}return t},i.buildProductionConfig=function(i){for(var t={},n=0,e=Object.entries(i);n<e.length;n++){var o=e[n],r=o[0],s=o[1];t[r]=new u(s.produce,this.normalizePrice(s.cost))}return{Combotants:t}},i.buildResourceProductionModels=function(i){for(var t=new Map,n=0,e=Object.entries(i);n<e.length;n++){var o=e[n],r=o[0],s=o[1];t.set(r,s)}return t},i.buildResourceProductionConfig=function(i){for(var t={},n=0,e=Object.entries(i);n<e.length;n++){var o=e[n],r=o[0],s=o[1];t[r]=s.map((function(i){var t=Math.max(0,Number(i.time)||0),n=Math.max(0,Number(i.count)||0);return new l(i.product,t,n)}))}return t},i.buildMoneyModels=function(i){for(var n,e=new Map,o=t(i);!(n=o()).done;){var r=n.value;e.set(r.name,{name:r.name,icon:r.icon})}return e},i.buildBattleRewards=function(i){var t,n;return{win:this.normalizePrice(null!=(t=null==i?void 0:i.WinReward)?t:{}),lose:this.normalizePrice(null!=(n=null==i?void 0:i.LooseReward)?n:{})}},i.normalizePrice=function(i){if(!i)return new a([]);if(i instanceof a)return new a(i.money.map((function(i){return new d(i.type,i.amount)})));var t=i;if(Array.isArray(t.money)){var n=t.money.map((function(i){var t;return new d(i.type,Math.max(0,null!=(t=i.amount)?t:0))}));return new a(n)}for(var e=[],o=0,r=Object.entries(i);o<r.length;o++){var s=r[o],u=s[0],l=s[1],c=Math.max(0,Number(l)||0);c>0&&e.push(new d(u,c))}return new a(e)},i.loadJson=function(i){return this.dataLoader?this.dataLoader.loadJson(i).then((function(t){try{return JSON.parse(t)}catch(t){throw new Error("Invalid JSON content at "+i)}})):Promise.reject(new Error("StaticConfigStore data loader is not set"))},i}());c.buildingsConfig=null,c.buildingModels=null,c.unitsConfig=null,c.unitModels=null,c.productionConfig=null,c.productionModels=null,c.resourceProductionConfig=null,c.resourceProductionModels=null,c.moneyConfig=null,c.battleRewardsConfig=null,c.moneyModels=null,c.initialized=!1,c.buildingsPath="",c.unitsPath="",c.productionPath="",c.resourceProductionPath="",c.moneyPath="",c.dataLoader=null,o._RF.pop()}}}));

System.register("chunks:///_virtual/TownhallShopContracts.ts",["cc"],(function(){var t;return{setters:[function(c){t=c.cclegacy}],execute:function(){t._RF.push({},"9dbc7oR8VZD46yBrOBio+jq","TownhallShopContracts",void 0),t._RF.pop()}}}));

System.register("chunks:///_virtual/TownhallShopItem.ts",["./rollupPluginModLoBabelHelpers.js","cc","./MoneyBar.ts"],(function(t){var e,i,n,r,o,l,a,u,c,s,p,h,y;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,n=t.initializerDefineProperty,r=t.assertThisInitialized},function(t){o=t.cclegacy,l=t._decorator,a=t.Sprite,u=t.Label,c=t.RichText,s=t.resources,p=t.SpriteFrame,h=t.Component},function(t){y=t.MoneyBar}],execute:function(){var b,f,m,d,B,g,w,I,T,v,L;o._RF.push({},"c5a48ExiUNC5Lba/Ama9dvF","TownhallShopItem",void 0);var x=l.ccclass,S=l.property;t("TownhallShopItem",(b=x("TownhallShopItem"),f=S({type:a}),m=S({type:u}),d=S({type:c}),B=S({type:y}),b((I=e((w=function(t){function e(){for(var e,i=arguments.length,o=new Array(i),l=0;l<i;l++)o[l]=arguments[l];return e=t.call.apply(t,[this].concat(o))||this,n(e,"unitIcon",I,r(e)),n(e,"titleLabel",T,r(e)),n(e,"descriptionText",v,r(e)),n(e,"moneyBar",L,r(e)),e.unit=null,e.onBuy=null,e}i(e,t);var o=e.prototype;return o.bind=function(t,e,i){var n=this;this.unit=t,this.onBuy=null!=i?i:null,this.titleLabel&&(this.titleLabel.string=t.title||t.id),this.descriptionText&&(this.descriptionText.string=t.description),this.moneyBar&&(this.moneyBar.init(e),this.moneyBar.showPriceLabel(!0)),this.unitIcon&&s.load(t.model,p,(function(t,e){t?console.error("Failed to load unit icon:",t):n.unitIcon&&(n.unitIcon.spriteFrame=e)}))},o.onDestroy=function(){},o.handleBuy=function(){this.unit&&this.onBuy&&this.onBuy(this.unit)},e}(h)).prototype,"unitIcon",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),T=e(w.prototype,"titleLabel",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),v=e(w.prototype,"descriptionText",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),L=e(w.prototype,"moneyBar",[B],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),g=w))||g));o._RF.pop()}}}));

System.register("chunks:///_virtual/TownhallShopView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./WindowView.ts"],(function(e){var n,t,i,o,l,r,u,c,a;return{setters:[function(e){n=e.applyDecoratedDescriptor,t=e.inheritsLoose,i=e.initializerDefineProperty,o=e.assertThisInitialized},function(e){l=e.cclegacy,r=e._decorator,u=e.ScrollView,c=e.Prefab},function(e){a=e.WindowView}],execute:function(){var s,h,w,p,d,f,v;l._RF.push({},"65e5ex38cdI14KtqSfS+Kg4","TownhallShopView",void 0);var y=r.ccclass,b=r.property;e("TownhallShopView",(s=y("TownhallShopView"),h=b({type:u}),w=b({type:c}),s((f=n((d=function(e){function n(){for(var n,t=arguments.length,l=new Array(t),r=0;r<t;r++)l[r]=arguments[r];return n=e.call.apply(e,[this].concat(l))||this,i(n,"itemsScroll",f,o(n)),i(n,"townhallItem",v,o(n)),n.viewModel=null,n}t(n,e);var l=n.prototype;return l.bind=function(e){this.viewModel=e,this.viewModel.bindView(this)},l.render=function(){this.viewModel||console.error("TownhallShopViewModel is not bound")},l.getItemsScroll=function(){return this.itemsScroll},l.getTownhallItemPrefab=function(){return this.townhallItem},l.onUpgrade=function(){var e;null==(e=this.viewModel)||e.upgrade()},l.onBuy=function(){var e;null==(e=this.viewModel)||e.buy()},l.onClose=function(){var e;null==(e=this.viewModel)||e.close()},l.close=function(){this.viewModel=null,this.node.destroy()},n}(a)).prototype,"itemsScroll",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),v=n(d.prototype,"townhallItem",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),p=d))||p));l._RF.pop()}}}));

System.register("chunks:///_virtual/TownhallShopViewModel.ts",["cc","./StaticConfigStore.ts","./TownhallShopItem.ts","./UserService.ts","./MessageFlyer.ts","./StaticConfigModels.ts"],(function(e){var o,t,n,i,r,l,c,s;return{setters:[function(e){o=e.cclegacy,t=e.UITransform,n=e.instantiate},function(e){i=e.StaticConfigStore},function(e){r=e.TownhallShopItem},function(e){l=e.UserService},function(e){c=e.MessageFlyer},function(e){s=e.Price}],execute:function(){o._RF.push({},"5d91dmjmElAxYDhuL9OqkBp","TownhallShopViewModel",void 0);e("TownhallShopViewModel",function(){function e(){this.view=null}var o=e.prototype;return o.bindView=function(e){var o=this;this.view=e,this.view.render();var l=this.view.getItemsScroll(),c=this.view.getTownhallItemPrefab();if(l&&c){var s=l.content;if(s){var h=0,a=s.getComponent(t)||s.addComponent(t),u=a.contentSize.width||0,d=i.getProductionConfig().Combotants;Object.entries(d).forEach((function(e){var l=e[0],a=e[1],d=i.getUnitConfigById(a.produce);if(d){console.log("[TownhallShop] Available unit: "+d.id);var f=n(c),p=f.getComponent(r);if(p){var w=o.getPrice(l);p.bind(d,w,(function(){o.buy(d)})),s.addChild(f);var g=(f.getComponent(t)||f.addComponent(t)).contentSize,S=g.height&&g.height>0?g.height:100,v=g.width&&g.width>0?g.width:u||100;f.setPosition(0,-h-S/2,0),h+=S,v>u&&(u=v)}else console.error("[TownhallShop] TownhallShopItem component is missing on prefab")}else console.error("[TownhallShop] Unit config not found for "+a.produce)}));var f=l.node.getComponent(t),p=f?f.contentSize.width:0,w=f?f.contentSize.height:0,g=Math.max(u,p),S=Math.max(h,w);a.setContentSize(g,S)}else console.error("[TownhallShop] itemsScroll.content is not set")}else console.error("[TownhallShop] itemsScroll or townhallItem prefab is not set")},o.buy=function(e){var o=i.getProductionById(e.id);if(o){var t=l.getInstance();if(!t.walletService.canSpend(o.cost))return console.error("[TownhallShop] Not enough currency to buy "+e.id),void c.create("Not enough currency to buy this unit!");t.itemsService.buyItem(e.id,1),console.log("[TownhallShop] Bought "+e.id)}else console.error("[TownhallShop] Production config not found for "+e.id)},o.upgrade=function(){c.create("Not implemented yet")},o.close=function(){var e;null==(e=this.view)||e.close(),this.dispose()},o.dispose=function(){this.view&&(this.view.close(),this.view=null)},o.getPrice=function(e){var o=i.getProductionById(e);return o?o.cost:new s([])},e}());o._RF.pop()}}}));

System.register("chunks:///_virtual/UserModels.ts",["cc"],(function(){var e;return{setters:[function(s){e=s.cclegacy}],execute:function(){e._RF.push({},"c6614jBlG5Eb4P5Q4EaGs1+","UserModels",void 0),e._RF.pop()}}}));

System.register("chunks:///_virtual/UserMoneyBar.ts",["./rollupPluginModLoBabelHelpers.js","cc","./EventBus.ts","./UserService.ts","./MoneyBar.ts"],(function(e){var n,o,r,t,i,a,s,l,c,u,h,y;return{setters:[function(e){n=e.applyDecoratedDescriptor,o=e.inheritsLoose,r=e.initializerDefineProperty,t=e.assertThisInitialized},function(e){i=e.cclegacy,a=e._decorator,s=e.Node,l=e.Component},function(e){c=e.bus,u=e.Events},function(e){h=e.UserService},function(e){y=e.MoneyBar}],execute:function(){var f,B,d,p,v;i._RF.push({},"7842c/uhoBG9YHsN6WxuP9n","UserMoneyBar",void 0);var m=a.ccclass,M=a.property;e("UserMoneyBar",(f=m("UserMoneyBar"),B=M({type:s}),f((v=n((p=function(e){function n(){for(var n,o=arguments.length,i=new Array(o),a=0;a<o;a++)i[a]=arguments[a];return n=e.call.apply(e,[this].concat(i))||this,r(n,"moneyBarNode",v,t(n)),n.moneyBar=null,n}o(n,e);var i=n.prototype;return i.onLoad=function(){this.moneyBar=this.resolveMoneyBar(),c.on(u.WALLET_CHANGED,this.onWalletChanged,this),c.on(u.RESOURCE_PRODUCTED,this.onResourceProduced,this)},i.onEnable=function(){var e;this.moneyBar=null!=(e=this.moneyBar)?e:this.resolveMoneyBar(),this.refreshFromWallet()},i.onDestroy=function(){c.off(u.WALLET_CHANGED,this.onWalletChanged,this),c.off(u.RESOURCE_PRODUCTED,this.onResourceProduced,this)},i.refreshFromWallet=function(){var e=h.getInstance().walletService;this.updateMoneyBar(e.getBalance())},i.onWalletChanged=function(e){console.log("[UserMoneyBar] Wallet changed event received:",e),this.updateMoneyBar(e.balance)},i.onResourceProduced=function(){this.refreshFromWallet()},i.updateMoneyBar=function(e){this.moneyBar&&this.moneyBar.init(e)},i.resolveMoneyBar=function(){var e,n,o=null!=(e=this.moneyBarNode)?e:this.node,r=null!=(n=o.getComponent(y))?n:o.getComponentInChildren(y);return r||console.error("[UserMoneyBar] MoneyBar component is missing"),r},n}(l)).prototype,"moneyBarNode",[B],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),d=p))||d));i._RF.pop()}}}));

System.register("chunks:///_virtual/UserService.ts",["cc","./BuildingService.ts","./BattleService.ts","./ItemsService.ts","./ProductionService.ts","./WalletService.ts","./StaticConfigModels.ts"],(function(e){var i,t,n,r,c,s,l,o;return{setters:[function(e){i=e.cclegacy},function(e){t=e.BuildingService},function(e){n=e.BattleService},function(e){r=e.ItemsService},function(e){c=e.ProductionService},function(e){s=e.WalletService},function(e){l=e.Price,o=e.Money}],execute:function(){i._RF.push({},"8d433ypbSpNiZyWfQqnFFKh","UserService",void 0),e("UserService",function(){function e(){this.buildingService=void 0,this.walletService=void 0,this.itemsService=void 0,this.productionService=void 0,this.battleService=void 0,this.walletService=new s,this.buildingService=new t(this.walletService),this.itemsService=new r,this.productionService=new c(this.buildingService,this.walletService),this.battleService=new n(this.walletService)}e.getInstance=function(){return this.instance||(this.instance=new e),this.instance};var i=e.prototype;return i.applyUserData=function(e,i){var t,n,r;void 0===i&&(i=0);var c=this.normalizeWallet(e.wallet,i);this.walletService.setBalance(c),this.buildingService.setBuildingInstances(null!=(t=null==(n=e.Buildings)?void 0:n.cells)?t:[]),this.itemsService.setItems(null!=(r=e.items)?r:null),this.productionService.ensureProductionsStarted()},i.printState=function(){console.log("[UserService] State:"),console.log("[UserService] Wallet:",this.walletService.getBalance()),console.log("[UserService] Items:",this.itemsService.getAll()),console.log("[UserService] Buildings:",this.buildingService.getAllBuildingLevels())},i.normalizeWallet=function(e,i){if(!e)return new l(i>0?[new o("soft",i)]:[]);if(e instanceof l)return new l(e.money.map((function(e){return new o(e.type,e.amount)})));if(this.isPriceShape(e)){var t=e.money.map((function(e){var i;return new o(e.type,Math.max(0,null!=(i=e.amount)?i:0))}));return new l(t)}for(var n=[],r=0,c=Object.entries(e);r<c.length;r++){var s=c[r],u=s[0],a=s[1],v=Math.max(0,Number(a)||0);v>0&&n.push(new o(u,v))}return 0===n.length&&i>0&&n.push(new o("soft",i)),new l(n)},i.isPriceShape=function(e){return"object"==typeof e&&null!==e&&Array.isArray(e.money)},e}()).instance=null,i._RF.pop()}}}));

System.register("chunks:///_virtual/WalletService.ts",["./rollupPluginModLoBabelHelpers.js","cc","./EventBus.ts","./StaticConfigModels.ts"],(function(e){var n,t,a,r,i,o;return{setters:[function(e){n=e.createForOfIteratorHelperLoose},function(e){t=e.cclegacy},function(e){a=e.bus,r=e.Events},function(e){i=e.Price,o=e.Money}],execute:function(){t._RF.push({},"d22daX9g1BHLYTbCkEkg76w","WalletService",void 0);e("WalletService",function(){function e(){this.balance=new i([])}var t=e.prototype;return t.getBalance=function(){return console.log("[WalletService] getBalance -> "+this.formatPrice(this.balance)),this.clonePrice(this.balance)},t.setBalance=function(e){var n=this.normalizePrice(e);console.log("[WalletService] setBalance from "+this.formatPrice(this.balance)+" to "+this.formatPrice(n)),this.balance=n,this.emitBalanceChanged()},t.add=function(e){var n=this.normalizePrice(e);this.isZeroPrice(n)?console.log("[WalletService] add skipped: amount must be > 0"):(this.balance=this.applyDelta(this.balance,n,1),console.log("[WalletService] add applied: new balance "+this.formatPrice(this.balance)),this.emitBalanceChanged())},t.canSpend=function(e){var t=this.normalizePrice(e);if(this.isZeroPrice(t))return!0;for(var a,r=this.toMap(this.balance),i=!0,o=n(t.money);!(a=o()).done;){var c,l=a.value,s=null!=(c=r.get(l.type))?c:0;if(l.amount>s){i=!1;break}}return console.log("[WalletService] canSpend "+this.formatPrice(t)+"? "+i),i},t.spend=function(e){var n=this.normalizePrice(e);return console.log("[WalletService] spend requested "+this.formatPrice(n)),!!this.isZeroPrice(n)||(this.canSpend(n)?(this.balance=this.applyDelta(this.balance,n,-1),console.log("[WalletService] spend succeeded: new balance "+this.formatPrice(this.balance)),this.emitBalanceChanged(),!0):(console.log("[WalletService] spend failed: insufficient funds"),!1))},t.normalizePrice=function(e){if(!e)return new i([]);if(e instanceof i)return this.clonePrice(e);var n=e;if(Array.isArray(n.money)){var t=n.money.map((function(e){var n;return new o(e.type,Math.max(0,null!=(n=e.amount)?n:0))}));return new i(t)}for(var a=[],r=0,c=Object.entries(e);r<c.length;r++){var l=c[r],s=l[0],u=l[1],h=Math.max(0,Number(u)||0);h>0&&a.push(new o(s,h))}return new i(a)},t.isZeroPrice=function(e){return e.money.every((function(e){return e.amount<=0}))},t.formatPrice=function(e){return 0===e.money.length?"empty":e.money.map((function(e){return e.type+" "+e.amount})).join(", ")},t.toMap=function(e){for(var t,a=new Map,r=n(e.money);!(t=r()).done;){var i,o,c=t.value,l=Math.max(0,null!=(i=c.amount)?i:0);l<=0||a.set(c.type,(null!=(o=a.get(c.type))?o:0)+l)}return a},t.applyDelta=function(e,t,a){for(var r,i=this.toMap(e),o=n(t.money);!(r=o()).done;){var c,l=r.value,s=null!=(c=i.get(l.type))?c:0;i.set(l.type,s+l.amount*a)}return this.mapToPrice(i)},t.mapToPrice=function(e){for(var t,a=[],r=n(e.entries());!(t=r()).done;){var c=t.value,l=c[0],s=c[1];s>0&&a.push(new o(l,s))}return new i(a)},t.clonePrice=function(e){return new i(e.money.map((function(e){return new o(e.type,e.amount)})))},t.emitBalanceChanged=function(){a.emit(r.WALLET_CHANGED,{balance:this.clonePrice(this.balance)})},e}());t._RF.pop()}}}));

System.register("chunks:///_virtual/WindowManager.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(n){var e,a,r,t,o,i,s,c,l,p,f,d;return{setters:[function(n){e=n.applyDecoratedDescriptor,a=n.inheritsLoose,r=n.initializerDefineProperty,t=n.assertThisInitialized,o=n.createForOfIteratorHelperLoose},function(n){i=n.cclegacy,s=n._decorator,c=n.Canvas,l=n.Prefab,p=n.instantiate,f=n.js,d=n.Component}],execute:function(){var u,g,w,b,v,M,h,m;i._RF.push({},"78fb8xEGqZH6bvuzLwWdgLW","WindowManager",void 0);var y=s.ccclass,W=s.property;n("WindowManager",(u=y("WindowManager"),g=W({type:c}),w=W({type:[l]}),u(((m=function(n){function e(){for(var e,a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return e=n.call.apply(n,[this].concat(o))||this,r(e,"canvas",M,t(e)),r(e,"windowPrefabs",h,t(e)),e.prefabMap=new Map,e.componentAliasMap=new Map,e}a(e,n);var i=e.prototype;return i.onLoad=function(){if(null===e.instance)e.instance=this;else if(e.instance!==this)return void this.node.destroy()},e.getInstance=function(){return e.instance||console.error("[WindowManager] Instance not initialized"),e.instance},i.start=function(){this.buildPrefabMap()},i.buildPrefabMap=function(){this.prefabMap.clear();for(var n,e=o(this.windowPrefabs);!(n=e()).done;){var a=n.value;if(a){this.prefabMap.set(a.name,a),console.log("[WindowManager] Registered prefab: "+a.name);try{var r=p(a);this.indexComponentsInNode(r,a.name),r.destroy()}catch(n){console.warn("[WindowManager] Failed to index prefab "+a.name+":",n)}}}},i.indexComponentsInNode=function(n,e){if(n)for(var a,r=n.components,t=o(r);!(a=t()).done;){var i=a.value;if(i){var s=f.getClassName(i)||i.constructor.name;this.prefabMap.set(s,this.windowPrefabs.find((function(n){return(null==n?void 0:n.name)===e})))}}},i.createWindow=function(n){var e=f.getClassName(n)||n.name,a=this.prefabMap.get(e);if(!a){var r=this.componentAliasMap.get(e);r&&(a=this.prefabMap.get(r))}if(!a)return console.error("[WindowManager] Prefab for type '"+e+"' not found"),null;if(!this.canvas)return console.error("[WindowManager] Canvas is not assigned"),null;var t=p(a);this.canvas.node.addChild(t);var o=t.getComponent(n);return o?(console.log("[WindowManager] Window '"+e+"' created"),o):(console.error("[WindowManager] Component '"+e+"' not found on window node"),null)},i.registerPrefab=function(n,e){this.prefabMap.set(n,e)},i.registerComponentAlias=function(n,e){this.componentAliasMap.set(n.name,e),console.log("[WindowManager] Registered alias: "+n.name+" -> "+e)},e}(d)).instance=null,M=e((v=m).prototype,"canvas",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),h=e(v.prototype,"windowPrefabs",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),b=v))||b));i._RF.pop()}}}));

System.register("chunks:///_virtual/WindowView.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var o,n,t,i,r,c,l,s;return{setters:[function(e){o=e.inheritsLoose},function(e){n=e.cclegacy,t=e._decorator,i=e.Node,r=e.BlockInputEvents,c=e.UITransform,l=e.view,s=e.Component}],execute:function(){var d;n._RF.push({},"311a3cCxdlFErkJwVGZZ8xK","WindowView",void 0);var h=t.ccclass;e("WindowView",h("WindowView")(d=function(e){function n(){for(var o,n=arguments.length,t=new Array(n),i=0;i<n;i++)t[i]=arguments[i];return(o=e.call.apply(e,[this].concat(t))||this).blockerNode=null,o}o(n,e);var t=n.prototype;return t.onLoad=function(){this.ensureBlocker()},t.onEnable=function(){this.syncBlockerSize()},t.ensureBlocker=function(){var e=this.node.getChildByName("WindowInputBlocker");this.blockerNode=null!=e?e:new i("WindowInputBlocker"),this.blockerNode.parent||this.node.addChild(this.blockerNode),this.blockerNode.layer=this.node.layer,this.blockerNode.setSiblingIndex(0),this.blockerNode.setPosition(0,0,0),this.blockerNode.getComponent(r)||this.blockerNode.addComponent(r),this.blockerNode.getComponent(c)||this.blockerNode.addComponent(c),this.syncBlockerSize()},t.syncBlockerSize=function(){if(this.blockerNode){var e=this.blockerNode.getComponent(c);if(e){var o=l.getVisibleSize();e.setContentSize(o.width,o.height)}}},n}(s))||d);n._RF.pop()}}}));

(function(r) {
  r('virtual:///prerequisite-imports/main', 'chunks:///_virtual/main'); 
})(function(mid, cid) {
    System.register(mid, [cid], function (_export, _context) {
    return {
        setters: [function(_m) {
            var _exportObj = {};

            for (var _key in _m) {
              if (_key !== "default" && _key !== "__esModule") _exportObj[_key] = _m[_key];
            }
      
            _export(_exportObj);
        }],
        execute: function () { }
    };
    });
});