System.register("chunks:///_virtual/BaseAbil.ts",["cc"],(function(t){var i;return{setters:[function(t){i=t.cclegacy}],execute:function(){i._RF.push({},"9b438R6UM9En66w1nZMEFGO","BaseAbil",void 0);t("BaseAbil",function(){function t(t,i,n,e){this.abilConfig=void 0,this.battleLog=void 0,this.battleground=void 0,this.abilConfig=t,this.battleLog=n,this.battleground=e}return t.prototype.tick=function(t,i){},t}());i._RF.pop()}}}));

System.register("chunks:///_virtual/BattleBombView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./BattleViewCommon.ts"],(function(e){var o,t,i,n,r,l,a,c,s,p,u,d;return{setters:[function(e){o=e.applyDecoratedDescriptor,t=e.inheritsLoose,i=e.initializerDefineProperty,n=e.assertThisInitialized},function(e){r=e.cclegacy,l=e._decorator,a=e.ParticleSystem,c=e.Node,s=e.tween,p=e.Component},function(e){u=e.getRealXFromRelative,d=e.getRealYFromLine}],execute:function(){var b,m,y,f,v,h,B;r._RF.push({},"6dcc0+y8k1GkIsvlzGxRaXi","BattleBombView",void 0);var x=l.ccclass,g=l.property;e("BattleBombView",(b=x("BattleBombView"),m=g({type:a}),y=g({type:c}),b((h=o((v=function(e){function o(){for(var o,t=arguments.length,r=new Array(t),l=0;l<t;l++)r[l]=arguments[l];return o=e.call.apply(e,[this].concat(r))||this,i(o,"explosion",h,n(o)),i(o,"bombNode",B,n(o)),o}return t(o,e),o.prototype.init=function(e,o,t,i,n){var r=this;this.explosion.node.active=!1;var l=u(o),a=d(e),c=u(n),p=d(i);this.node.setPosition(l,a,0),console.log("Bomb launched from ("+l+", "+a+") to ("+c+", "+p+") over "+t+" seconds."),s(this.node).to(t,{position:{x:c,y:p,z:0}}).call((function(){r.bombNode.active=!1,r.explosion.node.active=!0,r.explosion.stop(),r.explosion.clear(),r.explosion.play()})).delay(3).call((function(){r.node.destroy()})).start()},o}(p)).prototype,"explosion",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),B=o(v.prototype,"bombNode",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),f=v))||f));r._RF.pop()}}}));

System.register("chunks:///_virtual/Battleground.ts",["./rollupPluginModLoBabelHelpers.js","cc","./CommonBattle.ts","./BattleStateMachine.ts"],(function(t){var n,e,a,i;return{setters:[function(t){n=t.createForOfIteratorHelperLoose},function(t){e=t.cclegacy},function(t){a=t.BattleTeam},function(t){i=t.BattleUnitState}],execute:function(){e._RF.push({},"59391kMDANBBYDglOCYagFd","Battleground",void 0);t("Battleground",function(){function t(){this.team1Units=[],this.team2Units=[]}var e=t.prototype;return e.startBattle=function(){this.team1Units.forEach((function(t){return t.startBattle()})),this.team2Units.forEach((function(t){return t.startBattle()}))},e.getEnemyTeam=function(t){return t==a.Team1?this.team2Units:t==a.Team2?this.team1Units:(console.error("REQUEST UNONOWN TEAM: ",t),null)},e.getEnemyAtLine=function(t){var n=this.getEnemyTeam(t.team);if(null===n)return null;var e=null,a=1/0;return n.forEach((function(n){var r=Math.abs(t.position-n.position);r<a&&n.unitData.line===t.unitData.line&&n.stateMachine.getState()!==i.Dead&&(a=r,e=n)})),e},e.getEnemyAtLineByLine=function(t,e){var a=this.getEnemyTeam(t);if(null===a)return null;for(var i,r=n(a);!(i=r()).done;){var u=i.value;if(u.unitData.line===e)return u}return null},e.update=function(t,n){this.team1Units.forEach((function(e){return e.update(t,n)})),this.team2Units.forEach((function(e){return e.update(t,n)}))},e.finishBattle=function(){this.team1Units.forEach((function(t){return t.finishBattle()})),this.team2Units.forEach((function(t){return t.finishBattle()}))},t}());e._RF.pop()}}}));

System.register("chunks:///_virtual/BattleLog.ts",["cc"],(function(t){var e;return{setters:[function(t){e=t.cclegacy}],execute:function(){e._RF.push({},"53802BxY01Fx6RiO+Jjgdll","BattleLog",void 0);t("BattleLog",function(){function t(t,e){this.version=1,this.battleId=void 0,this.startedAt=void 0,this.events=[],this.battleId=t,this.startedAt=e}var e=t.prototype;return e.addEvent=function(t){this.events.push(t)},e.addStartEvent=function(t,e,n){this.events.push({t:"start",seed:t,user_squad:e,enemy_squad:n})},e.addMoveEvent=function(t,e,n,s,i){this.events.push({t:"mv",unit:t,time:e,fromPos:n,finishTime:s,toPos:i})},e.addChangeHpEvent=function(t,e,n){this.events.push({t:"chp",time:t,unit:e,newHp:n})},e.addDeathEvent=function(t,e){this.events.push({t:"death",time:t,unit:e})},e.addBombEvent=function(t,e,n,s,i,a){this.events.push({t:"bomb",time:t,startLine:e,startPos:n,finishTime:s,targetLine:i,targetPos:a})},e.addBulletShotEvent=function(t,e,n){this.events.push({t:"bullet_shot",time:t,attacker:e,target:n})},e.addFinishEvent=function(t,e,n,s,i,a){this.events.push({t:"finish",time:t,winner:e,team1FinishedUnits:n,team1Score:s,team2FinishedUnits:i,team2Score:a})},e.getEvents=function(){return this.events},e.toJSON=function(){return{version:this.version,battleId:this.battleId,startedAt:this.startedAt,events:this.events}},t}());e._RF.pop()}}}));

System.register("chunks:///_virtual/BattleLogic.ts",["cc","./BattleLog.ts","./CommonBattle.ts","./BattleStateMachine.ts","./BattleUnit.ts","./Battleground.ts"],(function(t){var e,n,a,i,o,s;return{setters:[function(t){e=t.cclegacy},function(t){n=t.BattleLog},function(t){a=t.BattleTeam},function(t){i=t.BattleUnitState},function(t){o=t.BattleUnit},function(t){s=t.Battleground}],execute:function(){e._RF.push({},"66653zBvnpPnq32xucJxmmD","BattleLogic",void 0),t("BattleLogic",function(){function t(e,i){var l=this;this.battleConfig=void 0,this.unitsConfig=void 0,this.battleLog=void 0,this.battleground=void 0,this.battleConfig=this.parseJson(e),this.unitsConfig=this.parseJson(i),this.battleground=new s,this.battleLog=new n("battle_"+Date.now(),Date.now());var u=0,r={},g={};this.battleConfig.user_config.squad.forEach((function(e){var n=l.unitsConfig.Units.find((function(t){return t.id===e}));if(n){var i=new o(u,n,l.battleConfig,l.battleLog,l.battleground,a.Team1,t.fightDistance);r[u]=n.id,console.log("Adding ALLY battle unit: "+i),l.battleground.team1Units.push(i),u+=1}})),this.battleConfig.enemy_config.squad.forEach((function(e){var n=l.unitsConfig.Units.find((function(t){return t.id===e}));if(n){var i=new o(u,n,l.battleConfig,l.battleLog,l.battleground,a.Team2,t.fightDistance);g[u]=n.id,l.battleground.team2Units.push(i)}u+=1})),this.battleLog.addStartEvent(Math.floor(1e6*Math.random()),r,g)}var e=t.prototype;return e.simulateBattle=function(){var t=this;this.battleground.startBattle();for(var e=!1,n=1/30,o=120,s=function(){t.battleground.update(n,120-o),(o-=n)<=0&&(console.log("Battle ended in a draw due to time out."),e=!0);var a=0,s=0,l=0,u=0;t.battleground.team1Units.forEach((function(t){t.stateMachine.getState()!=i.Dead&&(a++,t.position>=100&&l++)})),t.battleground.team2Units.forEach((function(t){t.stateMachine.getState()!=i.Dead&&(s++,t.position<=0&&u++)})),a==l&&s==u&&(console.log("Battle ended. User alive: "+a+" (finished: "+l+"), Enemy alive: "+s+" (finished: "+u+")"),e=!0)};!e;)s();this.battleground.finishBattle();var l,u=0,r=0,g=0,c=0;return this.battleground.team1Units.forEach((function(t){u+=t.causedDamage,t.stateMachine.getState()!=i.Dead&&t.position>=100&&g++})),this.battleground.team2Units.forEach((function(t){r+=t.causedDamage,t.stateMachine.getState()!=i.Dead&&t.position<=0&&c++})),l=g!=c?g>c?a.Team1:a.Team2:u>r?a.Team1:a.Team2,this.battleLog.addFinishEvent(120-o,l,g,u,c,r),console.log("Battle Log:",JSON.stringify(this.battleLog,null,2)),JSON.stringify(this.battleLog,null,2)},e.parseJson=function(t){return JSON.parse(t)},t}()).fightDistance=20,e._RF.pop()}}}));

System.register("chunks:///_virtual/BattleManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./BattleUnitView.ts","./BattleBombView.ts","./BulletShotView.ts","./CommonBattle.ts"],(function(t){var e,i,n,a,r,l,o,s,b,u,h,c,f,m,p;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,n=t.initializerDefineProperty,a=t.assertThisInitialized},function(t){r=t.cclegacy,l=t._decorator,o=t.Node,s=t.Prefab,b=t.Label,u=t.instantiate,h=t.Component},function(t){c=t.BattleUnitView},function(t){f=t.BattleBombView},function(t){m=t.BulletShotView},function(t){p=t.BattleTeam}],execute:function(){var w,d,v,g,B,S,V,y,P,L,U,N,T,z,C,M,_,I,D;r._RF.push({},"07e9eI6lwZJx5ZJWVSZVA7N","BattleManager",void 0);var F=l.ccclass,H=l.property;t("BattleManager",(w=F("BattleManager"),d=H({type:o}),v=H({type:s}),g=H({type:s}),B=H({type:s}),S=H({type:b}),V=H({type:b}),y=H({type:b}),P=H({type:o}),w((N=e((U=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),l=0;l<i;l++)r[l]=arguments[l];return e=t.call.apply(t,[this].concat(r))||this,n(e,"battleNode",N,a(e)),n(e,"battleUnitViewPrefab",T,a(e)),n(e,"battleBombViewPrefab",z,a(e)),n(e,"bulletShotViewPrefab",C,a(e)),n(e,"winnerLabel",M,a(e)),n(e,"team1ScoreLabel",_,a(e)),n(e,"team2ScoreLabel",I,a(e)),n(e,"finishBattleNode",D,a(e)),e.battleUnitViews=new Map,e.events=[],e.timeSinceBattleStart=0,e}i(e,t);var r=e.prototype;return r.initBattle=function(t){var e=JSON.parse(t);if(this.events=e.events,this.events.sort((function(t,e){var i,n;return(null!=(i=t.time)?i:0)-(null!=(n=e.time)?n:0)})),this.finishBattleNode.active=!1,"start"===this.events[0].t){var i=this.events[0].user_squad;for(var n in i){var a=i[n],r=u(this.battleUnitViewPrefab).getComponent(c);r.node.setScale(-1,1,1),r.init(parseInt(n),a,p.Team1),this.battleNode.addChild(r.node),this.battleUnitViews.set(parseInt(n),r)}var l=this.events[0].enemy_squad;for(var o in l){var s=l[o],b=u(this.battleUnitViewPrefab).getComponent(c);b.init(parseInt(o),s,p.Team2),this.battleNode.addChild(b.node),this.battleUnitViews.set(parseInt(o),b)}this.events.shift()}else console.error("Battle log does not start with a start event");console.log("[BattleManager] Battle started with "+this.events.length+" events."+this.events)},r.update=function(t){if(this.timeSinceBattleStart+=t,0!==this.events.length&&this.timeSinceBattleStart>=this.events.at(0).time){var e=this.events.shift();if("mv"===e.t){var i=e.unit,n=e.fromPos,a=e.toPos,r=this.battleUnitViews.get(i);r&&r.moveTo(n,a,e.finishTime-e.time)}if("chp"===e.t){var l=e.unit,o=e.newHp,s=this.battleUnitViews.get(l);s&&s.changeHp(o)}if("bomb"===e.t){var b=u(this.battleBombViewPrefab).getComponent(f);b.init(e.startLine,e.startPos,e.finishTime-e.time,e.targetLine,e.targetPos),this.battleNode.addChild(b.node)}if("bullet_shot"===e.t){var h=u(this.bulletShotViewPrefab).getComponent(m);h.init(this.battleUnitViews.get(e.attacker),this.battleUnitViews.get(e.target).node),this.battleNode.addChild(h.node)}if("death"===e.t){var c=e.unit,w=this.battleUnitViews.get(c);w&&w.death()}"finish"===e.t&&(e.winner===p.Team1?this.winnerLabel.string="Team 1 Wins!":this.winnerLabel.string="Team 2 Wins!",this.team1ScoreLabel.string="Team 1 Score: "+e.team1Score.toString(),this.team2ScoreLabel.string="Team 2 Score: "+e.team2Score.toString(),this.finishBattleNode.active=!0)}},r.closeBattle=function(){this.node.removeFromParent()},e}(h)).prototype,"battleNode",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),T=e(U.prototype,"battleUnitViewPrefab",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),z=e(U.prototype,"battleBombViewPrefab",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),C=e(U.prototype,"bulletShotViewPrefab",[B],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),M=e(U.prototype,"winnerLabel",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_=e(U.prototype,"team1ScoreLabel",[V],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),I=e(U.prototype,"team2ScoreLabel",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),D=e(U.prototype,"finishBattleNode",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),L=U))||L));r._RF.pop()}}}));

System.register("chunks:///_virtual/BattleStateMachine.ts",["cc"],(function(t){var e;return{setters:[function(t){e=t.cclegacy}],execute:function(){e._RF.push({},"60c06RzBtFOQpaJ4fBc/B5K","BattleStateMachine",void 0);var a=t("BattleUnitState",function(t){return t.Preparing="preparing",t.Moving="moving",t.CloseCombat="close_combat",t.Dead="dead",t}({}));t("BattleUnitStateMachine",function(){function t(t){this.state=void 0,this.onStateChange=void 0,this.state=a.Preparing,this.onStateChange=t}var e=t.prototype;return e.setOnStateChange=function(t){this.onStateChange=t},e.setState=function(t){if(this.state!==t){var e=this.state;this.state=t,this.onStateChange&&e!==t&&this.onStateChange(e,t)}},e.getState=function(){return this.state},t}());e._RF.pop()}}}));

System.register("chunks:///_virtual/BattleUnit.ts",["cc","./CommonBattle.ts","./BattleStateMachine.ts","./BombAbil.ts","./BulletShotAbil.ts"],(function(t){var i,e,a,s,n,o;return{setters:[function(t){i=t.cclegacy},function(t){e=t.BattleTeam},function(t){a=t.BattleUnitState,s=t.BattleUnitStateMachine},function(t){n=t.BombAbil},function(t){o=t.BulletShotAbil}],execute:function(){i._RF.push({},"753acSiGqRMvqd1iIBz1vNY","BattleUnit",void 0);t("BattleUnit",function(){function t(t,i,n,o,h,c,l){var r=this;this.unitData=void 0,this.battleConfig=void 0,this.hp=void 0,this.position=void 0,this.team=void 0,this.battleLog=void 0,this.battleground=void 0,this.battleUnitId=void 0,this.closeCombatDistance=void 0,this.movingStartTime=void 0,this.movingStartPos=void 0,this.curTimeFromStart=void 0,this.stateMachine=void 0,this.abils=[],this.causedDamage=0,this.unitStateChange=function(t,i){t!==a.Moving&&i===a.Moving&&(r.movingStartTime=r.curTimeFromStart,r.movingStartPos=r.position),t===a.Moving&&i!==a.Moving&&r.finishMoveEvent(),i===a.Dead&&r.battleLog.addDeathEvent(r.curTimeFromStart,r.battleUnitId),a.CloseCombat},this.unitData=i,this.battleLog=o,this.battleConfig=n,this.hp=i.hp,this.team=c,this.battleUnitId=t,this.battleground=h,this.closeCombatDistance=l,this.stateMachine=new s(this.unitStateChange),this.position=c===e.Team1?0:100,this.movingStartTime=0,this.curTimeFromStart=0,this.movingStartPos=0}var i=t.prototype;return i.startBattle=function(){var t=this;null!=this.unitData.abils&&this.unitData.abils.forEach((function(i){"bomb_abil"===i.name&&t.abils.push(new n(i,t,t.battleLog,t.battleground)),"bullet_shot"===i.name&&t.abils.push(new o(i,t,t.battleLog,t.battleground))}))},i.update=function(t,i){if(this.stateMachine.getState()!==a.Dead)switch(this.stateMachine.getState()!==a.Dead&&this.abils.forEach((function(e){e.tick(t,i)})),this.curTimeFromStart=i,this.stateMachine.getState()){case a.Preparing:this.stateMachine.setState(a.Moving);break;case a.Moving:this.move(t,i),this.checkForRickEndOfScreen(),this.checkForCloseCombatState();break;case a.CloseCombat:this.checkForCloseCombatState();break;case a.Dead:}},i.finishMoveEvent=function(){this.battleLog.addMoveEvent(this.battleUnitId,this.movingStartTime,this.movingStartPos,this.curTimeFromStart,this.position)},i.calcSpeed=function(){var t=this.unitData.v_base;switch(this.battleConfig.biom){case"snow":t*=this.unitData.v_mult_snow;break;case"desert":t*=this.unitData.v_mult_desert;break;case"jungle":t*=this.unitData.v_mult_jungle}return t},i.move=function(t,i){var a=this.calcSpeed();this.team===e.Team1?this.position+=a*t:this.position-=a*t},i.checkForRickEndOfScreen=function(){this.team===e.Team1&&this.position>=100&&(this.position=100,this.stateMachine.setState(a.CloseCombat),this.finishMoveEvent()),this.team===e.Team2&&this.position<=0&&(this.position=0,this.stateMachine.setState(a.CloseCombat),this.finishMoveEvent())},i.checkForCloseCombatState=function(){var t=this.battleground.getEnemyAtLine(this);null!=t?Math.abs(this.position-t.position)<=this.closeCombatDistance&&this.stateMachine.setState(a.CloseCombat):this.stateMachine.setState(a.Moving)},i.applyDamage=function(t,i){t.causedDamage+=i,this.hp-=i,this.battleLog.addChangeHpEvent(this.curTimeFromStart,this.battleUnitId,Math.max(this.hp,0)),this.hp<=0&&this.stateMachine.setState(a.Dead)},i.finishBattle=function(){this.stateMachine.getState()===a.Moving&&this.finishMoveEvent()},t}());i._RF.pop()}}}));

System.register("chunks:///_virtual/BattleUnitView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./StaticConfigStore.ts","./CommonBattle.ts","./BattleViewCommon.ts"],(function(t){var e,i,n,o,a,r,l,s,c,u,p,h,m,f,d,g,y;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,n=t.initializerDefineProperty,o=t.assertThisInitialized},function(t){a=t.cclegacy,r=t._decorator,l=t.Sprite,s=t.ProgressBar,c=t.Node,u=t.resources,p=t.SpriteFrame,h=t.tween,m=t.Component},function(t){f=t.StaticConfigStore},function(t){d=t.BattleTeam},function(t){g=t.getRealYFromLine,y=t.getRealXFromRelative}],execute:function(){var b,v,B,w,z,P,U,I,S;a._RF.push({},"6b51aT0CkxPVplxw9E/n3ig","BattleUnitView",void 0);var V=r.ccclass,x=r.property;t("BattleUnitView",(b=V("BattleUnitView"),v=x({type:l}),B=x({type:s}),w=x({type:c}),b((U=e((P=function(t){function e(){for(var e,i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return e=t.call.apply(t,[this].concat(a))||this,n(e,"combotant",U,o(e)),n(e,"healthBar",I,o(e)),n(e,"muzzleflashNode",S,o(e)),e.battleUnitId=0,e.startHp=0,e.team=void 0,e}i(e,t);var a=e.prototype;return a.init=function(t,e,i){var n=this;this.battleUnitId=t,this.team=i;var o=f.getUnitById(e);if(null!==o){u.load(o.model,p,(function(t,e){n.combotant.spriteFrame=e})),console.log("Initializing BattleUnitView for unitId: "+e+" on team "+this.team+" "+i);this.node.getPosition();var a=g(o.line);d.Team1===this.team&&this.node.setPosition(y(0),a,0),d.Team2===this.team&&this.node.setPosition(y(100),a,0),this.startHp=o.hp}},a.moveTo=function(t,e,i){var n=this.node.getPosition(),o=y(t),a=y(e);console.log("Moving unit "+this.battleUnitId+" from "+o.x+" to "+a.x+" over "+i+" seconds."),this.node.setPosition(o,n.y,0),h(this.node).to(i,{position:{x:a,y:n.y,z:0}}).start()},a.changeHp=function(t){this.healthBar.progress=1-t/this.startHp},a.death=function(){this.node.active=!1},e}(m)).prototype,"combotant",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),I=e(P.prototype,"healthBar",[B],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),S=e(P.prototype,"muzzleflashNode",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),z=P))||z));a._RF.pop()}}}));

System.register("chunks:///_virtual/BattleViewCommon.ts",["cc","./StaticConfigModels.ts"],(function(e){var t,i,n;return{setters:[function(e){t=e.cclegacy,i=e.view},function(e){n=e.UnitLine}],execute:function(){function c(){return i.getVisibleSize()}e({getRealXFromRelative:function(e){var t=c().width;return t*e/100-t/2},getRealYFromLine:function(e){var t=c().height,i=-t/2;e===n.Line1&&(i+=.2*t);e===n.Live2&&(i+=.5*t);e===n.Line3&&(i+=.7*t);return i},getScreenSize:c}),t._RF.push({},"3cac3XmNK1GZ6j+et04L2V/","BattleViewCommon",void 0),t._RF.pop()}}}));

System.register("chunks:///_virtual/BombAbil.ts",["./rollupPluginModLoBabelHelpers.js","cc","./BaseAbil.ts","./BattleStateMachine.ts"],(function(t){var i,e,o,n;return{setters:[function(t){i=t.inheritsLoose},function(t){e=t.cclegacy},function(t){o=t.BaseAbil},function(t){n=t.BattleUnitState}],execute:function(){e._RF.push({},"097eaC+u9VEk5mz/VS/HNaw","BombAbil",void 0);var m=function(t,i){this.pos=void 0,this.unitLine=void 0,this.pos=t,this.unitLine=i};t("BombAbil",function(t){function e(i,e,o,n){var m;return(m=t.call(this,i,e,o,n)||this).timeout=void 0,m.dmg=void 0,m.targets=void 0,m.v=void 0,m.owner=void 0,m.flightTime=0,m.remainTimeout=void 0,m.startBombPos=null,m.startBombTime=0,m.bombFlightTimeRemaining=0,m.timeout=i.timeout,m.dmg=i.dmg,m.targets=i.targets,m.v=i.v,m.owner=e,m.flightTime=i.flightTime,m.remainTimeout=m.timeout,m.bombFlightTimeRemaining=Number.MAX_VALUE,m}return i(e,t),e.prototype.tick=function(i,e){var o=this;t.prototype.tick.call(this,i,e),this.remainTimeout-=i,this.remainTimeout<=0&&(this.startBombPos=new m(this.owner.position,this.owner.unitData.line),this.startBombTime=e,this.bombFlightTimeRemaining=this.flightTime,this.remainTimeout=this.timeout),this.bombFlightTimeRemaining-=i,this.bombFlightTimeRemaining<0&&(this.bombFlightTimeRemaining=Number.MAX_VALUE,this.targets.forEach((function(t){var i,m,s=o.battleground.getEnemyAtLineByLine(o.owner.team,t);s&&s.stateMachine.getState()!==n.Dead&&(o.battleLog.addBombEvent(o.startBombTime,null==(i=o.startBombPos)?void 0:i.unitLine,null==(m=o.startBombPos)?void 0:m.pos,e,s.unitData.line,s.position),s.applyDamage(o.owner,o.dmg))})))},e}(o));e._RF.pop()}}}));

System.register("chunks:///_virtual/BuildingContracts.ts",["cc"],(function(){var t;return{setters:[function(c){t=c.cclegacy}],execute:function(){t._RF.push({},"524abnEJ9RDkLNecdtAeUXY","BuildingContracts",void 0),t._RF.pop()}}}));

System.register("chunks:///_virtual/BuildingService.ts",["./rollupPluginModLoBabelHelpers.js","cc","./EventBus.ts","./StaticConfigStore.ts"],(function(i){var e,n,t,l,r;return{setters:[function(i){e=i.createForOfIteratorHelperLoose},function(i){n=i.cclegacy},function(i){t=i.bus,l=i.Events},function(i){r=i.StaticConfigStore}],execute:function(){n._RF.push({},"12561HN+QZD4rEpSFVJYOej","BuildingService",void 0);i("BuildingService",function(){function i(i){this.walletService=void 0,this.buildingLevels=new Map,this.buildingConfigIds=new Map,this.walletService=i}var n=i.prototype;return n.getAllBuildingLevels=function(){for(var i,n={},t=e(this.buildingLevels);!(i=t()).done;){var l=i.value,r=l[0],u=l[1];n[r.toString()]=u}return n},n.setBuildingLevels=function(i){if(this.buildingLevels.clear(),this.buildingConfigIds.clear(),i)for(var e=0,n=Object.entries(i);e<n.length;e++){var t=n[e],l=t[0],r=t[1],u=Math.max(1,Math.floor(r));this.buildingLevels.set(Number(l),u)}},n.setBuildingInstances=function(i){this.buildingLevels.clear(),this.buildingConfigIds.clear();for(var n,t=e(i);!(n=t()).done;){var l,r=n.value;if(r.buildingId&&Number.isFinite(r.id)){var u=Math.floor(r.id),s=Math.max(1,Math.floor(null!=(l=r.level)?l:1));this.buildingLevels.set(u,s),this.buildingConfigIds.set(u,r.buildingId)}}},n.getBuildingLevel=function(i){var e;return null!=(e=this.buildingLevels.get(i))?e:1},n.setBuildingLevel=function(i,e){var n=Math.max(1,Math.floor(e));this.buildingLevels.set(i,n)},n.getBuildingConfigId=function(i){var e;return null!=(e=this.buildingConfigIds.get(i))?e:null},n.setBuildingConfigId=function(i,e){this.buildingConfigIds.set(i,e)},n.canUpgrade=function(i){return this.walletService.canSpend(i.upgradeCost)},n.upgrade=function(i,e){var n=e.nextLevelBuildingId;if(!n)return console.error("No upgrade available for building "+e.id),!1;var u=r.getBuildingConfigById(n);if(!u)return console.error("Next building config not found for id "+n),!1;if(!this.canUpgrade(e))return!1;if(!this.walletService.spend(e.upgradeCost))return!1;var s=this.getBuildingLevel(i)+1;return this.buildingLevels.set(i,s),this.buildingConfigIds.set(i,n),t.emit(l.BUILDING_UPGRADE,{id:i,newBuilding:u}),!0},i}());n._RF.pop()}}}));

System.register("chunks:///_virtual/BuildingUpgradeView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./MoneyBar.ts"],(function(e){var i,r,o,t,n,l,a,u,p,d,s,c;return{setters:[function(e){i=e.applyDecoratedDescriptor,r=e.inheritsLoose,o=e.initializerDefineProperty,t=e.assertThisInitialized},function(e){n=e.cclegacy,l=e._decorator,a=e.Sprite,u=e.Node,p=e.resources,d=e.SpriteFrame,s=e.Component},function(e){c=e.MoneyBar}],execute:function(){var f,g,w,v,h,y,b,M,m;n._RF.push({},"c25b7vTMuFPNJfq7nrMQf7/","BuildingUpgradeView",void 0);var B=l.ccclass,F=l.property;e("BuildingUpgradeView",(f=B("BuildingUpgradeView"),g=F({type:a}),w=F({type:a}),v=F({type:u}),f((b=i((y=function(e){function i(){for(var i,r=arguments.length,n=new Array(r),l=0;l<r;l++)n[l]=arguments[l];return i=e.call.apply(e,[this].concat(n))||this,o(i,"upgradeFromSprite",b,t(i)),o(i,"upgradeToSprite",M,t(i)),o(i,"moneyBarNode",m,t(i)),i.viewModel=null,i}r(i,e);var n=i.prototype;return n.bind=function(e){var i=this;this.viewModel=e,this.viewModel.bindView((function(){i.viewModel=null,i.node.destroy()})),this.buildView()},n.buildView=function(){var e=this;if(this.viewModel){if(p.load(this.viewModel.icon,d,(function(i,r){e.upgradeFromSprite.spriteFrame=r})),p.load(this.viewModel.nextLevelIcon,d,(function(i,r){e.upgradeToSprite.spriteFrame=r})),this.moneyBarNode){var i=this.moneyBarNode.getComponent(c);i&&(i.init(this.viewModel.cost),i.showPriceLabel(!0))}}else console.error("ViewModel is not bound")},n.onUpgrade=function(){this.viewModel.upgrade()},n.onClose=function(){this.viewModel&&this.viewModel.close()},i}(s)).prototype,"upgradeFromSprite",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),M=i(y.prototype,"upgradeToSprite",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),m=i(y.prototype,"moneyBarNode",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),h=y))||h));n._RF.pop()}}}));

System.register("chunks:///_virtual/BuildingUpgradeViewModel.ts",["./rollupPluginModLoBabelHelpers.js","cc","./StaticConfigStore.ts","./UserService.ts"],(function(i){var e,n,t,o;return{setters:[function(i){e=i.createClass},function(i){n=i.cclegacy},function(i){t=i.StaticConfigStore},function(i){o=i.UserService}],execute:function(){n._RF.push({},"4ac27l89DFLG55QuXmtG8aO","BuildingUpgradeViewModel",void 0);i("BuildingUpgradeViewModel",function(){function i(i,e){void 0===e&&(e=null),this.model=void 0,this.buildingInstanceId=void 0,this.onDispose=null,this.model=i,this.buildingInstanceId=e}var n=i.prototype;return n.bindView=function(i){this.onDispose=i},n.upgrade=function(){if(null!==this.buildingInstanceId){var i=o.getInstance();if(i.buildingService.canUpgrade(this.model))if(i.buildingService.upgrade(this.buildingInstanceId,this.model)){var e=i.buildingService.getBuildingLevel(this.buildingInstanceId);console.log("Upgraded building "+this.model.id+" to level "+e),this.dispose()}else console.error("Upgrade failed for building "+this.model.id);else console.error("Not enough currency to upgrade building "+this.model.id)}else console.error("Building instance id is missing")},n.testSwapUpgradedModel=function(){if(null!==this.buildingInstanceId){var i=this.model.nextLevelBuildingId;if(i){var e=t.getBuildingConfigById(i);if(e){var n=o.getInstance();n.buildingService.setBuildingConfigId(this.buildingInstanceId,i),n.buildingService.setBuildingLevel(this.buildingInstanceId,n.buildingService.getBuildingLevel(this.buildingInstanceId)+1),this.model=e,console.log("Swapped building instance "+this.buildingInstanceId+" to "+i)}else console.error("Missing config for upgraded building "+i)}else console.error("No upgrade available for building "+this.model.id)}else console.error("Building instance id is missing")},n.dispose=function(){if(this.onDispose){var i=this.onDispose;this.onDispose=null,i()}},n.close=function(){this.dispose()},e(i,[{key:"title",get:function(){return this.model.message}},{key:"icon",get:function(){return this.model.buildingIcon}},{key:"nextLevelIcon",get:function(){var i=t.getBuildingConfigById(this.model.nextLevelBuildingId);return i?i.buildingIcon:"No upgrade available"}},{key:"cost",get:function(){return this.model.upgradeCost}},{key:"costLabel",get:function(){var i=this.model.upgradeCost.money.filter((function(i){return i.amount>0})).map((function(i){return i.type+" "+i.amount}));return i.length>0?"Cost "+i.join(", "):"Cost free"}}]),i}());n._RF.pop()}}}));

System.register("chunks:///_virtual/BuildingView.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(i){var e,n,t,o,l,r,c,s,u;return{setters:[function(i){e=i.inheritsLoose},function(i){n=i.cclegacy,t=i._decorator,o=i.Node,l=i.UITransform,r=i.Sprite,c=i.resources,s=i.SpriteFrame,u=i.Component}],execute:function(){var d;n._RF.push({},"bbc14l9qqRBVbGn2Rcm5QEL","BuildingView",void 0);var a=t.ccclass;i("BuildingView",a("BuildingView")(d=function(i){function n(){for(var e,n=arguments.length,t=new Array(n),o=0;o<n;o++)t[o]=arguments[o];return(e=i.call.apply(i,[this].concat(t))||this).viewModel=null,e}e(n,i);var t=n.prototype;return t.onEnable=function(){this.node.on(o.EventType.TOUCH_END,this.onClick,this)},t.onDisable=function(){this.node.off(o.EventType.TOUCH_END,this.onClick,this)},t.bind=function(i){this.updateView(i)},t.updateView=function(i){this.viewModel=i,this.viewModel.bindView(this);var e=this.getComponent(l)||this.addComponent(l),n=e.contentSize;0!==n.width&&0!==n.height||e.setContentSize(80,80)},t.onClick=function(){var i;console.log("BuildingView clicked"),null==(i=this.viewModel)||i.handleClick()},t.render=function(i){console.log("Rendering building with image:",i);var e=this.getComponent(r)||this.addComponent(r);c.load(i,s,(function(i,n){i?console.error("Failed to load building image:",i):e.spriteFrame=n}))},n}(u))||d);n._RF.pop()}}}));

System.register("chunks:///_virtual/BuildingViewModel.ts",["./rollupPluginModLoBabelHelpers.js","cc","./BuildingUpgradeView.ts","./BuildingUpgradeViewModel.ts","./TownhallShopView.ts","./TownhallShopViewModel.ts","./EventBus.ts"],(function(i){var e,n,o,t,d,l,s,a,r;return{setters:[function(i){e=i.createClass},function(i){n=i.cclegacy,o=i.instantiate},function(i){t=i.BuildingUpgradeView},function(i){d=i.BuildingUpgradeViewModel},function(i){l=i.TownhallShopView},function(i){s=i.TownhallShopViewModel},function(i){a=i.bus,r=i.Events}],execute:function(){n._RF.push({},"a59d4sKfslD5LFVapRXo+yt","BuildingViewModel",void 0);i("BuildingViewModel",function(){function i(i,e,n,o,t){var d=this;void 0===t&&(t=null),this.model=void 0,this.upgradeWidgetPrefab=void 0,this.townhallShopPrefab=void 0,this.widgetRoot=void 0,this.buildingInstanceId=void 0,this.view=null,this.upgradeBuildingEvet=function(i){var e;console.log("Received building upgrade event for id:",d.buildingInstanceId,"newBuildingId:",i.newBuilding.id),d.buildingInstanceId===i.id&&(d.model=i.newBuilding,console.log(d.view),null==(e=d.view)||e.render(d.image))},this.model=i,this.upgradeWidgetPrefab=e,this.townhallShopPrefab=n,this.widgetRoot=o,this.buildingInstanceId=t,a.on(r.BUILDING_UPGRADE,this.upgradeBuildingEvet)}var n=i.prototype;return n.bindView=function(i){this.view=i,this.view.render(this.image)},n.handleClick=function(){console.log(this.model.message),"TownHall"!==this.model.kind?this.showUpgradeWidget():this.showTownhallShop()},n.showUpgradeWidget=function(){if(this.upgradeWidgetPrefab)if(this.widgetRoot){var i=o(this.upgradeWidgetPrefab).getComponent(t);if(i){this.widgetRoot.addChild(i.node);var e=new d(this.model,this.buildingInstanceId);i.bind(e)}else console.error("Failed to instantiate BuildingUpgradeView from prefab")}else console.error("Upgrade widget root node is not set");else console.error("Upgrade widget prefab is not set")},n.showTownhallShop=function(){if(this.townhallShopPrefab){var i=o(this.townhallShopPrefab).getComponent(l);this.widgetRoot.addChild(i.node);var e=new s;i.bind(e)}else console.error("Townhall shop prefab is not set")},n.destroy=function(){a.off(r.BUILDING_UPGRADE,this.upgradeBuildingEvet)},e(i,[{key:"image",get:function(){return this.model.buildingImage}}]),i}());n._RF.pop()}}}));

System.register("chunks:///_virtual/BulletShotAbil.ts",["./rollupPluginModLoBabelHelpers.js","cc","./BaseAbil.ts","./BattleStateMachine.ts"],(function(t){var e,i,o,a;return{setters:[function(t){e=t.inheritsLoose},function(t){i=t.cclegacy},function(t){o=t.BaseAbil},function(t){a=t.BattleUnitState}],execute:function(){i._RF.push({},"d84ebexy7dI9IGmAZuXCUhD","BulletShotAbil",void 0);t("BulletShotAbil",function(t){function i(e,i,o,a){var n;return(n=t.call(this,e,i,o,a)||this).timeout=void 0,n.dmg=void 0,n.target=void 0,n.owner=void 0,n.range_for_attack=void 0,n.remainTimeout=void 0,n.timeout=e.timeout,n.dmg=e.dmg,n.target=a.getEnemyAtLine(i),n.owner=i,n.range_for_attack=e.range_for_attack,n.remainTimeout=n.timeout,n}return e(i,t),i.prototype.tick=function(e,i){(t.prototype.tick.call(this,e,i),this.remainTimeout-=e,this.remainTimeout<=0&&null!=this.target&&this.target.stateMachine.getState()!==a.Dead)&&(Math.abs(this.owner.position-this.target.position)<this.range_for_attack&&(this.battleLog.addBulletShotEvent(i,this.owner.battleUnitId,this.target.battleUnitId),this.target.applyDamage(this.owner,this.dmg),this.remainTimeout=this.timeout))},i}(o));i._RF.pop()}}}));

System.register("chunks:///_virtual/BulletShotView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./CommonBattle.ts"],(function(t){var o,e,n,i,s,r;return{setters:[function(t){o=t.inheritsLoose},function(t){e=t.cclegacy,n=t._decorator,i=t.tween,s=t.Component},function(t){r=t.randomRange}],execute:function(){var u;e._RF.push({},"350225nE9pAZbus9Plm8w+k","BulletShotView",void 0);var c=n.ccclass;n.property,t("BulletShotView",c("BulletShotView")(u=function(t){function e(){return t.apply(this,arguments)||this}return o(e,t),e.prototype.init=function(t,o){var e=this,n=t.node.getPosition();this.node.setPosition(n);var s=o.getPosition();s.y+=r(-30,30),i(this.node).to(.3,{position:s}).call((function(){e.node.destroy()})).start()},e}(s))||u);e._RF.pop()}}}));

System.register("chunks:///_virtual/CommonBattle.ts",["cc"],(function(t){var e;return{setters:[function(t){e=t.cclegacy}],execute:function(){t("randomRange",(function(t,e){return t+Math.random()*(e-t)})),e._RF.push({},"b163fKyix9ANrXMcCrvqv8G","CommonBattle",void 0);t("BattleTeam",function(t){return t[t.Team1=1]="Team1",t[t.Team2=2]="Team2",t}({}));e._RF.pop()}}}));

System.register("chunks:///_virtual/EnemyBlock.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var n,t,r,i,o,c,l,a;return{setters:[function(e){n=e.applyDecoratedDescriptor,t=e.inheritsLoose,r=e.initializerDefineProperty,i=e.assertThisInitialized},function(e){o=e.cclegacy,c=e._decorator,l=e.Sprite,a=e.Component}],execute:function(){var u,p,y,s,f,m;o._RF.push({},"2be8dvX6ZlOfqvYc5Ji8rxk","EnemyBlock",void 0);var v=c.ccclass,b=c.property,k=(e("EnemyBlock",(u=v("EnemyBlock"),p=b({type:l}),u((f=n((s=function(e){function n(){for(var n,t=arguments.length,o=new Array(t),c=0;c<t;c++)o[c]=arguments[c];return n=e.call.apply(e,[this].concat(o))||this,r(n,"enemyType",f,i(n)),r(n,"BlockSprite",m,i(n)),n}t(n,e);var o=n.prototype;return o.start=function(){},o.update=function(e){},n}(a)).prototype,"enemyType",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return k.Enemy}}),m=n(s.prototype,"BlockSprite",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),y=s))||y)),e("EnemyType",function(e){return e[e.Enemy=0]="Enemy",e[e.Ally=1]="Ally",e}({})));o._RF.pop()}}}));

System.register("chunks:///_virtual/EventBus.ts",["cc"],(function(e){var t,n;return{setters:[function(e){t=e.cclegacy,n=e.EventTarget}],execute:function(){t._RF.push({},"afa5dVSR/pF3Y+liRZt9FZv","EventBus",void 0);e("bus",new n),e("Events",{BUILDING_UPGRADE:"building/upgrade",WALLET_CHANGED:"wallet/changed"});t._RF.pop()}}}));

System.register("chunks:///_virtual/GameCode.ts",["./rollupPluginModLoBabelHelpers.js","cc","./EnemyBlock.ts","./StaticConfigStore.ts"],(function(e){var t,n,i,r,l,a,o,s,u,c,p,h,y,f,m,B,d,g,b,C,v,S,w,T,P,z,E,R,k,O,A,D;return{setters:[function(e){t=e.applyDecoratedDescriptor,n=e.inheritsLoose,i=e.initializerDefineProperty,r=e.assertThisInitialized,l=e.asyncToGenerator,a=e.regeneratorRuntime},function(e){o=e.cclegacy,s=e._decorator,u=e.Node,c=e.Prefab,p=e.Button,h=e.SpriteFrame,y=e.Sprite,f=e.instantiate,m=e.tween,B=e.Vec3,d=e.assetManager,g=e.Texture2D,b=e.KeyCode,C=e.view,v=e.UITransform,S=e.Collider2D,w=e.Contact2DType,T=e.RigidBody2D,P=e.ERigidBody2DType,z=e.randomRange,E=e.Component,R=e.input,k=e.Input},function(e){O=e.EnemyType,A=e.EnemyBlock},function(e){D=e.StaticConfigStore}],execute:function(){var _,G,N,F,I,x,H,K,M,V,L,W,Y,U,j,q,J,Q,X,Z,$;o._RF.push({},"416f2qSeYdDYro2Wi1uiVoF","GameCode",void 0);var ee=s.ccclass,te=s.property;e("GameCode",(_=ee("GameCode"),G=te({type:u}),N=te({type:c}),F=te({type:c}),I=te({type:c}),x=te({type:p}),H=te({type:u}),K=te({type:h}),M=te({type:y}),_((W=t((L=function(e){function t(){for(var t,n=arguments.length,l=new Array(n),a=0;a<n;a++)l[a]=arguments[a];return t=e.call.apply(e,[this].concat(l))||this,i(t,"canvas",W,r(t)),i(t,"level",Y,r(t)),i(t,"enemyBall",U,r(t)),i(t,"allyBall",j,r(t)),i(t,"startGameButton",q,r(t)),i(t,"stickNode",J,r(t)),i(t,"allyBallSprite",Q,r(t)),i(t,"lennaImage",X,r(t)),i(t,"ballSpeed",Z,r(t)),i(t,"ballStrafeSpeed",$,r(t)),t.currentBall=null,t}n(t,e);var o=t.prototype;return o.start=function(){var e=l(a().mark((function e(){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,D.init();case 2:R.on(k.EventType.KEY_PRESSING,this.OnKeyPressing,this),R.on(k.EventType.TOUCH_MOVE,this.OnTouchMove,this);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),o.onStartGame=function(){var e=this;this.startGameButton.node.removeFromParent();var t=f(this.level);this.canvas.addChild(t),m(this.stickNode).repeatForever(m().by(4,{eulerAngles:new B(360,360,360)},{easing:"linear"})).start();d.loadRemote("https://upload.wikimedia.org/wikipedia/en/7/7d/Lenna_%28test_image%29.png",(function(t,n){if(t)console.error("Image load error",t);else{var i=new g;i.image=n;var r=new h;r.texture=i,e.lennaImage.spriteFrame=r}})),this.spawnRandomAttackingBall()},o.OnTouchMove=function(e){if(null!=this.currentBall){var t=e.getDelta(),n=this.currentBall.getPosition();this.currentBall.setPosition(n.x+t.x,n.y,n.z)}},o.OnKeyPressing=function(e){if(null!=this.currentBall){var t=this.currentBall.getPosition();e.keyCode===b.ARROW_LEFT&&this.currentBall.setPosition(t.x-this.ballStrafeSpeed,t.y,t.z),e.keyCode===b.ARROW_RIGHT&&this.currentBall.setPosition(t.x+this.ballStrafeSpeed,t.y,t.z)}},o.spawnRandomAttackingBall=function(){if(this.enemyBall&&this.canvas){this.currentBall=f(this.enemyBall),this.canvas.addChild(this.currentBall);var e=C.getVisibleSize(),t=this.currentBall.getComponent(v),n=t?t.contentSize.height:0,i=-e.height/2+n/2;this.currentBall.setPosition(0,i,0);var r=this.currentBall.getComponent(S);r&&(r.on(w.BEGIN_CONTACT,this.onBeginContact,this),r.on(w.END_CONTACT,this.onEndContact,this)),this.currentBall.getComponent(T).type=P.Dynamic;var l=z(0,1)>.3?O.Ally:O.Enemy;this.currentBall.getComponent(A).enemyType=l,l==O.Ally&&(this.currentBall.getComponent(A).BlockSprite.spriteFrame=this.allyBallSprite)}},o.onBeginContact=function(e,t,n){var i=this;if(null!=this.currentBall&&(e.node==this.currentBall||t.node==this.currentBall)){var r=this.currentBall.getComponent(A).enemyType,l=t.node.getComponent(A).enemyType;if(r==O.Ally&&l==O.Enemy)this.scheduleOnce((function(){t.node.removeFromParent(),e.node.removeFromParent(),i.spawnRandomAttackingBall()}),.001),this.currentBall=null;else this.currentBall.getComponent(T).type=P.Kinematic,this.spawnRandomAttackingBall()}},o.onEndContact=function(e,t,n){},o.onDestroy=function(){this.unregisetrterBallCollisionHandlers()},o.unregisetrterBallCollisionHandlers=function(){if(this.currentBall){var e=this.currentBall.getComponent(S);e&&(e.off(w.BEGIN_CONTACT,this.onBeginContact,this),e.off(w.END_CONTACT,this.onEndContact,this))}},o.updateBallPosition=function(e){if(this.currentBall){var t=this.ballSpeed*e,n=this.currentBall.getPosition();n.y+=t,this.currentBall.setPosition(n)}},o.handleBallOutOfBounds=function(){if(this.currentBall){var e=C.getVisibleSize(),t=this.currentBall.getComponent(v),n=t?t.contentSize.height:0;this.currentBall.getPosition().y-n/2>e.height/2&&(this.unregisetrterBallCollisionHandlers(),this.currentBall.removeFromParent(),this.currentBall=null,this.spawnRandomAttackingBall())}},o.update=function(e){this.updateBallPosition(e),this.handleBallOutOfBounds()},t}(E)).prototype,"canvas",[G],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Y=t(L.prototype,"level",[N],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),U=t(L.prototype,"enemyBall",[F],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),j=t(L.prototype,"allyBall",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),q=t(L.prototype,"startGameButton",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),J=t(L.prototype,"stickNode",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Q=t(L.prototype,"allyBallSprite",[K],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),X=t(L.prototype,"lennaImage",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Z=t(L.prototype,"ballSpeed",[te],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 100}}),$=t(L.prototype,"ballStrafeSpeed",[te],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 10}}),V=L))||V));o._RF.pop()}}}));

System.register("chunks:///_virtual/ItemsService.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var t,r;return{setters:[function(e){t=e.createForOfIteratorHelperLoose},function(e){r=e.cclegacy}],execute:function(){r._RF.push({},"7d9f35yTSNF4Y7oeohWmJYS","ItemsService",void 0);e("ItemsService",function(){function e(){this.items=new Map}var r=e.prototype;return r.addItem=function(e,t){var r;if(void 0===t&&(t=1),e){var n=Math.max(1,Math.floor(t)),i=null!=(r=this.items.get(e))?r:0;this.items.set(e,i+n)}},r.getCount=function(e){var t;return null!=(t=this.items.get(e))?t:0},r.getAll=function(){for(var e,r={},n=t(this.items);!(e=n()).done;){var i=e.value,o=i[0],s=i[1];r[o]=s}return r},e}());r._RF.pop()}}}));

System.register("chunks:///_virtual/main",["./EventBus.ts","./BaseAbil.ts","./BombAbil.ts","./BulletShotAbil.ts","./BattleLog.ts","./BattleLogic.ts","./BattleStateMachine.ts","./BattleUnit.ts","./Battleground.ts","./CommonBattle.ts","./BattleBombView.ts","./BattleManager.ts","./BattleUnitView.ts","./BattleViewCommon.ts","./BulletShotView.ts","./GameCode.ts","./BuildingContracts.ts","./BuildingView.ts","./BuildingViewModel.ts","./StaticConfigModels.ts","./StaticConfigStore.ts","./PlayerBase.ts","./PlayerBaseModels.ts","./PlayerBaseViewModel.ts","./MoneyBar.ts","./MoneyIconView.ts","./UserMoneyBar.ts","./PrepareBattleContracts.ts","./PrepareBattleItemContracts.ts","./PrepareBattleItemVM.ts","./PrepareBattleItemView.ts","./PrepareBattleVM.ts","./PrepareBattleView.ts","./TownhallShopContracts.ts","./TownhallShopItem.ts","./TownhallShopView.ts","./TownhallShopViewModel.ts","./BuildingUpgradeView.ts","./BuildingUpgradeViewModel.ts","./BuildingService.ts","./ItemsService.ts","./UserModels.ts","./UserService.ts","./WalletService.ts","./StartGameButton.ts","./EnemyBlock.ts"],(function(){return{setters:[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],execute:function(){}}}));

System.register("chunks:///_virtual/MoneyBar.ts",["./rollupPluginModLoBabelHelpers.js","cc","./MoneyIconView.ts"],(function(e){var n,t,r,i,o,a,l,c,s,u,p,f,y;return{setters:[function(e){n=e.applyDecoratedDescriptor,t=e.inheritsLoose,r=e.initializerDefineProperty,i=e.assertThisInitialized,o=e.createForOfIteratorHelperLoose},function(e){a=e.cclegacy,l=e._decorator,c=e.Prefab,s=e.Node,u=e.Label,p=e.instantiate,f=e.Component},function(e){y=e.MoneyIconView}],execute:function(){var b,h,m,d,v,I,g,L,M;a._RF.push({},"23a45F7dihONIapDx21TI7G","MoneyBar",void 0);var w=l.ccclass,P=l.property;e("MoneyBar",(b=w("MoneyBar"),h=P({type:c}),m=P({type:s}),d=P({type:u}),b((g=n((I=function(e){function n(){for(var n,t=arguments.length,o=new Array(t),a=0;a<t;a++)o[a]=arguments[a];return n=e.call.apply(e,[this].concat(o))||this,r(n,"moneyItemPrefab",g,i(n)),r(n,"content",L,i(n)),r(n,"priceLabel",M,i(n)),n}t(n,e);var a=n.prototype;return a.init=function(e){var n;console.log("[MoneyBar] Initializing with price:",e);var t=null!=(n=this.content)?n:this.node,r=this.priceLabel;if(t.removeAllChildren(),t.addChild(r.node),this.priceLabel.node.active=!1,this.moneyItemPrefab)for(var i,a=this.collectEntries(e),l=o(a);!(i=l()).done;){var c=i.value,s=p(this.moneyItemPrefab);t.addChild(s);var u=s.getComponent(y);u?u.init(c):console.error("[MoneyBar] MoneyIconView component is missing on item prefab")}else console.error("[MoneyBar] moneyItemPrefab is not set")},a.showPriceLabel=function(e){this.priceLabel&&(this.priceLabel.node.active=e)},a.collectEntries=function(e){return e.money.filter((function(e){return e.amount>0}))},n}(f)).prototype,"moneyItemPrefab",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),L=n(I.prototype,"content",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),M=n(I.prototype,"priceLabel",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),v=I))||v));a._RF.pop()}}}));

System.register("chunks:///_virtual/MoneyIconView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./StaticConfigStore.ts"],(function(e){var t,n,i,r,o,a,c,l,u,p,s,f;return{setters:[function(e){t=e.applyDecoratedDescriptor,n=e.inheritsLoose,i=e.initializerDefineProperty,r=e.assertThisInitialized},function(e){o=e.cclegacy,a=e._decorator,c=e.Label,l=e.Sprite,u=e.resources,p=e.SpriteFrame,s=e.Component},function(e){f=e.StaticConfigStore}],execute:function(){var y,S,b,g,m,h,d;o._RF.push({},"57fb9gCSiZG7qEGNG9/InVx","MoneyIconView",void 0);var v=a.ccclass,w=a.property;e("MoneyIconView",(y=v("MoneyIconView"),S=w({type:c}),b=w({type:l}),y((h=t((m=function(e){function t(){for(var t,n=arguments.length,o=new Array(n),a=0;a<n;a++)o[a]=arguments[a];return t=e.call.apply(e,[this].concat(o))||this,i(t,"amountLabel",h,r(t)),i(t,"iconSprite",d,r(t)),t}return n(t,e),t.prototype.init=function(e){var t=this;this.amountLabel&&(this.amountLabel.string=String(e.amount));var n=f.getCurrencyIconByName(e.type);n&&this.iconSprite&&u.load(n,p,(function(e,i){e?console.error("[MoneyIconView] icon load failed for "+n,e):t.iconSprite&&(t.iconSprite.spriteFrame=i)}))},t}(s)).prototype,"amountLabel",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),d=t(m.prototype,"iconSprite",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),g=m))||g));o._RF.pop()}}}));

System.register("chunks:///_virtual/PlayerBase.ts",["./rollupPluginModLoBabelHelpers.js","cc","./BuildingView.ts","./StaticConfigStore.ts","./UserService.ts","./PlayerBaseViewModel.ts","./BuildingViewModel.ts","./PrepareBattleView.ts","./PrepareBattleVM.ts","./MoneyBar.ts"],(function(e){var t,n,i,r,o,l,a,s,u,c,d,f,p,h,g,b,y,w,m,v,B,P,R,C,M,S,x,U,z,W;return{setters:[function(e){t=e.applyDecoratedDescriptor,n=e.inheritsLoose,i=e.initializerDefineProperty,r=e.assertThisInitialized,o=e.createForOfIteratorHelperLoose,l=e.asyncToGenerator,a=e.regeneratorRuntime},function(e){s=e.cclegacy,u=e._decorator,c=e.SpriteFrame,d=e.Prefab,f=e.Node,p=e.resources,h=e.JsonAsset,g=e.assetManager,b=e.Layers,y=e.UITransform,w=e.Sprite,m=e.Vec3,v=e.Canvas,B=e.Component,P=e.instantiate},function(e){R=e.BuildingView},function(e){C=e.StaticConfigStore},function(e){M=e.UserService},function(e){S=e.PlayerBaseViewModel},function(e){x=e.BuildingViewModel},function(e){U=e.PrepareBattleView},function(e){z=e.PrepareBattleVM},function(e){W=e.MoneyBar}],execute:function(){var D,I,N,V,_,F,G,O,L,k,A,E,j,J,Z,T,q,H,K,Q;s._RF.push({},"d2f5bPukodJ8bv3GyAMIGwE","PlayerBase",void 0);var X=u.ccclass,Y=u.property;e("PlayerBase",(D=X("PlayerBase"),I=Y({type:c}),N=Y({type:d}),V=Y({type:d}),_=Y({type:d}),F=Y({type:d}),G=Y({type:f}),D((k=t((L=function(e){function t(){for(var t,n=arguments.length,o=new Array(n),l=0;l<n;l++)o[l]=arguments[l];return t=e.call.apply(e,[this].concat(o))||this,i(t,"columns",k,r(t)),i(t,"rows",A,r(t)),i(t,"cellRadius",E,r(t)),i(t,"cellSprite",j,r(t)),i(t,"upgradeWidgetPrefab",J,r(t)),i(t,"townhallShopPrefab",Z,r(t)),i(t,"battleManagerPrefab",T,r(t)),i(t,"prepareBattleWindowPrefab",q,r(t)),i(t,"userConfigPath",H,r(t)),i(t,"defaultWalletBalance",K,r(t)),i(t,"moneyBar",Q,r(t)),t.viewModel=null,t.cellNodes=[],t.buildingsRoot=null,t}n(t,e);var s=t.prototype;return s.start=function(){this.loadAndBuild().catch((function(e){console.error("PlayerBase config load failed",e)}))},s.loadAndBuild=function(){var e=l(a().mark((function e(){var t,n,i,r,o,l,s,u,c,d;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,C.init();case 2:return e.next=4,this.loadUserData(this.userConfigPath);case 4:r=e.sent,(o=M.getInstance()).applyUserData(r,this.defaultWalletBalance),this.moneyBar&&this.moneyBar.getComponent(W).init(o.walletService.getBalance()),l=r.Buildings,s=C.getBuildingModels(),console.log("Loaded building models:",s),u=null!=(t=l.columns)?t:this.columns,c=null!=(n=l.rows)?n:this.rows,d=null!=(i=l.cellRadius)?i:this.cellRadius,this.buildGridFromConfig(u,c,d,l.cells,s);case 15:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),s.loadUserData=function(e){return this.isRemoteSource(e)?this.loadRemoteUserData(e):this.loadLocalUserData(e)},s.loadLocalUserData=function(e){return new Promise((function(t,n){var i=e.endsWith(".json")?e.slice(0,-5):e;p.load(i,h,(function(i,r){!i&&r?t(r.json):n(null!=i?i:new Error("Missing user JSON at "+e))}))}))},s.loadRemoteUserData=function(e){return new Promise((function(t,n){g.loadRemote(e,(function(i,r){!i&&r?t(r.json):n(null!=i?i:new Error("Missing remote user JSON at "+e))}))}))},s.isRemoteSource=function(e){return e.startsWith("http://")||e.startsWith("https://")},s.buildGrid=function(){if(this.clearGrid(),this.viewModel){this.ensureBuildingsRoot();for(var e,t=[],n=o(this.viewModel.cells);!(e=n()).done;){var i=e.value;t.push(this.viewModel.getRawCellPosition(i))}for(var r=this.getCenterOffset(t),l=0;l<this.viewModel.cells.length;l+=1){var a=this.viewModel.cells[l],s=this.createCellNode(a,t[l],r);this.node.addChild(s),this.cellNodes.push(s)}this.applyUiZOrder()}},s.buildGridFromConfig=function(e,t,n,i,r){this.columns=e,this.rows=t,this.cellRadius=n,this.viewModel=new S(e,t,n,i,r),this.buildGrid()},s.createCellNode=function(e,t,n){var i=new f("Cell_"+e.q+"_"+e.r),r=t.add(n);(i.setPosition(r.x,r.y,0),i.layer=b.Enum.UI_2D,i.addComponent(y).setContentSize(2*this.cellRadius,2*this.cellRadius),this.cellSprite)&&(i.addComponent(w).spriteFrame=this.cellSprite);return e.building&&this.createBuildingNode(e,r),i},s.getCenterOffset=function(e){if(0===e.length)return new m;for(var t,n=e[0].x,i=e[0].x,r=e[0].y,l=e[0].y,a=o(e);!(t=a()).done;){var s=t.value;n=Math.min(n,s.x),i=Math.max(i,s.x),r=Math.min(r,s.y),l=Math.max(l,s.y)}return new m(-(n+i)/2,-(r+l)/2,0)},s.clearGrid=function(){for(var e,t=o(this.cellNodes);!(e=t()).done;){e.value.removeFromParent()}this.cellNodes=[],this.buildingsRoot&&(this.buildingsRoot.removeFromParent(),this.buildingsRoot=null)},s.applyUiZOrder=function(){for(var e=[].concat(this.cellNodes).sort((function(e,t){return t.position.y-e.position.y})),t=0;t<e.length;t+=1)e[t].setSiblingIndex(t)},s.applyBuildingsZOrder=function(){if(this.buildingsRoot)for(var e=[].concat(this.buildingsRoot.children).sort((function(e,t){return t.position.y-e.position.y})),t=0;t<e.length;t+=1)e[t].setSiblingIndex(t)},s.ensureBuildingsRoot=function(){this.buildingsRoot||(this.buildingsRoot=new f("BuildingsRoot"),this.buildingsRoot.layer=b.Enum.UI_2D,this.node.addChild(this.buildingsRoot))},s.createBuildingNode=function(e,t){var n,i;if(this.buildingsRoot){var r=new f("Building_"+e.q+"_"+e.r),o=r.addComponent(y);r.layer=b.Enum.UI_2D;var l=1.2*this.cellRadius;o.setContentSize(l,l),o.setAnchorPoint(.5,.1),r.setPosition(t.x,t.y,0);var a=r.addComponent(R),s=null!=(n=null==(i=this.node.parent)||null==(i=i.getComponent(v))?void 0:i.node)?n:null,u=new x(e.building,this.upgradeWidgetPrefab,this.townhallShopPrefab,s,e.buildingInstanceId);a.bind(u),this.buildingsRoot.addChild(r),this.applyBuildingsZOrder()}},s.loadJson=function(e){return new Promise((function(t,n){p.load(e,h,(function(e,i){e?n(e):t(i.json)}))}))},s.Battle=function(){var e=l(a().mark((function e(){var t,n,i,r,o,l;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.prepareBattleWindowPrefab){e.next=3;break}return console.error("[PlayerBase] prepareBattleWindowPrefab is not set"),e.abrupt("return");case 3:if(i=null!=(t=null==(n=this.node.parent)||null==(n=n.getComponent(v))?void 0:n.node)?t:this.node,r=P(this.prepareBattleWindowPrefab),i.addChild(r),o=r.getComponent(U)){e.next=10;break}return console.error("[PlayerBase] PrepareBattleView is missing on prefab"),e.abrupt("return");case 10:l=new z,o.bind(l);case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),t}(B)).prototype,"columns",[Y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 5}}),A=t(L.prototype,"rows",[Y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 5}}),E=t(L.prototype,"cellRadius",[Y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 64}}),j=t(L.prototype,"cellSprite",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),J=t(L.prototype,"upgradeWidgetPrefab",[N],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Z=t(L.prototype,"townhallShopPrefab",[V],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),T=t(L.prototype,"battleManagerPrefab",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),q=t(L.prototype,"prepareBattleWindowPrefab",[F],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),H=t(L.prototype,"userConfigPath",[Y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"User"}}),K=t(L.prototype,"defaultWalletBalance",[Y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 500}}),Q=t(L.prototype,"moneyBar",[G],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),O=L))||O));s._RF.pop()}}}));

System.register("chunks:///_virtual/PlayerBaseModels.ts",["cc"],(function(i){var t;return{setters:[function(i){t=i.cclegacy}],execute:function(){t._RF.push({},"05257JxKtZNIrkqgXypazvy","PlayerBaseModels",void 0);i("BuildingData",(function(i,t,d,s,n,l,e){this.id=void 0,this.kind=void 0,this.buildingImage=void 0,this.buildingIcon=void 0,this.message=void 0,this.nextLevelBuildingId=void 0,this.upgradeCost=void 0,this.id=i,this.kind=t,this.buildingImage=d,this.buildingIcon=s,this.message=n,this.nextLevelBuildingId=l,this.upgradeCost=e})),i("CellData",(function(i,t,d,s,n){var l,e;void 0===s&&(s=null),void 0===n&&(n=null),this.q=void 0,this.r=void 0,this.building=void 0,this.buildingId=void 0,this.buildingInstanceId=void 0,this.q=i,this.r=t,this.building=d,this.buildingId=null!=(l=null!=(e=s)?e:null==d?void 0:d.id)?l:null,this.buildingInstanceId=n}));t._RF.pop()}}}));

System.register("chunks:///_virtual/PlayerBaseViewModel.ts",["./rollupPluginModLoBabelHelpers.js","cc","./PlayerBaseModels.ts"],(function(l){var e,i,n,t;return{setters:[function(l){e=l.createForOfIteratorHelperLoose},function(l){i=l.cclegacy,n=l.Vec3},function(l){t=l.CellData}],execute:function(){i._RF.push({},"d426eBvVidEpIqu4dCFfCSF","PlayerBaseViewModel",void 0);l("PlayerBaseViewModel",function(){function l(l,e,i,n,t){this.cells=[],this.columns=void 0,this.rows=void 0,this.cellRadius=void 0,this.columns=Math.max(1,l),this.rows=Math.max(1,e),this.cellRadius=Math.max(1,i),this.createCells(n,t)}var i=l.prototype;return i.getRawCellPosition=function(l){var e=1.5*this.cellRadius*l.q,i=this.cellRadius*Math.sqrt(3)*(l.r+.5*l.q);return new n(e,i,0)},i.createCells=function(l,i){for(var n,s=new Map,u=e(l);!(n=u()).done;){var o,r,a,d=n.value,c=null!=(o=null!=(r=d.buildingId)?r:null==(a=d.building)?void 0:a.id)?o:null;c&&s.set(d.q+"_"+d.r,{buildingId:c,buildingInstanceId:Number.isFinite(d.id)?d.id:null})}for(var h=0;h<this.columns;h+=1)for(var v=0;v<this.rows;v+=1){var f,g,p=null,w=s.get(h+"_"+v);w&&(p=i.get(w.buildingId)||null),this.cells.push(new t(h,v,p,null!=(f=null==w?void 0:w.buildingId)?f:null,null!=(g=null==w?void 0:w.buildingInstanceId)?g:null))}},l}());i._RF.pop()}}}));

System.register("chunks:///_virtual/PrepareBattleContracts.ts",["cc"],(function(){var t;return{setters:[function(e){t=e.cclegacy}],execute:function(){t._RF.push({},"509d82tQfFHEZpXWvTkZp5L","PrepareBattleContracts",void 0),t._RF.pop()}}}));

System.register("chunks:///_virtual/PrepareBattleItemContracts.ts",["cc"],(function(){var t;return{setters:[function(e){t=e.cclegacy}],execute:function(){t._RF.push({},"057b7xw+XdEgZruSnhnV1Ps","PrepareBattleItemContracts",void 0),t._RF.pop()}}}));

System.register("chunks:///_virtual/PrepareBattleItemView.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var t,i,r,n,o,a,c,s,l,p,u;return{setters:[function(e){t=e.applyDecoratedDescriptor,i=e.inheritsLoose,r=e.initializerDefineProperty,n=e.assertThisInitialized},function(e){o=e.cclegacy,a=e._decorator,c=e.Sprite,s=e.UITransform,l=e.resources,p=e.SpriteFrame,u=e.Component}],execute:function(){var h,f,S,d,k,v,w;o._RF.push({},"3ae32VAJiRPA4PQ4UQUMVrx","PrepareBattleItemView",void 0);var m=a.ccclass,M=a.property;e("PrepareBattleItemView",(h=m("PrepareBattleItemView"),f=M({type:c}),S=M({type:c}),h((v=t((k=function(e){function t(){for(var t,i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return t=e.call.apply(e,[this].concat(o))||this,r(t,"iconSprite",v,n(t)),r(t,"takeMark",w,n(t)),t.iconBaseSize=null,t.viewModel=null,t}i(t,e);var o=t.prototype;return o.onLoad=function(){if(this.iconSprite){var e=this.iconSprite.getComponent(s);e&&(this.iconBaseSize={width:e.contentSize.width,height:e.contentSize.height})}},o.bind=function(e){this.viewModel=e,this.viewModel.bindView(this)},o.setIcon=function(e){var t=this;this.iconSprite&&l.load(e,p,(function(e,i){if(e)console.error("[PrepareBattleItemView] icon load failed",e);else if(t.iconSprite){t.iconSprite.spriteFrame=i;var r=t.iconSprite.getComponent(s);r&&t.iconBaseSize&&r.setContentSize(t.iconBaseSize.width,t.iconBaseSize.height)}}))},o.onSelect=function(){var e;null==(e=this.viewModel)||e.select()},o.setTakeMarkVisible=function(e){this.takeMark&&(this.takeMark.node.active=e)},o.setTakeMarkSprite=function(e){this.takeMark&&(this.takeMark.spriteFrame=e,this.takeMark.node.active=!!e)},t}(u)).prototype,"iconSprite",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),w=t(k.prototype,"takeMark",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),d=k))||d));o._RF.pop()}}}));

System.register("chunks:///_virtual/PrepareBattleItemVM.ts",["cc","./StaticConfigStore.ts"],(function(t){var e,i;return{setters:[function(t){e=t.cclegacy},function(t){i=t.StaticConfigStore}],execute:function(){e._RF.push({},"2f4ceyyOMlOjJ6+o9SAkLRL","PrepareBattleItemVM",void 0);t("PrepareBattleItemVM",function(){function t(){this.view=null,this.unitId=null,this.iconPath=null,this.onSelect=null,this.selected=!1}var e=t.prototype;return e.bindView=function(t){this.view=t,this.syncView()},e.init=function(t,e,i){this.unitId=t,this.selected=e,this.onSelect=null!=i?i:null,this.loadUnitData(t),this.syncView()},e.select=function(){var t;this.unitId&&(this.setSelected(!this.selected),null==(t=this.onSelect)||t.call(this,this.unitId))},e.setSelected=function(t){this.selected=t,this.view&&this.view.setTakeMarkVisible(this.selected)},e.isSelected=function(){return this.selected},e.loadUnitData=function(t){var e=i.getUnitById(t);e?(this.iconPath=e.model,this.view&&this.view.setIcon(this.iconPath)):console.error("[PrepareBattleItem] Unit config not found for "+t)},e.syncView=function(){this.view&&(this.iconPath&&this.view.setIcon(this.iconPath),this.view.setTakeMarkVisible(this.selected))},t}());e._RF.pop()}}}));

System.register("chunks:///_virtual/PrepareBattleView.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var t,r,n,l,i,o,a,u,c;return{setters:[function(e){t=e.applyDecoratedDescriptor,r=e.inheritsLoose,n=e.initializerDefineProperty,l=e.assertThisInitialized},function(e){i=e.cclegacy,o=e._decorator,a=e.ScrollView,u=e.Prefab,c=e.Component}],execute:function(){var p,s,f,b,d,h,w,g,y,P,v,S,B;i._RF.push({},"17e355e6TpFI7G+T6gAXx4e","PrepareBattleView",void 0);var M=o.ccclass,m=o.property;e("PrepareBattleView",(p=M("PrepareBattleView"),s=m({type:a}),f=m({type:a}),b=m({type:a}),d=m({type:u}),h=m({type:u}),p((y=t((g=function(e){function t(){for(var t,r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return t=e.call.apply(e,[this].concat(i))||this,n(t,"line1Scroll",y,l(t)),n(t,"line2Scroll",P,l(t)),n(t,"line3Scroll",v,l(t)),n(t,"prepareBattleItemPrefab",S,l(t)),n(t,"battleManagerPrefab",B,l(t)),t.viewModel=null,t}r(t,e);var i=t.prototype;return i.bind=function(e){this.viewModel=e,this.viewModel.bindView(this)},i.render=function(){this.viewModel||console.error("[PrepareBattleView] ViewModel is not bound")},i.onStartBattle=function(){var e;null==(e=this.viewModel)||e.startBattle()},i.onClose=function(){var e;null==(e=this.viewModel)||e.close()},i.getLine1Scroll=function(){return this.line1Scroll},i.getLine2Scroll=function(){return this.line2Scroll},i.getLine3Scroll=function(){return this.line3Scroll},i.getPrepareBattleItemPrefab=function(){return this.prepareBattleItemPrefab},i.getBattleManagerPrefab=function(){return this.battleManagerPrefab},i.getRootNode=function(){return this.node},i.close=function(){this.viewModel=null,this.node.destroy()},t}(c)).prototype,"line1Scroll",[s],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),P=t(g.prototype,"line2Scroll",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),v=t(g.prototype,"line3Scroll",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),S=t(g.prototype,"prepareBattleItemPrefab",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),B=t(g.prototype,"battleManagerPrefab",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),w=g))||w));i._RF.pop()}}}));

System.register("chunks:///_virtual/PrepareBattleVM.ts",["./rollupPluginModLoBabelHelpers.js","cc","./StaticConfigStore.ts","./StaticConfigModels.ts","./UserService.ts","./PrepareBattleItemView.ts","./PrepareBattleItemVM.ts","./BattleLogic.ts"],(function(e){var t,n,i,r,a,o,s,l,c,f,u,h,g,d;return{setters:[function(e){t=e.createForOfIteratorHelperLoose,n=e.asyncToGenerator,i=e.regeneratorRuntime},function(e){r=e.cclegacy,a=e.resources,o=e.JsonAsset,s=e.instantiate,l=e.UITransform},function(e){c=e.StaticConfigStore},function(e){f=e.UnitLine},function(e){u=e.UserService},function(e){h=e.PrepareBattleItemView},function(e){g=e.PrepareBattleItemVM},function(e){d=e.BattleLogic}],execute:function(){r._RF.push({},"680f4SfiZNA/7CSHIxmvvbc","PrepareBattleVM",void 0);e("PrepareBattleVM",function(){function e(){this.view=null,this.itemPrefab=null,this.battleManagerPrefab=null,this.itemsById=new Map,this.selectedByLine=new Map}var r=e.prototype;return r.bindView=function(e){this.view=e,this.itemPrefab=e.getPrepareBattleItemPrefab(),this.battleManagerPrefab=e.getBattleManagerPrefab(),this.view.render(),this.populateUnits()},r.generateBattleConfig=function(){for(var e=c.getUnitsConfig().Units,t=[],n=[f.Line1,f.Live2,f.Line3],i=0,r=n;i<r.length;i++){var a=r[i],o=this.selectedByLine.get(a);o&&t.push(o)}for(var s=[],l=function(){var t=h[u],n=e.filter((function(e){return e.line===t}));if(0===n.length)return 1;var i=Math.floor(Math.random()*n.length);s.push(n[i].id)},u=0,h=n;u<h.length;u++)l();var g={user_config:{squad:t},enemy_config:{squad:s},biom:"snow"};return JSON.stringify(g,null,4)},r.loadJson=function(e){return new Promise((function(t,n){a.load(e,o,(function(e,i){e?n(e):t(i.json)}))}))},r.startBattle=function(){var e=n(i().mark((function e(){var t,n,r,a,o,c,f;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.loadJson("Config/Units");case 2:if(t=e.sent,n=new d(this.generateBattleConfig(),JSON.stringify(t)),r=n.simulateBattle(),this.view&&this.battleManagerPrefab){e.next=8;break}return console.error("[PrepareBattle] battleManagerPrefab is not set"),e.abrupt("return");case 8:if(a=this.view.getRootNode()){e.next=12;break}return console.error("[PrepareBattle] root node is not set"),e.abrupt("return");case 12:o=s(this.battleManagerPrefab),a.parent.addChild(o),c=a.getComponent(l),f=c?c.contentSize:{width:0,height:0},o.setPosition(-f.width/2,-f.height/2,0),o.getComponent("BattleManager").initBattle(r);case 19:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),r.close=function(){var e;null==(e=this.view)||e.close(),this.view=null},r.populateUnits=function(){var e=this;if(this.view)if(this.itemPrefab){var n=u.getInstance().itemsService,i=c.getUnitsConfig().Units,r=new Map;this.itemsById.clear(),this.selectedByLine.clear();for(var a,o=t(i);!(a=o()).done;){var f,d=a.value;if(!(n.getCount(d.id)<=0)){var v=this.getScrollForLine(d.line);if(v&&v.content){var p=s(this.itemPrefab);v.content.addChild(p);var m=null!=(f=r.get(v))?f:{offsetX:0,maxHeight:0,count:0},B=(p.getComponent(l)||p.addComponent(l)).contentSize,w=B.width>0?B.width:100,P=B.height>0?B.height:100,b=m.count>0?10:0;p.setPosition(m.offsetX+b+w/2,P/2-20,0),m.offsetX+=w+b,m.maxHeight=Math.max(m.maxHeight,P),m.count+=1,r.set(v,m);var S=p.getComponent(h);if(S){var L=new g;S.bind(L),L.init(d.id,!1,(function(t){e.handleSelect(t)})),this.itemsById.set(d.id,{vm:L,line:d.line})}else console.error("[PrepareBattle] PrepareBattleItemView is missing on prefab")}}}for(var M,C=t(r.entries());!(M=C()).done;){var y=M.value,I=y[0],x=y[1];if(I.content){var U=I.content.getComponent(l)||I.content.addComponent(l);U.setAnchorPoint(0,0);var V=I.node.getComponent(l),H=V?V.contentSize.width:0,z=V?V.contentSize.height:0,F=Math.max(x.offsetX,H),J=Math.max(x.maxHeight,z);U.setContentSize(F,J)}}}else console.error("[PrepareBattle] prepareBattleItemPrefab is not set")},r.getScrollForLine=function(e){if(!this.view)return null;switch(e){case f.Line1:return this.view.getLine1Scroll();case f.Live2:return this.view.getLine2Scroll();case f.Line3:return this.view.getLine3Scroll();default:return null}},r.handleSelect=function(e){var t=this.itemsById.get(e);if(t){var n=t.vm,i=t.line,r=this.selectedByLine.get(i);if(n.isSelected()){if(r&&r!==e){var a=this.itemsById.get(r);null==a||a.vm.setSelected(!1)}this.selectedByLine.set(i,e)}else r===e&&this.selectedByLine.delete(i)}},e}());r._RF.pop()}}}));

System.register("chunks:///_virtual/StartGameButton.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var e,n,r,o;return{setters:[function(t){e=t.inheritsLoose},function(t){n=t.cclegacy,r=t._decorator,o=t.Component}],execute:function(){var u;n._RF.push({},"be32dvTOUJCkKa1Yse1hmAi","StartGameButton",void 0);var a=r.ccclass;r.property,t("StartGameButton",a("StartGameButton")(u=function(t){function n(){return t.apply(this,arguments)||this}e(n,t);var r=n.prototype;return r.start=function(){},r.update=function(t){},n}(o))||u);n._RF.pop()}}}));

System.register("chunks:///_virtual/StaticConfigModels.ts",["cc"],(function(i){var t;return{setters:[function(i){t=i.cclegacy}],execute:function(){t._RF.push({},"850baqneYhDPbvq/BSvUQsw","StaticConfigModels",void 0);i("UnitLine",function(i){return i.Line1="line1",i.Live2="line2",i.Line3="line3",i}({})),i("UnitData",(function(i,t,s,o,e,n,h,d,v,u,c){this.id=void 0,this.title=void 0,this.description=void 0,this.model=void 0,this.line=void 0,this.abils=void 0,this.hp=void 0,this.v_base=void 0,this.v_mult_snow=void 0,this.v_mult_desert=void 0,this.v_mult_jungle=void 0,this.id=i,this.title=t,this.description=s,this.model=o,this.line=e,this.abils=n,this.hp=h,this.v_base=d,this.v_mult_snow=v,this.v_mult_desert=u,this.v_mult_jungle=c})),i("Money",(function(i,t){this.type=void 0,this.amount=void 0,this.type=i,this.amount=t})),i("Price",(function(i){void 0===i&&(i=[]),this.money=void 0,this.money=i})),i("ProductionEntry",(function(i,t){this.produce=void 0,this.cost=void 0,this.produce=i,this.cost=t}));t._RF.pop()}}}));

System.register("chunks:///_virtual/StaticConfigStore.ts",["./rollupPluginModLoBabelHelpers.js","cc","./PlayerBaseModels.ts","./StaticConfigModels.ts"],(function(i){var n,t,e,o,s,r,u,l,a,d,c;return{setters:[function(i){n=i.createForOfIteratorHelperLoose,t=i.asyncToGenerator,e=i.regeneratorRuntime},function(i){o=i.cclegacy,s=i.resources,r=i.JsonAsset},function(i){u=i.BuildingData},function(i){l=i.UnitData,a=i.ProductionEntry,d=i.Price,c=i.Money}],execute:function(){o._RF.push({},"30ae15wpSxONIwX3upCVDm8","StaticConfigStore",void 0);var f=i("StaticConfigStore",function(){function i(){}return i.init=function(){var i=t(e().mark((function i(n,t,o,s){var r,u,l,a,d;return e().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(void 0===n&&(n="Config/Buildings"),void 0===t&&(t="Config/Units"),void 0===o&&(o="Config/Production"),void 0===s&&(s="GameStuff"),!this.initialized||this.buildingsPath!==n||this.unitsPath!==t||this.productionPath!==o||this.moneyPath!==s){i.next=6;break}return i.abrupt("return");case 6:return i.next=8,Promise.all([this.loadJson(n),this.loadJson(t),this.loadJson(o),this.loadJson(s)]);case 8:r=i.sent,u=r[0],l=r[1],a=r[2],d=r[3],this.buildingModels=this.buildBuildingModels(u.buildings),this.buildingsConfig={buildings:Array.from(this.buildingModels.values())},this.unitsConfig=l,this.unitModels=this.buildUnitModels(l.Units),this.productionConfig=this.buildProductionConfig(a.Combotants),this.productionModels=this.buildProductionModels(this.productionConfig.Combotants),this.moneyConfig=d,this.moneyModels=this.buildMoneyModels(d.Money),this.buildingsPath=n,this.unitsPath=t,this.productionPath=o,this.moneyPath=s,this.initialized=!0;case 26:case"end":return i.stop()}}),i,this)})));return function(n,t,e,o){return i.apply(this,arguments)}}(),i.getBuildingsConfig=function(){return this.assertInitialized(),this.buildingsConfig},i.getBuildingModels=function(){return this.assertInitialized(),this.buildingModels},i.getUnitsConfig=function(){return this.assertInitialized(),this.unitsConfig},i.getUnitById=function(i){var n;return null!=(n=this.getUnitsConfig().Units.find((function(n){return n.id===i})))?n:null},i.getUnitModels=function(){return this.assertInitialized(),this.unitModels},i.getUnitConfigById=function(i){var n;return this.assertInitialized(),null!=(n=this.unitModels.get(i))?n:null},i.getProductionConfig=function(){return this.assertInitialized(),this.productionConfig},i.getProductionModels=function(){return this.assertInitialized(),this.productionModels},i.getProductionById=function(i){var n;return this.assertInitialized(),null!=(n=this.productionModels.get(i))?n:null},i.getMoneyConfig=function(){return this.assertInitialized(),this.moneyConfig},i.getCurrencyIconByName=function(i){var n,t;return this.assertInitialized(),null!=(n=null==(t=this.moneyModels.get(i))?void 0:t.icon)?n:null},i.getCurrencyIconByPrice=function(i){this.assertInitialized();var n=i.money.find((function(i){return i.amount>0}));return n?this.getCurrencyIconByName(n.type):null},i.getBuildingConfigById=function(i){var n;return this.assertInitialized(),null!=(n=this.buildingsConfig.buildings.find((function(n){return n.id===i})))?n:null},i.assertInitialized=function(){if(!(this.initialized&&this.buildingsConfig&&this.buildingModels&&this.unitsConfig&&this.unitModels&&this.productionConfig&&this.productionModels&&this.moneyConfig&&this.moneyModels))throw new Error("StaticConfigStore is not initialized")},i.buildBuildingModels=function(i){for(var t,e=new Map,o=n(i);!(t=o()).done;){var s=t.value;e.set(s.id,new u(s.id,s.kind,s.buildingImage,s.buildingIcon,s.message,s.nextLevelBuildingId,this.normalizePrice(s.upgradeCost)))}return e},i.buildUnitModels=function(i){for(var t,e=new Map,o=n(i);!(t=o()).done;){var s,r=t.value,u=null!=(s=r.Abilities)?s:r.abils;e.set(r.id,new l(r.id,r.title,r.description,r.model,r.line,u,r.hp,r.v_base,r.v_mult_snow,r.v_mult_desert,r.v_mult_jungle))}return e},i.buildProductionModels=function(i){for(var n=new Map,t=0,e=Object.entries(i);t<e.length;t++){var o=e[t],s=o[0],r=o[1];n.set(s,r)}return n},i.buildProductionConfig=function(i){for(var n={},t=0,e=Object.entries(i);t<e.length;t++){var o=e[t],s=o[0],r=o[1];n[s]=new a(r.produce,this.normalizePrice(r.cost))}return{Combotants:n}},i.buildMoneyModels=function(i){for(var t,e=new Map,o=n(i);!(t=o()).done;){var s=t.value;e.set(s.name,{name:s.name,icon:s.icon})}return e},i.normalizePrice=function(i){if(!i)return new d([]);if(i instanceof d)return new d(i.money.map((function(i){return new c(i.type,i.amount)})));var n=i;if(Array.isArray(n.money)){var t=n.money.map((function(i){var n;return new c(i.type,Math.max(0,null!=(n=i.amount)?n:0))}));return new d(t)}for(var e=[],o=0,s=Object.entries(i);o<s.length;o++){var r=s[o],u=r[0],l=r[1],a=Math.max(0,Number(l)||0);a>0&&e.push(new c(u,a))}return new d(e)},i.loadJson=function(i){return new Promise((function(n,t){s.load(i,r,(function(e,o){!e&&o?n(o.json):t(null!=e?e:new Error("Missing JSON asset at "+i))}))}))},i}());f.buildingsConfig=null,f.buildingModels=null,f.unitsConfig=null,f.unitModels=null,f.productionConfig=null,f.productionModels=null,f.moneyConfig=null,f.moneyModels=null,f.initialized=!1,f.buildingsPath="",f.unitsPath="",f.productionPath="",f.moneyPath="",o._RF.pop()}}}));

System.register("chunks:///_virtual/TownhallShopContracts.ts",["cc"],(function(){var t;return{setters:[function(c){t=c.cclegacy}],execute:function(){t._RF.push({},"9dbc7oR8VZD46yBrOBio+jq","TownhallShopContracts",void 0),t._RF.pop()}}}));

System.register("chunks:///_virtual/TownhallShopItem.ts",["./rollupPluginModLoBabelHelpers.js","cc","./MoneyBar.ts"],(function(t){var e,i,n,r,o,l,a,u,c,s,p,h,y;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,n=t.initializerDefineProperty,r=t.assertThisInitialized},function(t){o=t.cclegacy,l=t._decorator,a=t.Sprite,u=t.Label,c=t.RichText,s=t.resources,p=t.SpriteFrame,h=t.Component},function(t){y=t.MoneyBar}],execute:function(){var b,f,m,d,B,g,w,I,T,v,L;o._RF.push({},"c5a48ExiUNC5Lba/Ama9dvF","TownhallShopItem",void 0);var x=l.ccclass,S=l.property;t("TownhallShopItem",(b=x("TownhallShopItem"),f=S({type:a}),m=S({type:u}),d=S({type:c}),B=S({type:y}),b((I=e((w=function(t){function e(){for(var e,i=arguments.length,o=new Array(i),l=0;l<i;l++)o[l]=arguments[l];return e=t.call.apply(t,[this].concat(o))||this,n(e,"unitIcon",I,r(e)),n(e,"titleLabel",T,r(e)),n(e,"descriptionText",v,r(e)),n(e,"moneyBar",L,r(e)),e.unit=null,e.onBuy=null,e}i(e,t);var o=e.prototype;return o.bind=function(t,e,i){var n=this;this.unit=t,this.onBuy=null!=i?i:null,this.titleLabel&&(this.titleLabel.string=t.title||t.id),this.descriptionText&&(this.descriptionText.string=t.description),this.moneyBar&&(this.moneyBar.init(e),this.moneyBar.showPriceLabel(!0)),this.unitIcon&&s.load(t.model,p,(function(t,e){t?console.error("Failed to load unit icon:",t):n.unitIcon&&(n.unitIcon.spriteFrame=e)}))},o.onDestroy=function(){},o.handleBuy=function(){this.unit&&this.onBuy&&this.onBuy(this.unit)},e}(h)).prototype,"unitIcon",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),T=e(w.prototype,"titleLabel",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),v=e(w.prototype,"descriptionText",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),L=e(w.prototype,"moneyBar",[B],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),g=w))||g));o._RF.pop()}}}));

System.register("chunks:///_virtual/TownhallShopView.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var t,n,o,i,l,r,u,a,c;return{setters:[function(e){t=e.applyDecoratedDescriptor,n=e.inheritsLoose,o=e.initializerDefineProperty,i=e.assertThisInitialized},function(e){l=e.cclegacy,r=e._decorator,u=e.ScrollView,a=e.Prefab,c=e.Component}],execute:function(){var s,h,p,w,d,f,v;l._RF.push({},"65e5ex38cdI14KtqSfS+Kg4","TownhallShopView",void 0);var y=r.ccclass,b=r.property;e("TownhallShopView",(s=y("TownhallShopView"),h=b({type:u}),p=b({type:a}),s((f=t((d=function(e){function t(){for(var t,n=arguments.length,l=new Array(n),r=0;r<n;r++)l[r]=arguments[r];return t=e.call.apply(e,[this].concat(l))||this,o(t,"itemsScroll",f,i(t)),o(t,"townhallItem",v,i(t)),t.viewModel=null,t}n(t,e);var l=t.prototype;return l.bind=function(e){this.viewModel=e,this.viewModel.bindView(this)},l.render=function(){this.viewModel||console.error("TownhallShopViewModel is not bound")},l.getItemsScroll=function(){return this.itemsScroll},l.getTownhallItemPrefab=function(){return this.townhallItem},l.onUpgrade=function(){var e;null==(e=this.viewModel)||e.upgrade()},l.onBuy=function(){var e;null==(e=this.viewModel)||e.buy()},l.onClose=function(){var e;null==(e=this.viewModel)||e.close()},l.close=function(){this.viewModel=null,this.node.destroy()},t}(c)).prototype,"itemsScroll",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),v=t(d.prototype,"townhallItem",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),w=d))||w));l._RF.pop()}}}));

System.register("chunks:///_virtual/TownhallShopViewModel.ts",["cc","./StaticConfigStore.ts","./TownhallShopItem.ts","./UserService.ts"],(function(o){var e,n,t,i,r,l;return{setters:[function(o){e=o.cclegacy,n=o.UITransform,t=o.instantiate},function(o){i=o.StaticConfigStore},function(o){r=o.TownhallShopItem},function(o){l=o.UserService}],execute:function(){e._RF.push({},"5d91dmjmElAxYDhuL9OqkBp","TownhallShopViewModel",void 0);o("TownhallShopViewModel",function(){function o(){this.view=null}var e=o.prototype;return e.bindView=function(o){var e=this;this.view=o,this.view.render();var l=this.view.getItemsScroll(),c=this.view.getTownhallItemPrefab();if(l&&c){var s=l.content;if(s){var h=0,a=s.getComponent(n)||s.addComponent(n),d=a.contentSize.width||0,u=i.getProductionConfig().Combotants;Object.entries(u).forEach((function(o){var l=o[0],a=o[1],u=i.getUnitConfigById(a.produce);if(u){console.log("[TownhallShop] Available unit: "+u.id);var p=t(c),f=p.getComponent(r);if(f){var w=e.getPrice(l);f.bind(u,w,(function(){e.buy(u)})),s.addChild(p);var S=(p.getComponent(n)||p.addComponent(n)).contentSize,g=S.height&&S.height>0?S.height:100,v=S.width&&S.width>0?S.width:d||100;p.setPosition(0,-h-g/2,0),h+=g,v>d&&(d=v)}else console.error("[TownhallShop] TownhallShopItem component is missing on prefab")}else console.error("[TownhallShop] Unit config not found for "+a.produce)}));var p=l.node.getComponent(n),f=p?p.contentSize.width:0,w=p?p.contentSize.height:0,S=Math.max(d,f),g=Math.max(h,w);a.setContentSize(S,g)}else console.error("[TownhallShop] itemsScroll.content is not set")}else console.error("[TownhallShop] itemsScroll or townhallItem prefab is not set")},e.buy=function(o){var e=i.getProductionById(o.id);if(e){var n=l.getInstance(),t=n.walletService;if(t.canSpend(e.cost))t.spend(e.cost)?(n.itemsService.addItem(o.id,1),console.log("[TownhallShop] Bought "+o.id)):console.error("[TownhallShop] Spend failed for "+o.id);else console.error("[TownhallShop] Not enough currency to buy "+o.id)}else console.error("[TownhallShop] Production config not found for "+o.id)},e.upgrade=function(){console.log("[TownhallShop] upgrade clicked")},e.close=function(){var o;null==(o=this.view)||o.close(),this.dispose()},e.dispose=function(){this.view&&(this.view.close(),this.view=null)},e.getPrice=function(o){var e=i.getProductionById(o);return e?e.cost:new Price([])},o}());e._RF.pop()}}}));

System.register("chunks:///_virtual/UserModels.ts",["cc"],(function(){var e;return{setters:[function(s){e=s.cclegacy}],execute:function(){e._RF.push({},"c6614jBlG5Eb4P5Q4EaGs1+","UserModels",void 0),e._RF.pop()}}}));

System.register("chunks:///_virtual/UserMoneyBar.ts",["./rollupPluginModLoBabelHelpers.js","cc","./EventBus.ts","./UserService.ts","./MoneyBar.ts"],(function(e){var n,o,r,t,a,i,s,l,c,u,y,h;return{setters:[function(e){n=e.applyDecoratedDescriptor,o=e.inheritsLoose,r=e.initializerDefineProperty,t=e.assertThisInitialized},function(e){a=e.cclegacy,i=e._decorator,s=e.Node,l=e.Component},function(e){c=e.bus,u=e.Events},function(e){y=e.UserService},function(e){h=e.MoneyBar}],execute:function(){var B,p,f,d,v;a._RF.push({},"7842c/uhoBG9YHsN6WxuP9n","UserMoneyBar",void 0);var m=i.ccclass,M=i.property;e("UserMoneyBar",(B=m("UserMoneyBar"),p=M({type:s}),B((v=n((d=function(e){function n(){for(var n,o=arguments.length,a=new Array(o),i=0;i<o;i++)a[i]=arguments[i];return n=e.call.apply(e,[this].concat(a))||this,r(n,"moneyBarNode",v,t(n)),n.moneyBar=null,n}o(n,e);var a=n.prototype;return a.onLoad=function(){this.moneyBar=this.resolveMoneyBar(),c.on(u.WALLET_CHANGED,this.onWalletChanged,this)},a.onEnable=function(){var e;this.moneyBar=null!=(e=this.moneyBar)?e:this.resolveMoneyBar(),this.refreshFromWallet()},a.onDestroy=function(){c.off(u.WALLET_CHANGED,this.onWalletChanged,this)},a.refreshFromWallet=function(){var e=y.getInstance().walletService;this.updateMoneyBar(e.getBalance())},a.onWalletChanged=function(e){console.log("[UserMoneyBar] Wallet changed event received:",e),this.updateMoneyBar(e.balance)},a.updateMoneyBar=function(e){this.moneyBar&&this.moneyBar.init(e)},a.resolveMoneyBar=function(){var e,n,o=null!=(e=this.moneyBarNode)?e:this.node,r=null!=(n=o.getComponent(h))?n:o.getComponentInChildren(h);return r||console.error("[UserMoneyBar] MoneyBar component is missing"),r},n}(l)).prototype,"moneyBarNode",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),f=d))||f));a._RF.pop()}}}));

System.register("chunks:///_virtual/UserService.ts",["cc","./BuildingService.ts","./ItemsService.ts","./WalletService.ts","./StaticConfigModels.ts"],(function(e){var n,t,i,r,c,s;return{setters:[function(e){n=e.cclegacy},function(e){t=e.BuildingService},function(e){i=e.ItemsService},function(e){r=e.WalletService},function(e){c=e.Price,s=e.Money}],execute:function(){n._RF.push({},"8d433ypbSpNiZyWfQqnFFKh","UserService",void 0),e("UserService",function(){function e(){this.buildingService=void 0,this.walletService=void 0,this.itemsService=void 0,this.walletService=new r,this.buildingService=new t(this.walletService),this.itemsService=new i}e.getInstance=function(){return this.instance||(this.instance=new e),this.instance};var n=e.prototype;return n.applyUserData=function(e,n){var t,i;void 0===n&&(n=0);var r=this.normalizeWallet(e.wallet,n);this.walletService.setBalance(r),this.buildingService.setBuildingInstances(null!=(t=null==(i=e.Buildings)?void 0:i.cells)?t:[])},n.normalizeWallet=function(e,n){if(!e)return new c(n>0?[new s("soft",n)]:[]);if(e instanceof c)return new c(e.money.map((function(e){return new s(e.type,e.amount)})));var t=e;if(Array.isArray(t.money)){var i=t.money.map((function(e){var n;return new s(e.type,Math.max(0,null!=(n=e.amount)?n:0))}));return new c(i)}for(var r=[],a=0,l=Object.entries(e);a<l.length;a++){var u=l[a],o=u[0],v=u[1],f=Math.max(0,Number(v)||0);f>0&&r.push(new s(o,f))}return 0===r.length&&n>0&&r.push(new s("soft",n)),new c(r)},e}()).instance=null,n._RF.pop()}}}));

System.register("chunks:///_virtual/WalletService.ts",["./rollupPluginModLoBabelHelpers.js","cc","./EventBus.ts","./StaticConfigModels.ts"],(function(e){var n,t,a,r,i,o;return{setters:[function(e){n=e.createForOfIteratorHelperLoose},function(e){t=e.cclegacy},function(e){a=e.bus,r=e.Events},function(e){i=e.Price,o=e.Money}],execute:function(){t._RF.push({},"d22daX9g1BHLYTbCkEkg76w","WalletService",void 0);e("WalletService",function(){function e(){this.balance=new i([])}var t=e.prototype;return t.getBalance=function(){return console.log("[WalletService] getBalance -> "+this.formatPrice(this.balance)),this.clonePrice(this.balance)},t.setBalance=function(e){var n=this.normalizePrice(e);console.log("[WalletService] setBalance from "+this.formatPrice(this.balance)+" to "+this.formatPrice(n)),this.balance=n,this.emitBalanceChanged()},t.add=function(e){var n=this.normalizePrice(e);this.isZeroPrice(n)?console.log("[WalletService] add skipped: amount must be > 0"):(this.balance=this.applyDelta(this.balance,n,1),console.log("[WalletService] add applied: new balance "+this.formatPrice(this.balance)),this.emitBalanceChanged())},t.canSpend=function(e){var t=this.normalizePrice(e);if(this.isZeroPrice(t))return!0;for(var a,r=this.toMap(this.balance),i=!0,o=n(t.money);!(a=o()).done;){var c,l=a.value,s=null!=(c=r.get(l.type))?c:0;if(l.amount>s){i=!1;break}}return console.log("[WalletService] canSpend "+this.formatPrice(t)+"? "+i),i},t.spend=function(e){var n=this.normalizePrice(e);return console.log("[WalletService] spend requested "+this.formatPrice(n)),!!this.isZeroPrice(n)||(this.canSpend(n)?(this.balance=this.applyDelta(this.balance,n,-1),console.log("[WalletService] spend succeeded: new balance "+this.formatPrice(this.balance)),this.emitBalanceChanged(),!0):(console.log("[WalletService] spend failed: insufficient funds"),!1))},t.normalizePrice=function(e){if(!e)return new i([]);if(e instanceof i)return this.clonePrice(e);var n=e;if(Array.isArray(n.money)){var t=n.money.map((function(e){var n;return new o(e.type,Math.max(0,null!=(n=e.amount)?n:0))}));return new i(t)}for(var a=[],r=0,c=Object.entries(e);r<c.length;r++){var l=c[r],s=l[0],u=l[1],h=Math.max(0,Number(u)||0);h>0&&a.push(new o(s,h))}return new i(a)},t.isZeroPrice=function(e){return e.money.every((function(e){return e.amount<=0}))},t.formatPrice=function(e){return 0===e.money.length?"empty":e.money.map((function(e){return e.type+" "+e.amount})).join(", ")},t.toMap=function(e){for(var t,a=new Map,r=n(e.money);!(t=r()).done;){var i,o,c=t.value,l=Math.max(0,null!=(i=c.amount)?i:0);l<=0||a.set(c.type,(null!=(o=a.get(c.type))?o:0)+l)}return a},t.applyDelta=function(e,t,a){for(var r,i=this.toMap(e),o=n(t.money);!(r=o()).done;){var c,l=r.value,s=null!=(c=i.get(l.type))?c:0;i.set(l.type,s+l.amount*a)}return this.mapToPrice(i)},t.mapToPrice=function(e){for(var t,a=[],r=n(e.entries());!(t=r()).done;){var c=t.value,l=c[0],s=c[1];s>0&&a.push(new o(l,s))}return new i(a)},t.clonePrice=function(e){return new i(e.money.map((function(e){return new o(e.type,e.amount)})))},t.emitBalanceChanged=function(){a.emit(r.WALLET_CHANGED,{balance:this.clonePrice(this.balance)})},e}());t._RF.pop()}}}));

(function(r) {
  r('virtual:///prerequisite-imports/main', 'chunks:///_virtual/main'); 
})(function(mid, cid) {
    System.register(mid, [cid], function (_export, _context) {
    return {
        setters: [function(_m) {
            var _exportObj = {};

            for (var _key in _m) {
              if (_key !== "default" && _key !== "__esModule") _exportObj[_key] = _m[_key];
            }
      
            _export(_exportObj);
        }],
        execute: function () { }
    };
    });
});