System.register("chunks:///_virtual/BaseAbil.ts",["cc"],(function(t){var i;return{setters:[function(t){i=t.cclegacy}],execute:function(){i._RF.push({},"9b438R6UM9En66w1nZMEFGO","BaseAbil",void 0);t("BaseAbil",function(){function t(t,i,n,e){this.abilConfig=void 0,this.battleLog=void 0,this.battleground=void 0,this.abilConfig=t,this.battleLog=n,this.battleground=e}return t.prototype.tick=function(t,i){},t}());i._RF.pop()}}}));

System.register("chunks:///_virtual/BattleBombView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./BattleViewCommon.ts"],(function(e){var o,t,i,n,r,l,a,c,s,p,u,d;return{setters:[function(e){o=e.applyDecoratedDescriptor,t=e.inheritsLoose,i=e.initializerDefineProperty,n=e.assertThisInitialized},function(e){r=e.cclegacy,l=e._decorator,a=e.ParticleSystem,c=e.Node,s=e.tween,p=e.Component},function(e){u=e.getRealXFromRelative,d=e.getRealYFromLine}],execute:function(){var b,m,y,f,v,h,B;r._RF.push({},"6dcc0+y8k1GkIsvlzGxRaXi","BattleBombView",void 0);var x=l.ccclass,g=l.property;e("BattleBombView",(b=x("BattleBombView"),m=g({type:a}),y=g({type:c}),b((h=o((v=function(e){function o(){for(var o,t=arguments.length,r=new Array(t),l=0;l<t;l++)r[l]=arguments[l];return o=e.call.apply(e,[this].concat(r))||this,i(o,"explosion",h,n(o)),i(o,"bombNode",B,n(o)),o}return t(o,e),o.prototype.init=function(e,o,t,i,n){var r=this;this.explosion.node.active=!1;var l=u(o),a=d(e),c=u(n),p=d(i);this.node.setPosition(l,a,0),console.log("Bomb launched from ("+l+", "+a+") to ("+c+", "+p+") over "+t+" seconds."),s(this.node).to(t,{position:{x:c,y:p,z:0}}).call((function(){r.bombNode.active=!1,r.explosion.node.active=!0,r.explosion.stop(),r.explosion.clear(),r.explosion.play()})).delay(3).call((function(){r.node.destroy()})).start()},o}(p)).prototype,"explosion",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),B=o(v.prototype,"bombNode",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),f=v))||f));r._RF.pop()}}}));

System.register("chunks:///_virtual/Battleground.ts",["./rollupPluginModLoBabelHelpers.js","cc","./CommonBattle.ts","./BattleStateMachine.ts"],(function(t){var n,e,a,i;return{setters:[function(t){n=t.createForOfIteratorHelperLoose},function(t){e=t.cclegacy},function(t){a=t.BattleTeam},function(t){i=t.BattleUnitState}],execute:function(){e._RF.push({},"59391kMDANBBYDglOCYagFd","Battleground",void 0);t("Battleground",function(){function t(){this.team1Units=[],this.team2Units=[]}var e=t.prototype;return e.startBattle=function(){this.team1Units.forEach((function(t){return t.startBattle()})),this.team2Units.forEach((function(t){return t.startBattle()}))},e.getEnemyTeam=function(t){return t==a.Team1?this.team2Units:t==a.Team2?this.team1Units:(console.error("REQUEST UNONOWN TEAM: ",t),null)},e.getEnemyAtLine=function(t){var n=this.getEnemyTeam(t.team);if(null===n)return null;var e=null,a=1/0;return n.forEach((function(n){var r=Math.abs(t.position-n.position);r<a&&n.unitData.line===t.unitData.line&&n.stateMachine.getState()!==i.Dead&&(a=r,e=n)})),e},e.getEnemyAtLineByLine=function(t,e){var a=this.getEnemyTeam(t);if(null===a)return null;for(var i,r=n(a);!(i=r()).done;){var u=i.value;if(u.unitData.line===e)return u}return null},e.update=function(t,n){this.team1Units.forEach((function(e){return e.update(t,n)})),this.team2Units.forEach((function(e){return e.update(t,n)}))},e.finishBattle=function(){this.team1Units.forEach((function(t){return t.finishBattle()})),this.team2Units.forEach((function(t){return t.finishBattle()}))},t}());e._RF.pop()}}}));

System.register("chunks:///_virtual/BattleLog.ts",["cc"],(function(t){var e;return{setters:[function(t){e=t.cclegacy}],execute:function(){e._RF.push({},"53802BxY01Fx6RiO+Jjgdll","BattleLog",void 0);t("BattleLog",function(){function t(t,e){this.version=1,this.battleId=void 0,this.startedAt=void 0,this.events=[],this.battleId=t,this.startedAt=e}var e=t.prototype;return e.addEvent=function(t){this.events.push(t)},e.addStartEvent=function(t,e,n){this.events.push({t:"start",seed:t,user_squad:e,enemy_squad:n})},e.addMoveEvent=function(t,e,n,s,i){this.events.push({t:"mv",unit:t,time:e,fromPos:n,finishTime:s,toPos:i})},e.addChangeHpEvent=function(t,e,n){this.events.push({t:"chp",time:t,unit:e,newHp:n})},e.addDeathEvent=function(t,e){this.events.push({t:"death",time:t,unit:e})},e.addBombEvent=function(t,e,n,s,i,a){this.events.push({t:"bomb",time:t,startLine:e,startPos:n,finishTime:s,targetLine:i,targetPos:a})},e.addBulletShotEvent=function(t,e,n){this.events.push({t:"bullet_shot",time:t,attacker:e,target:n})},e.addFinishEvent=function(t,e,n,s,i,a){this.events.push({t:"finish",time:t,winner:e,team1FinishedUnits:n,team1Score:s,team2FinishedUnits:i,team2Score:a})},e.getEvents=function(){return this.events},e.toJSON=function(){return{version:this.version,battleId:this.battleId,startedAt:this.startedAt,events:this.events}},t}());e._RF.pop()}}}));

System.register("chunks:///_virtual/BattleLogic.ts",["cc","./BattleLog.ts","./CommonBattle.ts","./BattleStateMachine.ts","./BattleUnit.ts","./Battleground.ts"],(function(t){var e,n,a,i,o,s;return{setters:[function(t){e=t.cclegacy},function(t){n=t.BattleLog},function(t){a=t.BattleTeam},function(t){i=t.BattleUnitState},function(t){o=t.BattleUnit},function(t){s=t.Battleground}],execute:function(){e._RF.push({},"66653zBvnpPnq32xucJxmmD","BattleLogic",void 0),t("BattleLogic",function(){function t(e,i){var l=this;this.battleConfig=void 0,this.unitsConfig=void 0,this.battleLog=void 0,this.battleground=void 0,this.battleConfig=this.parseJson(e),this.unitsConfig=this.parseJson(i),this.battleground=new s,this.battleLog=new n("battle_"+Date.now(),Date.now());var u=0,r={},g={};this.battleConfig.user_config.squad.forEach((function(e){var n=l.unitsConfig.Units.find((function(t){return t.id===e}));if(n){var i=new o(u,n,l.battleConfig,l.battleLog,l.battleground,a.Team1,t.fightDistance);r[u]=n.id,console.log("Adding ALLY battle unit: "+i),l.battleground.team1Units.push(i),u+=1}})),this.battleConfig.enemy_config.squad.forEach((function(e){var n=l.unitsConfig.Units.find((function(t){return t.id===e}));if(n){var i=new o(u,n,l.battleConfig,l.battleLog,l.battleground,a.Team2,t.fightDistance);g[u]=n.id,l.battleground.team2Units.push(i)}u+=1})),this.battleLog.addStartEvent(Math.floor(1e6*Math.random()),r,g)}var e=t.prototype;return e.simulateBattle=function(){var t=this;this.battleground.startBattle();for(var e=!1,n=1/30,o=120,s=function(){t.battleground.update(n,120-o),(o-=n)<=0&&(console.log("Battle ended in a draw due to time out."),e=!0);var a=0,s=0,l=0,u=0;t.battleground.team1Units.forEach((function(t){t.stateMachine.getState()!=i.Dead&&(a++,t.position>=100&&l++)})),t.battleground.team2Units.forEach((function(t){t.stateMachine.getState()!=i.Dead&&(s++,t.position<=0&&u++)})),a==l&&s==u&&(console.log("Battle ended. User alive: "+a+" (finished: "+l+"), Enemy alive: "+s+" (finished: "+u+")"),e=!0)};!e;)s();this.battleground.finishBattle();var l,u=0,r=0,g=0,c=0;return this.battleground.team1Units.forEach((function(t){u+=t.causedDamage,t.stateMachine.getState()!=i.Dead&&t.position>=100&&g++})),this.battleground.team2Units.forEach((function(t){r+=t.causedDamage,t.stateMachine.getState()!=i.Dead&&t.position<=0&&c++})),l=g!=c?g>c?a.Team1:a.Team2:u>r?a.Team1:a.Team2,this.battleLog.addFinishEvent(120-o,l,g,u,c,r),console.log("Battle Log:",JSON.stringify(this.battleLog,null,2)),JSON.stringify(this.battleLog,null,2)},e.parseJson=function(t){return JSON.parse(t)},t}()).fightDistance=20,e._RF.pop()}}}));

System.register("chunks:///_virtual/BattleManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./BattleUnitView.ts","./BattleBombView.ts","./BulletShotView.ts","./CommonBattle.ts"],(function(t){var e,i,n,a,r,l,o,s,b,u,h,c,f,m,p;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,n=t.initializerDefineProperty,a=t.assertThisInitialized},function(t){r=t.cclegacy,l=t._decorator,o=t.Node,s=t.Prefab,b=t.Label,u=t.instantiate,h=t.Component},function(t){c=t.BattleUnitView},function(t){f=t.BattleBombView},function(t){m=t.BulletShotView},function(t){p=t.BattleTeam}],execute:function(){var w,d,v,g,B,S,V,y,P,L,U,N,T,z,C,M,_,I,D;r._RF.push({},"07e9eI6lwZJx5ZJWVSZVA7N","BattleManager",void 0);var F=l.ccclass,H=l.property;t("BattleManager",(w=F("BattleManager"),d=H({type:o}),v=H({type:s}),g=H({type:s}),B=H({type:s}),S=H({type:b}),V=H({type:b}),y=H({type:b}),P=H({type:o}),w((N=e((U=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),l=0;l<i;l++)r[l]=arguments[l];return e=t.call.apply(t,[this].concat(r))||this,n(e,"battleNode",N,a(e)),n(e,"battleUnitViewPrefab",T,a(e)),n(e,"battleBombViewPrefab",z,a(e)),n(e,"bulletShotViewPrefab",C,a(e)),n(e,"winnerLabel",M,a(e)),n(e,"team1ScoreLabel",_,a(e)),n(e,"team2ScoreLabel",I,a(e)),n(e,"finishBattleNode",D,a(e)),e.battleUnitViews=new Map,e.events=[],e.timeSinceBattleStart=0,e}i(e,t);var r=e.prototype;return r.initBattle=function(t){var e=JSON.parse(t);if(this.events=e.events,this.events.sort((function(t,e){var i,n;return(null!=(i=t.time)?i:0)-(null!=(n=e.time)?n:0)})),this.finishBattleNode.active=!1,"start"===this.events[0].t){var i=this.events[0].user_squad;for(var n in i){var a=i[n],r=u(this.battleUnitViewPrefab).getComponent(c);r.node.setScale(-1,1,1),r.init(parseInt(n),a,p.Team1),this.battleNode.addChild(r.node),this.battleUnitViews.set(parseInt(n),r)}var l=this.events[0].enemy_squad;for(var o in l){var s=l[o],b=u(this.battleUnitViewPrefab).getComponent(c);b.init(parseInt(o),s,p.Team2),this.battleNode.addChild(b.node),this.battleUnitViews.set(parseInt(o),b)}this.events.shift()}else console.error("Battle log does not start with a start event");console.log("[BattleManager] Battle started with "+this.events.length+" events."+this.events)},r.update=function(t){if(this.timeSinceBattleStart+=t,0!==this.events.length&&this.timeSinceBattleStart>=this.events.at(0).time){var e=this.events.shift();if("mv"===e.t){var i=e.unit,n=e.fromPos,a=e.toPos,r=this.battleUnitViews.get(i);r&&r.moveTo(n,a,e.finishTime-e.time)}if("chp"===e.t){var l=e.unit,o=e.newHp,s=this.battleUnitViews.get(l);s&&s.changeHp(o)}if("bomb"===e.t){var b=u(this.battleBombViewPrefab).getComponent(f);b.init(e.startLine,e.startPos,e.finishTime-e.time,e.targetLine,e.targetPos),this.battleNode.addChild(b.node)}if("bullet_shot"===e.t){var h=u(this.bulletShotViewPrefab).getComponent(m);h.init(this.battleUnitViews.get(e.attacker),this.battleUnitViews.get(e.target).node),this.battleNode.addChild(h.node)}if("death"===e.t){var c=e.unit,w=this.battleUnitViews.get(c);w&&w.death()}"finish"===e.t&&(e.winner===p.Team1?this.winnerLabel.string="Team 1 Wins!":this.winnerLabel.string="Team 2 Wins!",this.team1ScoreLabel.string="Team 1 Score: "+e.team1Score.toString(),this.team2ScoreLabel.string="Team 2 Score: "+e.team2Score.toString(),this.finishBattleNode.active=!0)}},r.closeBattle=function(){this.node.removeFromParent()},e}(h)).prototype,"battleNode",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),T=e(U.prototype,"battleUnitViewPrefab",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),z=e(U.prototype,"battleBombViewPrefab",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),C=e(U.prototype,"bulletShotViewPrefab",[B],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),M=e(U.prototype,"winnerLabel",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_=e(U.prototype,"team1ScoreLabel",[V],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),I=e(U.prototype,"team2ScoreLabel",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),D=e(U.prototype,"finishBattleNode",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),L=U))||L));r._RF.pop()}}}));

System.register("chunks:///_virtual/BattleStateMachine.ts",["cc"],(function(t){var e;return{setters:[function(t){e=t.cclegacy}],execute:function(){e._RF.push({},"60c06RzBtFOQpaJ4fBc/B5K","BattleStateMachine",void 0);var a=t("BattleUnitState",function(t){return t.Preparing="preparing",t.Moving="moving",t.CloseCombat="close_combat",t.Dead="dead",t}({}));t("BattleUnitStateMachine",function(){function t(t){this.state=void 0,this.onStateChange=void 0,this.state=a.Preparing,this.onStateChange=t}var e=t.prototype;return e.setOnStateChange=function(t){this.onStateChange=t},e.setState=function(t){if(this.state!==t){var e=this.state;this.state=t,this.onStateChange&&e!==t&&this.onStateChange(e,t)}},e.getState=function(){return this.state},t}());e._RF.pop()}}}));

System.register("chunks:///_virtual/BattleUnit.ts",["cc","./CommonBattle.ts","./BattleStateMachine.ts","./BombAbil.ts","./BulletShotAbil.ts"],(function(t){var i,e,a,s,n,o;return{setters:[function(t){i=t.cclegacy},function(t){e=t.BattleTeam},function(t){a=t.BattleUnitState,s=t.BattleUnitStateMachine},function(t){n=t.BombAbil},function(t){o=t.BulletShotAbil}],execute:function(){i._RF.push({},"753acSiGqRMvqd1iIBz1vNY","BattleUnit",void 0);t("BattleUnit",function(){function t(t,i,n,o,h,c,l){var r=this;this.unitData=void 0,this.battleConfig=void 0,this.hp=void 0,this.position=void 0,this.team=void 0,this.battleLog=void 0,this.battleground=void 0,this.battleUnitId=void 0,this.closeCombatDistance=void 0,this.movingStartTime=void 0,this.movingStartPos=void 0,this.curTimeFromStart=void 0,this.stateMachine=void 0,this.abils=[],this.causedDamage=0,this.unitStateChange=function(t,i){t!==a.Moving&&i===a.Moving&&(r.movingStartTime=r.curTimeFromStart,r.movingStartPos=r.position),t===a.Moving&&i!==a.Moving&&r.finishMoveEvent(),i===a.Dead&&r.battleLog.addDeathEvent(r.curTimeFromStart,r.battleUnitId),a.CloseCombat},this.unitData=i,this.battleLog=o,this.battleConfig=n,this.hp=i.hp,this.team=c,this.battleUnitId=t,this.battleground=h,this.closeCombatDistance=l,this.stateMachine=new s(this.unitStateChange),this.position=c===e.Team1?0:100,this.movingStartTime=0,this.curTimeFromStart=0,this.movingStartPos=0}var i=t.prototype;return i.startBattle=function(){var t=this;null!=this.unitData.abils&&this.unitData.abils.forEach((function(i){"bomb_abil"===i.name&&t.abils.push(new n(i,t,t.battleLog,t.battleground)),"bullet_shot"===i.name&&t.abils.push(new o(i,t,t.battleLog,t.battleground))}))},i.update=function(t,i){if(this.stateMachine.getState()!==a.Dead)switch(this.stateMachine.getState()!==a.Dead&&this.abils.forEach((function(e){e.tick(t,i)})),this.curTimeFromStart=i,this.stateMachine.getState()){case a.Preparing:this.stateMachine.setState(a.Moving);break;case a.Moving:this.move(t,i),this.checkForRickEndOfScreen(),this.checkForCloseCombatState();break;case a.CloseCombat:this.checkForCloseCombatState();break;case a.Dead:}},i.finishMoveEvent=function(){this.battleLog.addMoveEvent(this.battleUnitId,this.movingStartTime,this.movingStartPos,this.curTimeFromStart,this.position)},i.calcSpeed=function(){var t=this.unitData.v_base;switch(this.battleConfig.biom){case"snow":t*=this.unitData.v_mult_snow;break;case"desert":t*=this.unitData.v_mult_desert;break;case"jungle":t*=this.unitData.v_mult_jungle}return t},i.move=function(t,i){var a=this.calcSpeed();this.team===e.Team1?this.position+=a*t:this.position-=a*t},i.checkForRickEndOfScreen=function(){this.team===e.Team1&&this.position>=100&&(this.position=100,this.stateMachine.setState(a.CloseCombat),this.finishMoveEvent()),this.team===e.Team2&&this.position<=0&&(this.position=0,this.stateMachine.setState(a.CloseCombat),this.finishMoveEvent())},i.checkForCloseCombatState=function(){var t=this.battleground.getEnemyAtLine(this);null!=t?Math.abs(this.position-t.position)<=this.closeCombatDistance&&this.stateMachine.setState(a.CloseCombat):this.stateMachine.setState(a.Moving)},i.applyDamage=function(t,i){t.causedDamage+=i,this.hp-=i,this.battleLog.addChangeHpEvent(this.curTimeFromStart,this.battleUnitId,Math.max(this.hp,0)),this.hp<=0&&this.stateMachine.setState(a.Dead)},i.finishBattle=function(){this.stateMachine.getState()===a.Moving&&this.finishMoveEvent()},t}());i._RF.pop()}}}));

System.register("chunks:///_virtual/BattleUnitView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./StaticConfigStore.ts","./CommonBattle.ts","./BattleViewCommon.ts"],(function(t){var e,i,n,o,a,r,l,s,c,u,p,h,m,f,d,g,y;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,n=t.initializerDefineProperty,o=t.assertThisInitialized},function(t){a=t.cclegacy,r=t._decorator,l=t.Sprite,s=t.ProgressBar,c=t.Node,u=t.resources,p=t.SpriteFrame,h=t.tween,m=t.Component},function(t){f=t.StaticConfigStore},function(t){d=t.BattleTeam},function(t){g=t.getRealYFromLine,y=t.getRealXFromRelative}],execute:function(){var b,v,B,w,z,P,U,I,S;a._RF.push({},"6b51aT0CkxPVplxw9E/n3ig","BattleUnitView",void 0);var V=r.ccclass,x=r.property;t("BattleUnitView",(b=V("BattleUnitView"),v=x({type:l}),B=x({type:s}),w=x({type:c}),b((U=e((P=function(t){function e(){for(var e,i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return e=t.call.apply(t,[this].concat(a))||this,n(e,"combotant",U,o(e)),n(e,"healthBar",I,o(e)),n(e,"muzzleflashNode",S,o(e)),e.battleUnitId=0,e.startHp=0,e.team=void 0,e}i(e,t);var a=e.prototype;return a.init=function(t,e,i){var n=this;this.battleUnitId=t,this.team=i;var o=f.getUnitById(e);if(null!==o){u.load(o.model,p,(function(t,e){n.combotant.spriteFrame=e})),console.log("Initializing BattleUnitView for unitId: "+e+" on team "+this.team+" "+i);this.node.getPosition();var a=g(o.line);d.Team1===this.team&&this.node.setPosition(y(0),a,0),d.Team2===this.team&&this.node.setPosition(y(100),a,0),this.startHp=o.hp}},a.moveTo=function(t,e,i){var n=this.node.getPosition(),o=y(t),a=y(e);console.log("Moving unit "+this.battleUnitId+" from "+o.x+" to "+a.x+" over "+i+" seconds."),this.node.setPosition(o,n.y,0),h(this.node).to(i,{position:{x:a,y:n.y,z:0}}).start()},a.changeHp=function(t){this.healthBar.progress=1-t/this.startHp},a.death=function(){this.node.active=!1},e}(m)).prototype,"combotant",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),I=e(P.prototype,"healthBar",[B],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),S=e(P.prototype,"muzzleflashNode",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),z=P))||z));a._RF.pop()}}}));

System.register("chunks:///_virtual/BattleViewCommon.ts",["cc","./StaticConfigModels.ts"],(function(e){var t,i,n;return{setters:[function(e){t=e.cclegacy,i=e.view},function(e){n=e.UnitLine}],execute:function(){function c(){return i.getVisibleSize()}e({getRealXFromRelative:function(e){var t=c().width;return t*e/100-t/2},getRealYFromLine:function(e){var t=c().height,i=-t/2;e===n.Line1&&(i+=.2*t);e===n.Live2&&(i+=.5*t);e===n.Line3&&(i+=.7*t);return i},getScreenSize:c}),t._RF.push({},"3cac3XmNK1GZ6j+et04L2V/","BattleViewCommon",void 0),t._RF.pop()}}}));

System.register("chunks:///_virtual/BombAbil.ts",["./rollupPluginModLoBabelHelpers.js","cc","./BaseAbil.ts","./BattleStateMachine.ts"],(function(t){var i,e,o,n;return{setters:[function(t){i=t.inheritsLoose},function(t){e=t.cclegacy},function(t){o=t.BaseAbil},function(t){n=t.BattleUnitState}],execute:function(){e._RF.push({},"097eaC+u9VEk5mz/VS/HNaw","BombAbil",void 0);var m=function(t,i){this.pos=void 0,this.unitLine=void 0,this.pos=t,this.unitLine=i};t("BombAbil",function(t){function e(i,e,o,n){var m;return(m=t.call(this,i,e,o,n)||this).timeout=void 0,m.dmg=void 0,m.targets=void 0,m.v=void 0,m.owner=void 0,m.flightTime=0,m.remainTimeout=void 0,m.startBombPos=null,m.startBombTime=0,m.bombFlightTimeRemaining=0,m.timeout=i.timeout,m.dmg=i.dmg,m.targets=i.targets,m.v=i.v,m.owner=e,m.flightTime=i.flightTime,m.remainTimeout=m.timeout,m.bombFlightTimeRemaining=Number.MAX_VALUE,m}return i(e,t),e.prototype.tick=function(i,e){var o=this;t.prototype.tick.call(this,i,e),this.remainTimeout-=i,this.remainTimeout<=0&&(this.startBombPos=new m(this.owner.position,this.owner.unitData.line),this.startBombTime=e,this.bombFlightTimeRemaining=this.flightTime,this.remainTimeout=this.timeout),this.bombFlightTimeRemaining-=i,this.bombFlightTimeRemaining<0&&(this.bombFlightTimeRemaining=Number.MAX_VALUE,this.targets.forEach((function(t){var i,m,s=o.battleground.getEnemyAtLineByLine(o.owner.team,t);s&&s.stateMachine.getState()!==n.Dead&&(o.battleLog.addBombEvent(o.startBombTime,null==(i=o.startBombPos)?void 0:i.unitLine,null==(m=o.startBombPos)?void 0:m.pos,e,s.unitData.line,s.position),s.applyDamage(o.owner,o.dmg))})))},e}(o));e._RF.pop()}}}));

System.register("chunks:///_virtual/BuildingContracts.ts",["cc"],(function(){var t;return{setters:[function(c){t=c.cclegacy}],execute:function(){t._RF.push({},"524abnEJ9RDkLNecdtAeUXY","BuildingContracts",void 0),t._RF.pop()}}}));

System.register("chunks:///_virtual/BuildingService.ts",["./rollupPluginModLoBabelHelpers.js","cc","./EventBus.ts","./StaticConfigStore.ts"],(function(i){var e,n,t,l,r;return{setters:[function(i){e=i.createForOfIteratorHelperLoose},function(i){n=i.cclegacy},function(i){t=i.bus,l=i.Events},function(i){r=i.StaticConfigStore}],execute:function(){n._RF.push({},"12561HN+QZD4rEpSFVJYOej","BuildingService",void 0);i("BuildingService",function(){function i(i){this.walletService=void 0,this.buildingLevels=new Map,this.buildingConfigIds=new Map,this.walletService=i}var n=i.prototype;return n.getAllBuildingLevels=function(){for(var i,n={},t=e(this.buildingLevels);!(i=t()).done;){var l=i.value,r=l[0],u=l[1];n[r.toString()]=u}return n},n.setBuildingLevels=function(i){if(this.buildingLevels.clear(),this.buildingConfigIds.clear(),i)for(var e=0,n=Object.entries(i);e<n.length;e++){var t=n[e],l=t[0],r=t[1],u=Math.max(1,Math.floor(r));this.buildingLevels.set(Number(l),u)}},n.setBuildingInstances=function(i){this.buildingLevels.clear(),this.buildingConfigIds.clear();for(var n,t=e(i);!(n=t()).done;){var l,r=n.value;if(r.buildingId&&Number.isFinite(r.id)){var u=Math.floor(r.id),s=Math.max(1,Math.floor(null!=(l=r.level)?l:1));this.buildingLevels.set(u,s),this.buildingConfigIds.set(u,r.buildingId)}}},n.getBuildingLevel=function(i){var e;return null!=(e=this.buildingLevels.get(i))?e:1},n.setBuildingLevel=function(i,e){var n=Math.max(1,Math.floor(e));this.buildingLevels.set(i,n)},n.getBuildingConfigId=function(i){var e;return null!=(e=this.buildingConfigIds.get(i))?e:null},n.setBuildingConfigId=function(i,e){this.buildingConfigIds.set(i,e)},n.canUpgrade=function(i){return this.walletService.canSpend(i.upgradeCost)},n.upgrade=function(i,e){var n=e.nextLevelBuildingId;if(!n)return console.error("No upgrade available for building "+e.id),!1;var u=r.getBuildingConfigById(n);if(!u)return console.error("Next building config not found for id "+n),!1;if(!this.canUpgrade(e))return!1;if(!this.walletService.spend(e.upgradeCost))return!1;var s=this.getBuildingLevel(i)+1;return this.buildingLevels.set(i,s),this.buildingConfigIds.set(i,n),t.emit(l.BUILDING_UPGRADE,{id:i,newBuilding:u}),!0},i}());n._RF.pop()}}}));

System.register("chunks:///_virtual/BuildingUpgradeView.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var i,r,t,n,o,l,a,u,p,c,d;return{setters:[function(e){i=e.applyDecoratedDescriptor,r=e.inheritsLoose,t=e.initializerDefineProperty,n=e.assertThisInitialized},function(e){o=e.cclegacy,l=e._decorator,a=e.Sprite,u=e.Label,p=e.resources,c=e.SpriteFrame,d=e.Component}],execute:function(){var s,g,f,b,w,v,h,y,M;o._RF.push({},"c25b7vTMuFPNJfq7nrMQf7/","BuildingUpgradeView",void 0);var m=l.ccclass,F=l.property;e("BuildingUpgradeView",(s=m("BuildingUpgradeView"),g=F({type:a}),f=F({type:a}),b=F({type:u}),s((h=i((v=function(e){function i(){for(var i,r=arguments.length,o=new Array(r),l=0;l<r;l++)o[l]=arguments[l];return i=e.call.apply(e,[this].concat(o))||this,t(i,"upgradeFromSprite",h,n(i)),t(i,"upgradeToSprite",y,n(i)),t(i,"upgradePriceLabel",M,n(i)),i.viewModel=null,i}r(i,e);var o=i.prototype;return o.bind=function(e){var i=this;this.viewModel=e,this.viewModel.bindView((function(){i.viewModel=null,i.node.destroy()})),this.buildView()},o.buildView=function(){var e=this;this.viewModel?(p.load(this.viewModel.icon,c,(function(i,r){e.upgradeFromSprite.spriteFrame=r})),p.load(this.viewModel.nextLevelIcon,c,(function(i,r){e.upgradeToSprite.spriteFrame=r})),this.upgradePriceLabel.string=this.viewModel.costLabel):console.error("ViewModel is not bound")},o.onUpgrade=function(){this.viewModel.upgrade()},i}(d)).prototype,"upgradeFromSprite",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),y=i(v.prototype,"upgradeToSprite",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),M=i(v.prototype,"upgradePriceLabel",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),w=v))||w));o._RF.pop()}}}));

System.register("chunks:///_virtual/BuildingUpgradeViewModel.ts",["./rollupPluginModLoBabelHelpers.js","cc","./StaticConfigStore.ts","./UserService.ts"],(function(i){var e,n,t,s;return{setters:[function(i){e=i.createClass},function(i){n=i.cclegacy},function(i){t=i.StaticConfigStore},function(i){s=i.UserService}],execute:function(){n._RF.push({},"4ac27l89DFLG55QuXmtG8aO","BuildingUpgradeViewModel",void 0);i("BuildingUpgradeViewModel",function(){function i(i,e){void 0===e&&(e=null),this.model=void 0,this.buildingInstanceId=void 0,this.onDispose=null,this.model=i,this.buildingInstanceId=e}var n=i.prototype;return n.bindView=function(i){this.onDispose=i},n.upgrade=function(){if(null!==this.buildingInstanceId){var i=s.getInstance();if(i.buildingService.canUpgrade(this.model))if(i.buildingService.upgrade(this.buildingInstanceId,this.model)){var e=i.buildingService.getBuildingLevel(this.buildingInstanceId);console.log("Upgraded building "+this.model.id+" to level "+e),this.dispose()}else console.error("Upgrade failed for building "+this.model.id);else console.error("Not enough currency to upgrade building "+this.model.id)}else console.error("Building instance id is missing")},n.testSwapUpgradedModel=function(){if(null!==this.buildingInstanceId){var i=this.model.nextLevelBuildingId;if(i){var e=t.getBuildingConfigById(i);if(e){var n=s.getInstance();n.buildingService.setBuildingConfigId(this.buildingInstanceId,i),n.buildingService.setBuildingLevel(this.buildingInstanceId,n.buildingService.getBuildingLevel(this.buildingInstanceId)+1),this.model=e,console.log("Swapped building instance "+this.buildingInstanceId+" to "+i)}else console.error("Missing config for upgraded building "+i)}else console.error("No upgrade available for building "+this.model.id)}else console.error("Building instance id is missing")},n.dispose=function(){if(this.onDispose){var i=this.onDispose;this.onDispose=null,i()}},e(i,[{key:"title",get:function(){return this.model.message}},{key:"icon",get:function(){return this.model.buildingIcon}},{key:"nextLevelIcon",get:function(){var i=t.getBuildingConfigById(this.model.nextLevelBuildingId);return i?i.buildingIcon:"No upgrade available"}},{key:"costLabel",get:function(){var i=this.model.upgradeCost;return"Cost soft "+i.soft+", steel "+i.steel+", oil "+i.oil+", stuff "+i.stuff}}]),i}());n._RF.pop()}}}));

System.register("chunks:///_virtual/BuildingView.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(i){var e,n,t,o,l,r,c,s,u;return{setters:[function(i){e=i.inheritsLoose},function(i){n=i.cclegacy,t=i._decorator,o=i.Node,l=i.UITransform,r=i.Sprite,c=i.resources,s=i.SpriteFrame,u=i.Component}],execute:function(){var d;n._RF.push({},"bbc14l9qqRBVbGn2Rcm5QEL","BuildingView",void 0);var a=t.ccclass;i("BuildingView",a("BuildingView")(d=function(i){function n(){for(var e,n=arguments.length,t=new Array(n),o=0;o<n;o++)t[o]=arguments[o];return(e=i.call.apply(i,[this].concat(t))||this).viewModel=null,e}e(n,i);var t=n.prototype;return t.onEnable=function(){this.node.on(o.EventType.TOUCH_END,this.onClick,this)},t.onDisable=function(){this.node.off(o.EventType.TOUCH_END,this.onClick,this)},t.bind=function(i){this.updateView(i)},t.updateView=function(i){this.viewModel=i,this.viewModel.bindView(this);var e=this.getComponent(l)||this.addComponent(l),n=e.contentSize;0!==n.width&&0!==n.height||e.setContentSize(80,80)},t.onClick=function(){var i;console.log("BuildingView clicked"),null==(i=this.viewModel)||i.handleClick()},t.render=function(i){console.log("Rendering building with image:",i);var e=this.getComponent(r)||this.addComponent(r);c.load(i,s,(function(i,n){i?console.error("Failed to load building image:",i):e.spriteFrame=n}))},n}(u))||d);n._RF.pop()}}}));

System.register("chunks:///_virtual/BuildingViewModel.ts",["./rollupPluginModLoBabelHelpers.js","cc","./BuildingUpgradeView.ts","./BuildingUpgradeViewModel.ts","./TownhallShopView.ts","./TownhallShopViewModel.ts","./EventBus.ts"],(function(i){var e,n,o,t,d,l,s,a,r;return{setters:[function(i){e=i.createClass},function(i){n=i.cclegacy,o=i.instantiate},function(i){t=i.BuildingUpgradeView},function(i){d=i.BuildingUpgradeViewModel},function(i){l=i.TownhallShopView},function(i){s=i.TownhallShopViewModel},function(i){a=i.bus,r=i.Events}],execute:function(){n._RF.push({},"a59d4sKfslD5LFVapRXo+yt","BuildingViewModel",void 0);i("BuildingViewModel",function(){function i(i,e,n,o,t){var d=this;void 0===t&&(t=null),this.model=void 0,this.upgradeWidgetPrefab=void 0,this.townhallShopPrefab=void 0,this.widgetRoot=void 0,this.buildingInstanceId=void 0,this.view=null,this.upgradeBuildingEvet=function(i){var e;console.log("Received building upgrade event for id:",d.buildingInstanceId,"newBuildingId:",i.newBuilding.id),d.buildingInstanceId===i.id&&(d.model=i.newBuilding,console.log(d.view),null==(e=d.view)||e.render(d.image))},this.model=i,this.upgradeWidgetPrefab=e,this.townhallShopPrefab=n,this.widgetRoot=o,this.buildingInstanceId=t,a.on(r.BUILDING_UPGRADE,this.upgradeBuildingEvet)}var n=i.prototype;return n.bindView=function(i){this.view=i,this.view.render(this.image)},n.handleClick=function(){console.log(this.model.message),"TownHall"!==this.model.kind?this.showUpgradeWidget():this.showTownhallShop()},n.showUpgradeWidget=function(){if(this.upgradeWidgetPrefab)if(this.widgetRoot){var i=o(this.upgradeWidgetPrefab).getComponent(t);if(i){this.widgetRoot.addChild(i.node);var e=new d(this.model,this.buildingInstanceId);i.bind(e)}else console.error("Failed to instantiate BuildingUpgradeView from prefab")}else console.error("Upgrade widget root node is not set");else console.error("Upgrade widget prefab is not set")},n.showTownhallShop=function(){if(this.townhallShopPrefab){var i=o(this.townhallShopPrefab).getComponent(l);this.widgetRoot.addChild(i.node);var e=new s;i.bind(e)}else console.error("Townhall shop prefab is not set")},n.destroy=function(){a.off(r.BUILDING_UPGRADE,this.upgradeBuildingEvet)},e(i,[{key:"image",get:function(){return this.model.buildingImage}}]),i}());n._RF.pop()}}}));

System.register("chunks:///_virtual/BulletShotAbil.ts",["./rollupPluginModLoBabelHelpers.js","cc","./BaseAbil.ts","./BattleStateMachine.ts"],(function(t){var e,i,o,a;return{setters:[function(t){e=t.inheritsLoose},function(t){i=t.cclegacy},function(t){o=t.BaseAbil},function(t){a=t.BattleUnitState}],execute:function(){i._RF.push({},"d84ebexy7dI9IGmAZuXCUhD","BulletShotAbil",void 0);t("BulletShotAbil",function(t){function i(e,i,o,a){var n;return(n=t.call(this,e,i,o,a)||this).timeout=void 0,n.dmg=void 0,n.target=void 0,n.owner=void 0,n.range_for_attack=void 0,n.remainTimeout=void 0,n.timeout=e.timeout,n.dmg=e.dmg,n.target=a.getEnemyAtLine(i),n.owner=i,n.range_for_attack=e.range_for_attack,n.remainTimeout=n.timeout,n}return e(i,t),i.prototype.tick=function(e,i){(t.prototype.tick.call(this,e,i),this.remainTimeout-=e,this.remainTimeout<=0&&null!=this.target&&this.target.stateMachine.getState()!==a.Dead)&&(Math.abs(this.owner.position-this.target.position)<this.range_for_attack&&(this.battleLog.addBulletShotEvent(i,this.owner.battleUnitId,this.target.battleUnitId),this.target.applyDamage(this.owner,this.dmg),this.remainTimeout=this.timeout))},i}(o));i._RF.pop()}}}));

System.register("chunks:///_virtual/BulletShotView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./CommonBattle.ts"],(function(t){var o,e,n,i,s,r;return{setters:[function(t){o=t.inheritsLoose},function(t){e=t.cclegacy,n=t._decorator,i=t.tween,s=t.Component},function(t){r=t.randomRange}],execute:function(){var u;e._RF.push({},"350225nE9pAZbus9Plm8w+k","BulletShotView",void 0);var c=n.ccclass;n.property,t("BulletShotView",c("BulletShotView")(u=function(t){function e(){return t.apply(this,arguments)||this}return o(e,t),e.prototype.init=function(t,o){var e=this,n=t.node.getPosition();this.node.setPosition(n);var s=o.getPosition();s.y+=r(-30,30),i(this.node).to(.3,{position:s}).call((function(){e.node.destroy()})).start()},e}(s))||u);e._RF.pop()}}}));

System.register("chunks:///_virtual/CommonBattle.ts",["cc"],(function(t){var e;return{setters:[function(t){e=t.cclegacy}],execute:function(){t("randomRange",(function(t,e){return t+Math.random()*(e-t)})),e._RF.push({},"b163fKyix9ANrXMcCrvqv8G","CommonBattle",void 0);t("BattleTeam",function(t){return t[t.Team1=1]="Team1",t[t.Team2=2]="Team2",t}({}));e._RF.pop()}}}));

System.register("chunks:///_virtual/EnemyBlock.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var n,t,r,i,o,c,l,a;return{setters:[function(e){n=e.applyDecoratedDescriptor,t=e.inheritsLoose,r=e.initializerDefineProperty,i=e.assertThisInitialized},function(e){o=e.cclegacy,c=e._decorator,l=e.Sprite,a=e.Component}],execute:function(){var u,p,y,s,f,m;o._RF.push({},"2be8dvX6ZlOfqvYc5Ji8rxk","EnemyBlock",void 0);var v=c.ccclass,b=c.property,k=(e("EnemyBlock",(u=v("EnemyBlock"),p=b({type:l}),u((f=n((s=function(e){function n(){for(var n,t=arguments.length,o=new Array(t),c=0;c<t;c++)o[c]=arguments[c];return n=e.call.apply(e,[this].concat(o))||this,r(n,"enemyType",f,i(n)),r(n,"BlockSprite",m,i(n)),n}t(n,e);var o=n.prototype;return o.start=function(){},o.update=function(e){},n}(a)).prototype,"enemyType",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return k.Enemy}}),m=n(s.prototype,"BlockSprite",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),y=s))||y)),e("EnemyType",function(e){return e[e.Enemy=0]="Enemy",e[e.Ally=1]="Ally",e}({})));o._RF.pop()}}}));

System.register("chunks:///_virtual/EventBus.ts",["cc"],(function(e){var t,n;return{setters:[function(e){t=e.cclegacy,n=e.EventTarget}],execute:function(){t._RF.push({},"afa5dVSR/pF3Y+liRZt9FZv","EventBus",void 0);e("bus",new n),e("Events",{BUILDING_UPGRADE:"building/upgrade"});t._RF.pop()}}}));

System.register("chunks:///_virtual/GameCode.ts",["./rollupPluginModLoBabelHelpers.js","cc","./EnemyBlock.ts","./StaticConfigStore.ts"],(function(e){var t,n,i,r,l,a,o,s,u,c,p,h,y,f,m,B,d,g,b,C,v,S,w,T,P,z,E,R,k,O,A,D;return{setters:[function(e){t=e.applyDecoratedDescriptor,n=e.inheritsLoose,i=e.initializerDefineProperty,r=e.assertThisInitialized,l=e.asyncToGenerator,a=e.regeneratorRuntime},function(e){o=e.cclegacy,s=e._decorator,u=e.Node,c=e.Prefab,p=e.Button,h=e.SpriteFrame,y=e.Sprite,f=e.instantiate,m=e.tween,B=e.Vec3,d=e.assetManager,g=e.Texture2D,b=e.KeyCode,C=e.view,v=e.UITransform,S=e.Collider2D,w=e.Contact2DType,T=e.RigidBody2D,P=e.ERigidBody2DType,z=e.randomRange,E=e.Component,R=e.input,k=e.Input},function(e){O=e.EnemyType,A=e.EnemyBlock},function(e){D=e.StaticConfigStore}],execute:function(){var _,G,N,F,I,x,H,K,M,V,L,W,Y,U,j,q,J,Q,X,Z,$;o._RF.push({},"416f2qSeYdDYro2Wi1uiVoF","GameCode",void 0);var ee=s.ccclass,te=s.property;e("GameCode",(_=ee("GameCode"),G=te({type:u}),N=te({type:c}),F=te({type:c}),I=te({type:c}),x=te({type:p}),H=te({type:u}),K=te({type:h}),M=te({type:y}),_((W=t((L=function(e){function t(){for(var t,n=arguments.length,l=new Array(n),a=0;a<n;a++)l[a]=arguments[a];return t=e.call.apply(e,[this].concat(l))||this,i(t,"canvas",W,r(t)),i(t,"level",Y,r(t)),i(t,"enemyBall",U,r(t)),i(t,"allyBall",j,r(t)),i(t,"startGameButton",q,r(t)),i(t,"stickNode",J,r(t)),i(t,"allyBallSprite",Q,r(t)),i(t,"lennaImage",X,r(t)),i(t,"ballSpeed",Z,r(t)),i(t,"ballStrafeSpeed",$,r(t)),t.currentBall=null,t}n(t,e);var o=t.prototype;return o.start=function(){var e=l(a().mark((function e(){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,D.init();case 2:R.on(k.EventType.KEY_PRESSING,this.OnKeyPressing,this),R.on(k.EventType.TOUCH_MOVE,this.OnTouchMove,this);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),o.onStartGame=function(){var e=this;this.startGameButton.node.removeFromParent();var t=f(this.level);this.canvas.addChild(t),m(this.stickNode).repeatForever(m().by(4,{eulerAngles:new B(360,360,360)},{easing:"linear"})).start();d.loadRemote("https://upload.wikimedia.org/wikipedia/en/7/7d/Lenna_%28test_image%29.png",(function(t,n){if(t)console.error("Image load error",t);else{var i=new g;i.image=n;var r=new h;r.texture=i,e.lennaImage.spriteFrame=r}})),this.spawnRandomAttackingBall()},o.OnTouchMove=function(e){if(null!=this.currentBall){var t=e.getDelta(),n=this.currentBall.getPosition();this.currentBall.setPosition(n.x+t.x,n.y,n.z)}},o.OnKeyPressing=function(e){if(null!=this.currentBall){var t=this.currentBall.getPosition();e.keyCode===b.ARROW_LEFT&&this.currentBall.setPosition(t.x-this.ballStrafeSpeed,t.y,t.z),e.keyCode===b.ARROW_RIGHT&&this.currentBall.setPosition(t.x+this.ballStrafeSpeed,t.y,t.z)}},o.spawnRandomAttackingBall=function(){if(this.enemyBall&&this.canvas){this.currentBall=f(this.enemyBall),this.canvas.addChild(this.currentBall);var e=C.getVisibleSize(),t=this.currentBall.getComponent(v),n=t?t.contentSize.height:0,i=-e.height/2+n/2;this.currentBall.setPosition(0,i,0);var r=this.currentBall.getComponent(S);r&&(r.on(w.BEGIN_CONTACT,this.onBeginContact,this),r.on(w.END_CONTACT,this.onEndContact,this)),this.currentBall.getComponent(T).type=P.Dynamic;var l=z(0,1)>.3?O.Ally:O.Enemy;this.currentBall.getComponent(A).enemyType=l,l==O.Ally&&(this.currentBall.getComponent(A).BlockSprite.spriteFrame=this.allyBallSprite)}},o.onBeginContact=function(e,t,n){var i=this;if(null!=this.currentBall&&(e.node==this.currentBall||t.node==this.currentBall)){var r=this.currentBall.getComponent(A).enemyType,l=t.node.getComponent(A).enemyType;if(r==O.Ally&&l==O.Enemy)this.scheduleOnce((function(){t.node.removeFromParent(),e.node.removeFromParent(),i.spawnRandomAttackingBall()}),.001),this.currentBall=null;else this.currentBall.getComponent(T).type=P.Kinematic,this.spawnRandomAttackingBall()}},o.onEndContact=function(e,t,n){},o.onDestroy=function(){this.unregisetrterBallCollisionHandlers()},o.unregisetrterBallCollisionHandlers=function(){if(this.currentBall){var e=this.currentBall.getComponent(S);e&&(e.off(w.BEGIN_CONTACT,this.onBeginContact,this),e.off(w.END_CONTACT,this.onEndContact,this))}},o.updateBallPosition=function(e){if(this.currentBall){var t=this.ballSpeed*e,n=this.currentBall.getPosition();n.y+=t,this.currentBall.setPosition(n)}},o.handleBallOutOfBounds=function(){if(this.currentBall){var e=C.getVisibleSize(),t=this.currentBall.getComponent(v),n=t?t.contentSize.height:0;this.currentBall.getPosition().y-n/2>e.height/2&&(this.unregisetrterBallCollisionHandlers(),this.currentBall.removeFromParent(),this.currentBall=null,this.spawnRandomAttackingBall())}},o.update=function(e){this.updateBallPosition(e),this.handleBallOutOfBounds()},t}(E)).prototype,"canvas",[G],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Y=t(L.prototype,"level",[N],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),U=t(L.prototype,"enemyBall",[F],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),j=t(L.prototype,"allyBall",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),q=t(L.prototype,"startGameButton",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),J=t(L.prototype,"stickNode",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Q=t(L.prototype,"allyBallSprite",[K],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),X=t(L.prototype,"lennaImage",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Z=t(L.prototype,"ballSpeed",[te],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 100}}),$=t(L.prototype,"ballStrafeSpeed",[te],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 10}}),V=L))||V));o._RF.pop()}}}));

System.register("chunks:///_virtual/ItemsService.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var t,r;return{setters:[function(e){t=e.createForOfIteratorHelperLoose},function(e){r=e.cclegacy}],execute:function(){r._RF.push({},"7d9f35yTSNF4Y7oeohWmJYS","ItemsService",void 0);e("ItemsService",function(){function e(){this.items=new Map}var r=e.prototype;return r.addItem=function(e,t){var r;if(void 0===t&&(t=1),e){var n=Math.max(1,Math.floor(t)),i=null!=(r=this.items.get(e))?r:0;this.items.set(e,i+n)}},r.getCount=function(e){var t;return null!=(t=this.items.get(e))?t:0},r.getAll=function(){for(var e,r={},n=t(this.items);!(e=n()).done;){var i=e.value,o=i[0],s=i[1];r[o]=s}return r},e}());r._RF.pop()}}}));

System.register("chunks:///_virtual/main",["./EventBus.ts","./BaseAbil.ts","./BombAbil.ts","./BulletShotAbil.ts","./BattleLog.ts","./BattleLogic.ts","./BattleStateMachine.ts","./BattleUnit.ts","./Battleground.ts","./CommonBattle.ts","./BattleBombView.ts","./BattleManager.ts","./BattleUnitView.ts","./BattleViewCommon.ts","./BulletShotView.ts","./GameCode.ts","./BuildingContracts.ts","./BuildingView.ts","./BuildingViewModel.ts","./StaticConfigModels.ts","./StaticConfigStore.ts","./PlayerBase.ts","./PlayerBaseModels.ts","./PlayerBaseViewModel.ts","./TownhallShopContracts.ts","./TownhallShopItem.ts","./TownhallShopView.ts","./TownhallShopViewModel.ts","./BuildingUpgradeView.ts","./BuildingUpgradeViewModel.ts","./BuildingService.ts","./ItemsService.ts","./UserModels.ts","./UserService.ts","./WalletService.ts","./StartGameButton.ts","./EnemyBlock.ts"],(function(){return{setters:[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],execute:function(){}}}));

System.register("chunks:///_virtual/PlayerBase.ts",["./rollupPluginModLoBabelHelpers.js","cc","./BuildingView.ts","./StaticConfigStore.ts","./UserService.ts","./PlayerBaseViewModel.ts","./BuildingViewModel.ts","./BattleLogic.ts"],(function(e){var t,i,n,r,o,l,a,s,u,c,d,f,h,p,g,b,y,m,w,v,B,P,R,C,S,M,x,U;return{setters:[function(e){t=e.applyDecoratedDescriptor,i=e.inheritsLoose,n=e.initializerDefineProperty,r=e.assertThisInitialized,o=e.createForOfIteratorHelperLoose,l=e.asyncToGenerator,a=e.regeneratorRuntime},function(e){s=e.cclegacy,u=e._decorator,c=e.SpriteFrame,d=e.Prefab,f=e.resources,h=e.JsonAsset,p=e.assetManager,g=e.Node,b=e.Layers,y=e.UITransform,m=e.Sprite,w=e.Vec3,v=e.Canvas,B=e.Component,P=e.instantiate},function(e){R=e.BuildingView},function(e){C=e.StaticConfigStore},function(e){S=e.UserService},function(e){M=e.PlayerBaseViewModel},function(e){x=e.BuildingViewModel},function(e){U=e.BattleLogic}],execute:function(){var N,z,D,I,O,_,F,G,J,L,W,V,A,E,j,k;s._RF.push({},"d2f5bPukodJ8bv3GyAMIGwE","PlayerBase",void 0);var Z=u.ccclass,T=u.property;e("PlayerBase",(N=Z("PlayerBase"),z=T({type:c}),D=T({type:d}),I=T({type:d}),O=T({type:d}),N((G=t((F=function(e){function t(){for(var t,i=arguments.length,o=new Array(i),l=0;l<i;l++)o[l]=arguments[l];return t=e.call.apply(e,[this].concat(o))||this,n(t,"columns",G,r(t)),n(t,"rows",J,r(t)),n(t,"cellRadius",L,r(t)),n(t,"cellSprite",W,r(t)),n(t,"upgradeWidgetPrefab",V,r(t)),n(t,"townhallShopPrefab",A,r(t)),n(t,"battleManagerPrefab",E,r(t)),n(t,"userConfigPath",j,r(t)),n(t,"defaultWalletBalance",k,r(t)),t.viewModel=null,t.cellNodes=[],t.buildingsRoot=null,t}i(t,e);var s=t.prototype;return s.start=function(){this.loadAndBuild().catch((function(e){console.error("PlayerBase config load failed",e)}))},s.loadAndBuild=function(){var e=l(a().mark((function e(){var t,i,n,r,o,l,s,u,c;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,C.init();case 2:return e.next=4,this.loadUserData(this.userConfigPath);case 4:r=e.sent,S.getInstance().applyUserData(r,this.defaultWalletBalance),o=r.Buildings,l=C.getBuildingModels(),console.log("Loaded building models:",l),s=null!=(t=o.columns)?t:this.columns,u=null!=(i=o.rows)?i:this.rows,c=null!=(n=o.cellRadius)?n:this.cellRadius,this.buildGridFromConfig(s,u,c,o.cells,l);case 14:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),s.loadUserData=function(e){return this.isRemoteSource(e)?this.loadRemoteUserData(e):this.loadLocalUserData(e)},s.loadLocalUserData=function(e){return new Promise((function(t,i){var n=e.endsWith(".json")?e.slice(0,-5):e;f.load(n,h,(function(n,r){!n&&r?t(r.json):i(null!=n?n:new Error("Missing user JSON at "+e))}))}))},s.loadRemoteUserData=function(e){return new Promise((function(t,i){p.loadRemote(e,(function(n,r){!n&&r?t(r.json):i(null!=n?n:new Error("Missing remote user JSON at "+e))}))}))},s.isRemoteSource=function(e){return e.startsWith("http://")||e.startsWith("https://")},s.buildGrid=function(){if(this.clearGrid(),this.viewModel){this.ensureBuildingsRoot();for(var e,t=[],i=o(this.viewModel.cells);!(e=i()).done;){var n=e.value;t.push(this.viewModel.getRawCellPosition(n))}for(var r=this.getCenterOffset(t),l=0;l<this.viewModel.cells.length;l+=1){var a=this.viewModel.cells[l],s=this.createCellNode(a,t[l],r);this.node.addChild(s),this.cellNodes.push(s)}this.applyUiZOrder()}},s.buildGridFromConfig=function(e,t,i,n,r){this.columns=e,this.rows=t,this.cellRadius=i,this.viewModel=new M(e,t,i,n,r),this.buildGrid()},s.createCellNode=function(e,t,i){var n=new g("Cell_"+e.q+"_"+e.r),r=t.add(i);(n.setPosition(r.x,r.y,0),n.layer=b.Enum.UI_2D,n.addComponent(y).setContentSize(2*this.cellRadius,2*this.cellRadius),this.cellSprite)&&(n.addComponent(m).spriteFrame=this.cellSprite);return e.building&&this.createBuildingNode(e,r),n},s.getCenterOffset=function(e){if(0===e.length)return new w;for(var t,i=e[0].x,n=e[0].x,r=e[0].y,l=e[0].y,a=o(e);!(t=a()).done;){var s=t.value;i=Math.min(i,s.x),n=Math.max(n,s.x),r=Math.min(r,s.y),l=Math.max(l,s.y)}return new w(-(i+n)/2,-(r+l)/2,0)},s.clearGrid=function(){for(var e,t=o(this.cellNodes);!(e=t()).done;){e.value.removeFromParent()}this.cellNodes=[],this.buildingsRoot&&(this.buildingsRoot.removeFromParent(),this.buildingsRoot=null)},s.applyUiZOrder=function(){for(var e=[].concat(this.cellNodes).sort((function(e,t){return t.position.y-e.position.y})),t=0;t<e.length;t+=1)e[t].setSiblingIndex(t)},s.applyBuildingsZOrder=function(){if(this.buildingsRoot)for(var e=[].concat(this.buildingsRoot.children).sort((function(e,t){return t.position.y-e.position.y})),t=0;t<e.length;t+=1)e[t].setSiblingIndex(t)},s.ensureBuildingsRoot=function(){this.buildingsRoot||(this.buildingsRoot=new g("BuildingsRoot"),this.buildingsRoot.layer=b.Enum.UI_2D,this.node.addChild(this.buildingsRoot))},s.createBuildingNode=function(e,t){var i,n;if(this.buildingsRoot){var r=new g("Building_"+e.q+"_"+e.r),o=r.addComponent(y);r.layer=b.Enum.UI_2D;var l=1.2*this.cellRadius;o.setContentSize(l,l),o.setAnchorPoint(.5,.1),r.setPosition(t.x,t.y,0);var a=r.addComponent(R),s=null!=(i=null==(n=this.node.parent)||null==(n=n.getComponent(v))?void 0:n.node)?i:null,u=new x(e.building,this.upgradeWidgetPrefab,this.townhallShopPrefab,s,e.buildingInstanceId);a.bind(u),this.buildingsRoot.addChild(r),this.applyBuildingsZOrder()}},s.loadJson=function(e){return new Promise((function(t,i){f.load(e,h,(function(e,n){e?i(e):t(n.json)}))}))},s.Battle=function(){var e=l(a().mark((function e(){var t,i,n,r,o;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.loadJson("BattleConfig");case 2:return t=e.sent,e.next=5,this.loadJson("Config/Units");case 5:i=e.sent,n=new U(JSON.stringify(t),JSON.stringify(i)),r=n.simulateBattle(),o=P(this.battleManagerPrefab),this.node.addChild(o),o.getComponent("BattleManager").initBattle(r);case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),t}(B)).prototype,"columns",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 5}}),J=t(F.prototype,"rows",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 5}}),L=t(F.prototype,"cellRadius",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 64}}),W=t(F.prototype,"cellSprite",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),V=t(F.prototype,"upgradeWidgetPrefab",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),A=t(F.prototype,"townhallShopPrefab",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),E=t(F.prototype,"battleManagerPrefab",[O],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),j=t(F.prototype,"userConfigPath",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"User"}}),k=t(F.prototype,"defaultWalletBalance",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 500}}),_=F))||_));s._RF.pop()}}}));

System.register("chunks:///_virtual/PlayerBaseModels.ts",["cc"],(function(i){var t;return{setters:[function(i){t=i.cclegacy}],execute:function(){t._RF.push({},"05257JxKtZNIrkqgXypazvy","PlayerBaseModels",void 0);i("BuildingData",(function(i,t,d,s,n,l,e){this.id=void 0,this.kind=void 0,this.buildingImage=void 0,this.buildingIcon=void 0,this.message=void 0,this.nextLevelBuildingId=void 0,this.upgradeCost=void 0,this.id=i,this.kind=t,this.buildingImage=d,this.buildingIcon=s,this.message=n,this.nextLevelBuildingId=l,this.upgradeCost=e})),i("CellData",(function(i,t,d,s,n){var l,e;void 0===s&&(s=null),void 0===n&&(n=null),this.q=void 0,this.r=void 0,this.building=void 0,this.buildingId=void 0,this.buildingInstanceId=void 0,this.q=i,this.r=t,this.building=d,this.buildingId=null!=(l=null!=(e=s)?e:null==d?void 0:d.id)?l:null,this.buildingInstanceId=n}));t._RF.pop()}}}));

System.register("chunks:///_virtual/PlayerBaseViewModel.ts",["./rollupPluginModLoBabelHelpers.js","cc","./PlayerBaseModels.ts"],(function(l){var e,i,n,t;return{setters:[function(l){e=l.createForOfIteratorHelperLoose},function(l){i=l.cclegacy,n=l.Vec3},function(l){t=l.CellData}],execute:function(){i._RF.push({},"d426eBvVidEpIqu4dCFfCSF","PlayerBaseViewModel",void 0);l("PlayerBaseViewModel",function(){function l(l,e,i,n,t){this.cells=[],this.columns=void 0,this.rows=void 0,this.cellRadius=void 0,this.columns=Math.max(1,l),this.rows=Math.max(1,e),this.cellRadius=Math.max(1,i),this.createCells(n,t)}var i=l.prototype;return i.getRawCellPosition=function(l){var e=1.5*this.cellRadius*l.q,i=this.cellRadius*Math.sqrt(3)*(l.r+.5*l.q);return new n(e,i,0)},i.createCells=function(l,i){for(var n,s=new Map,u=e(l);!(n=u()).done;){var o,r,a,d=n.value,c=null!=(o=null!=(r=d.buildingId)?r:null==(a=d.building)?void 0:a.id)?o:null;c&&s.set(d.q+"_"+d.r,{buildingId:c,buildingInstanceId:Number.isFinite(d.id)?d.id:null})}for(var h=0;h<this.columns;h+=1)for(var v=0;v<this.rows;v+=1){var f,g,p=null,w=s.get(h+"_"+v);w&&(p=i.get(w.buildingId)||null),this.cells.push(new t(h,v,p,null!=(f=null==w?void 0:w.buildingId)?f:null,null!=(g=null==w?void 0:w.buildingInstanceId)?g:null))}},l}());i._RF.pop()}}}));

System.register("chunks:///_virtual/StartGameButton.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var e,n,r,o;return{setters:[function(t){e=t.inheritsLoose},function(t){n=t.cclegacy,r=t._decorator,o=t.Component}],execute:function(){var u;n._RF.push({},"be32dvTOUJCkKa1Yse1hmAi","StartGameButton",void 0);var a=r.ccclass;r.property,t("StartGameButton",a("StartGameButton")(u=function(t){function n(){return t.apply(this,arguments)||this}e(n,t);var r=n.prototype;return r.start=function(){},r.update=function(t){},n}(o))||u);n._RF.pop()}}}));

System.register("chunks:///_virtual/StaticConfigModels.ts",["cc"],(function(i){var t;return{setters:[function(i){t=i.cclegacy}],execute:function(){t._RF.push({},"850baqneYhDPbvq/BSvUQsw","StaticConfigModels",void 0);i("UnitLine",function(i){return i.Line1="line1",i.Live2="line2",i.Line3="line3",i}({})),i("UnitData",(function(i,t,s,e,o,n,h,d,v,l,u,c,r){this.id=void 0,this.title=void 0,this.description=void 0,this.model=void 0,this.line=void 0,this.abils=void 0,this.hp=void 0,this.v_base=void 0,this.v_mult_snow=void 0,this.v_mult_desert=void 0,this.v_mult_jungle=void 0,this.id=i,this.title=t,this.description=s,this.model=e,this.line=o,this.abils=n,this.hp=h,this.v_base=l,this.v_mult_snow=u,this.v_mult_desert=c,this.v_mult_jungle=r})),i("ProductionEntry",(function(i,t){this.produce=void 0,this.cost=void 0,this.produce=i,this.cost=t}));t._RF.pop()}}}));

System.register("chunks:///_virtual/StaticConfigStore.ts",["./rollupPluginModLoBabelHelpers.js","cc","./PlayerBaseModels.ts","./StaticConfigModels.ts"],(function(i){var t,n,e,o,s,u,r,l,d;return{setters:[function(i){t=i.createForOfIteratorHelperLoose,n=i.asyncToGenerator,e=i.regeneratorRuntime},function(i){o=i.cclegacy,s=i.resources,u=i.JsonAsset},function(i){r=i.BuildingData},function(i){l=i.UnitData,d=i.ProductionEntry}],execute:function(){o._RF.push({},"30ae15wpSxONIwX3upCVDm8","StaticConfigStore",void 0);var a=i("StaticConfigStore",function(){function i(){}return i.init=function(){var i=n(e().mark((function i(t,n,o){var s,u,r,l;return e().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(void 0===t&&(t="Config/Buildings"),void 0===n&&(n="Config/Units"),void 0===o&&(o="Config/Production"),!this.initialized||this.buildingsPath!==t||this.unitsPath!==n||this.productionPath!==o){i.next=5;break}return i.abrupt("return");case 5:return i.next=7,Promise.all([this.loadJson(t),this.loadJson(n),this.loadJson(o)]);case 7:s=i.sent,u=s[0],r=s[1],l=s[2],this.buildingsConfig=u,this.buildingModels=this.buildBuildingModels(u.buildings),this.unitsConfig=r,this.unitModels=this.buildUnitModels(r.Units),this.productionConfig=l,this.productionModels=this.buildProductionModels(l.Combotants),this.buildingsPath=t,this.unitsPath=n,this.productionPath=o,this.initialized=!0;case 21:case"end":return i.stop()}}),i,this)})));return function(t,n,e){return i.apply(this,arguments)}}(),i.getBuildingsConfig=function(){return this.assertInitialized(),this.buildingsConfig},i.getBuildingModels=function(){return this.assertInitialized(),this.buildingModels},i.getUnitsConfig=function(){return this.assertInitialized(),this.unitsConfig},i.getUnitById=function(i){var t;return null!=(t=this.getUnitsConfig().Units.find((function(t){return t.id===i})))?t:null},i.getUnitModels=function(){return this.assertInitialized(),this.unitModels},i.getUnitConfigById=function(i){var t;return this.assertInitialized(),null!=(t=this.unitModels.get(i))?t:null},i.getProductionConfig=function(){return this.assertInitialized(),this.productionConfig},i.getProductionModels=function(){return this.assertInitialized(),this.productionModels},i.getProductionById=function(i){var t;return this.assertInitialized(),null!=(t=this.productionModels.get(i))?t:null},i.getBuildingConfigById=function(i){var t;return this.assertInitialized(),null!=(t=this.buildingsConfig.buildings.find((function(t){return t.id===i})))?t:null},i.assertInitialized=function(){if(!(this.initialized&&this.buildingsConfig&&this.buildingModels&&this.unitsConfig&&this.unitModels&&this.productionConfig&&this.productionModels))throw new Error("StaticConfigStore is not initialized")},i.buildBuildingModels=function(i){for(var n,e=new Map,o=t(i);!(n=o()).done;){var s=n.value;e.set(s.id,new r(s.id,s.kind,s.buildingImage,s.buildingIcon,s.message,s.nextLevelBuildingId,s.upgradeCost))}return e},i.buildUnitModels=function(i){for(var n,e=new Map,o=t(i);!(n=o()).done;){var s,u=n.value,r=null!=(s=u.Abilities)?s:u.abils;e.set(u.id,new l(u.id,u.title,u.description,u.model,u.line,r,u.hp,u.dps,u.range_for_attack,u.v_base,u.v_mult_snow,u.v_mult_desert,u.v_mult_jungle))}return e},i.buildProductionModels=function(i){for(var t=new Map,n=0,e=Object.entries(i);n<e.length;n++){var o=e[n],s=o[0],u=o[1];t.set(s,new d(u.produce,u.cost))}return t},i.loadJson=function(i){return new Promise((function(t,n){s.load(i,u,(function(e,o){!e&&o?t(o.json):n(null!=e?e:new Error("Missing JSON asset at "+i))}))}))},i}());a.buildingsConfig=null,a.buildingModels=null,a.unitsConfig=null,a.unitModels=null,a.productionConfig=null,a.productionModels=null,a.initialized=!1,a.buildingsPath="",a.unitsPath="",a.productionPath="",o._RF.pop()}}}));

System.register("chunks:///_virtual/TownhallShopContracts.ts",["cc"],(function(){var t;return{setters:[function(c){t=c.cclegacy}],execute:function(){t._RF.push({},"9dbc7oR8VZD46yBrOBio+jq","TownhallShopContracts",void 0),t._RF.pop()}}}));

System.register("chunks:///_virtual/TownhallShopItem.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var e,i,n,r,o,l,u,a,c,s,p,h;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,n=t.initializerDefineProperty,r=t.assertThisInitialized},function(t){o=t.cclegacy,l=t._decorator,u=t.Sprite,a=t.Label,c=t.RichText,s=t.resources,p=t.SpriteFrame,h=t.Component}],execute:function(){var b,y,f,d,m,L,g,I,T,v,w;o._RF.push({},"c5a48ExiUNC5Lba/Ama9dvF","TownhallShopItem",void 0);var x=l.ccclass,S=l.property;t("TownhallShopItem",(b=x("TownhallShopItem"),y=S({type:u}),f=S({type:a}),d=S({type:c}),m=S({type:c}),b((I=e((g=function(t){function e(){for(var e,i=arguments.length,o=new Array(i),l=0;l<i;l++)o[l]=arguments[l];return e=t.call.apply(t,[this].concat(o))||this,n(e,"unitIcon",I,r(e)),n(e,"titleLabel",T,r(e)),n(e,"descriptionText",v,r(e)),n(e,"priceLabel",w,r(e)),e.unit=null,e.onBuy=null,e}i(e,t);var o=e.prototype;return o.bind=function(t,e,i){var n=this;this.unit=t,this.onBuy=null!=i?i:null,this.titleLabel&&(this.titleLabel.string=t.title||t.id),this.descriptionText&&(this.descriptionText.string=t.description),this.priceLabel&&(this.priceLabel.string=e),this.unitIcon&&s.load(t.model,p,(function(t,e){t?console.error("Failed to load unit icon:",t):n.unitIcon&&(n.unitIcon.spriteFrame=e)}))},o.onDestroy=function(){},o.handleBuy=function(){this.unit&&this.onBuy&&this.onBuy(this.unit)},e}(h)).prototype,"unitIcon",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),T=e(g.prototype,"titleLabel",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),v=e(g.prototype,"descriptionText",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),w=e(g.prototype,"priceLabel",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),L=g))||L));o._RF.pop()}}}));

System.register("chunks:///_virtual/TownhallShopView.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var t,n,o,i,l,r,u,a,c;return{setters:[function(e){t=e.applyDecoratedDescriptor,n=e.inheritsLoose,o=e.initializerDefineProperty,i=e.assertThisInitialized},function(e){l=e.cclegacy,r=e._decorator,u=e.ScrollView,a=e.Prefab,c=e.Component}],execute:function(){var s,h,p,w,d,f,v;l._RF.push({},"65e5ex38cdI14KtqSfS+Kg4","TownhallShopView",void 0);var y=r.ccclass,b=r.property;e("TownhallShopView",(s=y("TownhallShopView"),h=b({type:u}),p=b({type:a}),s((f=t((d=function(e){function t(){for(var t,n=arguments.length,l=new Array(n),r=0;r<n;r++)l[r]=arguments[r];return t=e.call.apply(e,[this].concat(l))||this,o(t,"itemsScroll",f,i(t)),o(t,"townhallItem",v,i(t)),t.viewModel=null,t}n(t,e);var l=t.prototype;return l.bind=function(e){this.viewModel=e,this.viewModel.bindView(this)},l.render=function(){this.viewModel||console.error("TownhallShopViewModel is not bound")},l.getItemsScroll=function(){return this.itemsScroll},l.getTownhallItemPrefab=function(){return this.townhallItem},l.onUpgrade=function(){var e;null==(e=this.viewModel)||e.upgrade()},l.onBuy=function(){var e;null==(e=this.viewModel)||e.buy()},l.onClose=function(){var e;null==(e=this.viewModel)||e.close()},l.close=function(){this.viewModel=null,this.node.destroy()},t}(c)).prototype,"itemsScroll",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),v=t(d.prototype,"townhallItem",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),w=d))||w));l._RF.pop()}}}));

System.register("chunks:///_virtual/TownhallShopViewModel.ts",["cc","./StaticConfigStore.ts","./TownhallShopItem.ts","./UserService.ts"],(function(o){var e,t,n,i,l,r;return{setters:[function(o){e=o.cclegacy,t=o.UITransform,n=o.instantiate},function(o){i=o.StaticConfigStore},function(o){l=o.TownhallShopItem},function(o){r=o.UserService}],execute:function(){e._RF.push({},"5d91dmjmElAxYDhuL9OqkBp","TownhallShopViewModel",void 0);o("TownhallShopViewModel",function(){function o(){this.view=null}var e=o.prototype;return e.bindView=function(o){var e=this;this.view=o,this.view.render();var r=this.view.getItemsScroll(),c=this.view.getTownhallItemPrefab();if(r&&c){var s=r.content;if(s){var h=0,a=s.getComponent(t)||s.addComponent(t),d=a.contentSize.width||0,u=i.getProductionConfig().Combotants;Object.entries(u).forEach((function(o){var r=o[0],a=o[1],u=i.getUnitConfigById(a.produce);if(u){console.log("[TownhallShop] Available unit: "+u.id);var f=n(c),p=f.getComponent(l),w=e.buildPriceLabel(r);p.bind(u,w,(function(){e.buy(u)})),s.addChild(f);var S=(f.getComponent(t)||f.addComponent(t)).contentSize,v=S.height&&S.height>0?S.height:100,g=S.width&&S.width>0?S.width:d||100;f.setPosition(0,-h-v/2,0),h+=v,g>d&&(d=g)}else console.error("[TownhallShop] Unit config not found for "+a.produce)}));var f=r.node.getComponent(t),p=f?f.contentSize.width:0,w=f?f.contentSize.height:0,S=Math.max(d,p),v=Math.max(h,w);a.setContentSize(S,v)}else console.error("[TownhallShop] itemsScroll.content is not set")}else console.error("[TownhallShop] itemsScroll or townhallItem prefab is not set")},e.buy=function(o){var e=i.getProductionById(o.id);if(e){var t=r.getInstance(),n=t.walletService;if(n.canSpend(e.cost))n.spend(e.cost)?(t.itemsService.addItem(o.id,1),console.log("[TownhallShop] Bought "+o.id)):console.error("[TownhallShop] Spend failed for "+o.id);else console.error("[TownhallShop] Not enough currency to buy "+o.id)}else console.error("[TownhallShop] Production config not found for "+o.id)},e.upgrade=function(){console.log("[TownhallShop] upgrade clicked")},e.close=function(){var o;null==(o=this.view)||o.close(),this.dispose()},e.dispose=function(){this.view&&(this.view.close(),this.view=null)},e.buildPriceLabel=function(o){var e=i.getProductionById(o);if(!e)return"Price: free";var t=e.cost;return"Price: "+["soft "+t.soft,"steel "+t.steel,"oil "+t.oil,"stuff "+t.stuff].join(", ")},o}());e._RF.pop()}}}));

System.register("chunks:///_virtual/UserModels.ts",["cc"],(function(){var e;return{setters:[function(s){e=s.cclegacy}],execute:function(){e._RF.push({},"c6614jBlG5Eb4P5Q4EaGs1+","UserModels",void 0),e._RF.pop()}}}));

System.register("chunks:///_virtual/UserService.ts",["cc","./BuildingService.ts","./ItemsService.ts","./WalletService.ts"],(function(e){var i,t,n,s;return{setters:[function(e){i=e.cclegacy},function(e){t=e.BuildingService},function(e){n=e.ItemsService},function(e){s=e.WalletService}],execute:function(){i._RF.push({},"8d433ypbSpNiZyWfQqnFFKh","UserService",void 0),e("UserService",function(){function e(){this.buildingService=void 0,this.walletService=void 0,this.itemsService=void 0,this.walletService=new s,this.buildingService=new t(this.walletService),this.itemsService=new n}return e.getInstance=function(){return this.instance||(this.instance=new e),this.instance},e.prototype.applyUserData=function(e,i){var t,n,s;void 0===i&&(i=0);var c={soft:i,steel:0,oil:0,stuff:0},l=null!=(t=e.wallet)?t:c;this.walletService.setBalance(l),this.buildingService.setBuildingInstances(null!=(n=null==(s=e.Buildings)?void 0:s.cells)?n:[])},e}()).instance=null,i._RF.pop()}}}));

System.register("chunks:///_virtual/WalletService.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var t,l;return{setters:[function(e){t=e.extends},function(e){l=e.cclegacy}],execute:function(){l._RF.push({},"d22daX9g1BHLYTbCkEkg76w","WalletService",void 0);e("WalletService",function(){function e(){this.balance={soft:0,steel:0,oil:0,stuff:0}}var l=e.prototype;return l.getBalance=function(){return console.log("[WalletService] getBalance -> "+this.formatPrice(this.balance)),t({},this.balance)},l.setBalance=function(e){var t=this.normalizePrice(e);console.log("[WalletService] setBalance from "+this.formatPrice(this.balance)+" to "+this.formatPrice(t)),this.balance=t},l.add=function(e){var t=this.normalizePrice(e);this.isZeroPrice(t)?console.log("[WalletService] add skipped: amount must be > 0"):(this.balance={soft:this.balance.soft+t.soft,steel:this.balance.steel+t.steel,oil:this.balance.oil+t.oil,stuff:this.balance.stuff+t.stuff},console.log("[WalletService] add applied: new balance "+this.formatPrice(this.balance)))},l.canSpend=function(e){var t=this.normalizePrice(e);if(this.isZeroPrice(t))return!0;var l=t.soft<=this.balance.soft&&t.steel<=this.balance.steel&&t.oil<=this.balance.oil&&t.stuff<=this.balance.stuff;return console.log("[WalletService] canSpend "+this.formatPrice(t)+"? "+l),l},l.spend=function(e){var t=this.normalizePrice(e);return console.log("[WalletService] spend requested "+this.formatPrice(t)),!!this.isZeroPrice(t)||(this.canSpend(t)?(this.balance={soft:this.balance.soft-t.soft,steel:this.balance.steel-t.steel,oil:this.balance.oil-t.oil,stuff:this.balance.stuff-t.stuff},console.log("[WalletService] spend succeeded: new balance "+this.formatPrice(this.balance)),!0):(console.log("[WalletService] spend failed: insufficient funds"),!1))},l.normalizePrice=function(e){var t,l,i,s;return{soft:Math.max(0,null!=(t=null==e?void 0:e.soft)?t:0),steel:Math.max(0,null!=(l=null==e?void 0:e.steel)?l:0),oil:Math.max(0,null!=(i=null==e?void 0:e.oil)?i:0),stuff:Math.max(0,null!=(s=null==e?void 0:e.stuff)?s:0)}},l.isZeroPrice=function(e){return 0===e.soft&&0===e.steel&&0===e.oil&&0===e.stuff},l.formatPrice=function(e){return"soft "+e.soft+", steel "+e.steel+", oil "+e.oil+", stuff "+e.stuff},e}());l._RF.pop()}}}));

(function(r) {
  r('virtual:///prerequisite-imports/main', 'chunks:///_virtual/main'); 
})(function(mid, cid) {
    System.register(mid, [cid], function (_export, _context) {
    return {
        setters: [function(_m) {
            var _exportObj = {};

            for (var _key in _m) {
              if (_key !== "default" && _key !== "__esModule") _exportObj[_key] = _m[_key];
            }
      
            _export(_exportObj);
        }],
        execute: function () { }
    };
    });
});